<!DOCTYPE html>
<html><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="bLmaFyyXugiCqSup-eIIIx0B4CngtdF_svyMMKQbS5E" />
<script src="https://hypothes.is/embed.js" async></script>
<title>IOT Heart &middot; Konubinix&#39; Site</title>

<link rel="stylesheet" class="internal-link" href="/blog/css/main.min.8e2ccebba2bd2b151f513c5ea3c62a25d4614364fb0bc5a0261ccdc2b49f020047a52512e7e59e5d513e3aec1ed4fedb503d494c430c930053ef8f6c8a5d7d23.css" integrity="sha512-jizOu6K9KxUfUTxeo8YqJdRhQ2T7C8WgJhzNwrSfAgBHpSUS5&#43;WeXVE&#43;Ouwe1P7bUD1JTEMMkwBT749sil19Iw==" type="text/css" />


<link rel="stylesheet" target="_blank" href="/ipfs/QmQFVQS89fv1XUNFcjwCKDePzckuT9kpuAVNYUwNdEfYcv/css/all.css"/>
<link rel="stylesheet" class="internal-link" href="/blog/css/links.min.66488b1bd98835c9d323aceb9cb379cbdf615c46936837066b038781a80444ba.css"/>
<script type="text/javascript"
		src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<link rel="shortcut icon" target="_blank" href="/ipfs/QmVFwYV7YRZLKU3ybN1hW4jqfyZGPLKJwd8toN2wHz5UAD?a.png" type="image/x-icon" />

<body class="container"><header>
	<a class="internal-link" href="/blog//"><h5 class="site-title">Konubinix&#39; site</h5></a>
  <nav class="footer-nav">
  <ul>
	<li><a class="internal-link" href="/blog/posts/"><i class="icon fas fa-blog"></i></a></li>
    <li><a target="_blank" href="/braindump/"><i class="fas fa-brain"></i></a></li>
    <li><a target="_blank" href="mailto:konubinixweb@gmail.com"><i class="fas fa-envelope-square"></i></a></li>
    <li><a target="_blank" href="https://github.com/konubinix"><i class="fab fa-github-square"></i></a></li>
    <li><a target="_blank" href="https://linkedin.com/in/samuel-loury-61259040"><i class="fab fa-linkedin"></i></a></li>
    <li><a class="internal-link" href="/blog/index.xml"><i class="fas fa-rss-square"></i></a></li>
	<li><a class="internal-link" href="/blog/tags/"><i class="fa fa-tag"></i></a></li>
    <li><a class="internal-link" href="/blog/blog_search"><i class="icon fa fa-search"></i></a></li>
  </ul>
</nav>

</header>

<main>
  <header>
	<h1 class="underline">IOT Heart</h1>
	</header>
  <article>
	<div class="ox-hugo-toc toc">
<div class="heading">Table of Contents</div>
<ul>
<li><a class="internal-link" href="#8d08dbae-b986-4319-93d4-2b3e95f147e8">Printing</a></li>
<li><a class="internal-link" href="#b26318b2-fff5-4f0e-a7e5-37ceabfba796">Assembling</a></li>
<li><a class="internal-link" href="#46c46342-694c-4d56-a162-21066a7b54d5">Setting up the arduino development environment</a></li>
<li><a class="internal-link" href="#3049d260-a684-47af-be69-113db7a9e68a">Programming</a>
<ul>
<li><a class="internal-link" href="#d9866f82-8ada-4783-bd27-5e3b3d563393">The server code</a></li>
</ul>
</li>
<li><a class="internal-link" href="#fd956866-3e9f-4ed4-bf58-d49312f2a42c">Profiting</a></li>
<li><a class="internal-link" href="#notes-linking-here">Notes linking here</a></li>
<li><a class="internal-link" href="#permalink">Permalink</a></li>
</ul>
</div>
<!--endtoc-->
<p><a target="_blank" href="https://konubinix.eu/braindump/posts/tag_learning_3d_printing/?title=tag_learning_3d_printing#">tag: learning 3D printing</a></p>
<ul>
<li>see,
<ul>
<li><a target="_blank" href="https://konubinix.eu/braindump/posts/board_with_a_single_microcontroller/?title=wemos_lolin_d1#wemos-lolin-d1">wemos d1</a>,</li>
</ul>
</li>
</ul>
<p>For our birthday, I wanted to create the <a target="_blank" href="https://konubinix.eu/braindump/posts/c%C5%93urs_connectes_d_heliox/?title=c%C5%93urs_connectes_d_heliox#">connected hearts from Heliox</a>.</p>
<h2 id="8d08dbae-b986-4319-93d4-2b3e95f147e8">Printing</h2>
<p>To be able to print it on my <a target="_blank" href="https://konubinix.eu/braindump/posts/labists_x1_mini/?title=labists_x1_mini#">labists x1 mini</a>, I need to shrink the model of
the heart. Hopefully I will still have room to put enough <a target="_blank" href="https://konubinix.eu/braindump/posts/led/?title=led#">LED</a> and the holes will
be big enough for the wires.</p>
<p>The heart is indeed too big.</p>
<figure><img src="https://konubinix.eu/ipfs/bafkreialuywydr7sp5lof6tdlxh2ebjvj7qr2qw4qrrd2h5oloof63ldsa?filename=a.png">
</figure>

<p>By rotating it, I can make go as far as 74% of the original size.</p>
<figure><img src="https://konubinix.eu/ipfs/bafkreibczlva3gtakdcf2xsjort4ciqmmqbgwpx6s4wib6zy7ti4pze2ke?filename=a.png">
</figure>

<figure><img src="https://konubinix.eu/ipfs/bafkreicujdonydz3umap2jt5tpbmxnwwcjz5q3afbdplslxhweolh3bqw4?filename=a.png">
</figure>

<p>Or, by removing the <a target="_blank" href="https://konubinix.eu/braindump/posts/3d_printing/?title=brim#brim">brim</a>, I can go up to 77%. Actually, since the heart is
mostly flat. I should be ok without brim.</p>
<p>Due to the fact it is mostly empty, I need to put some infill.</p>
<figure><img src="https://konubinix.eu/ipfs/bafybeibeb3ige6xfy3tscmw77tbmycpoangmukh2fjrovzsopfkcdizvaq?filename=a.png">
</figure>

<p>I don&rsquo;t know why, but the basement lap was kinda hard to print, due to the fact
it kept breaking. May be I printed it too cold (I used 210°C for a 200-230°C
<a target="_blank" href="https://konubinix.eu/braindump/posts/3d_printing/?title=filament#filament">filament</a>) or the wall was too thin (see <a target="_blank" href="https://konubinix.eu/braindump/posts/how_to_solve_cracking_or_breaking_of_layers_during_3d_printing/?title=how_to_solve_cracking_or_breaking_of_layers_during_3d_printing#">how to solve cracking or breaking of
layers during 3d printing</a>). I added infill anyway because I wanted the lap to be
strong after all.</p>
<figure><img src="https://konubinix.eu/ipfs/bafybeieeyxr7udd5jaykcnzkwo2hkdtn4pyvyi6rgwkdfi7xqhhpzyphbe?filename=a.png">
</figure>

<figure><img src="https://konubinix.eu/ipfs/bafybeiazw2mumg4fzlds3phemdpemy4uxgres2qzav67mibrfddirfksne?filename=a.png">
</figure>

<p>I also learned that <a target="_blank" href="https://konubinix.eu/braindump/posts/labists_x1_mini/?title=labists_x1_mini#">my printer</a> is definitely <a target="_blank" href="https://konubinix.eu/braindump/posts/why_does_my_model_shift/?title=why_does_my_model_shift#">not able to print very fast</a>.</p>
<figure><img src="https://konubinix.eu/ipfs/bafybeie5tzkougkjcrvwztrgbd3b4lq4otozzni7eifjgptorboyjlykwa?filename=a.png">
</figure>

<figure><img src="https://konubinix.eu/ipfs/bafybeifmof5k54jteuv3gazenohham6glfameytknchln4ja65oododd4y?filename=a.png">
</figure>

<p>The support itself did print quite easily</p>
<figure><img src="https://konubinix.eu/ipfs/bafybeidviacck3uerr754ou5j3v3odljxtz2wwehgpf73a5naumn5opt3m?filename=a.png">
</figure>

<p><span class="timestamp-wrapper"><span class="timestamp">[2021-08-05 Thu] </span></span> After some digging, the problem was due to the nozzle being <a target="_blank" href="https://konubinix.eu/braindump/posts/3d_printer_clogs_and_jams/?title=3d_printer_clogs_and_jams#">clogged</a>. Using some <a target="_blank" href="https://konubinix.eu/braindump/posts/cleaning_filament/?title=cleaning_filament#">cleaning filament</a> made it work great again.</p>
<h2 id="b26318b2-fff5-4f0e-a7e5-37ceabfba796">Assembling</h2>
<p>After printing and soldering, I tried uploading a basic blinking program.</p>
<p><video controls><source src="https://konubinix.eu/ipfs/bafybeiajjj3l452bzbeyfpx72x7ctm4xs7qbujrkiheka6sfp3qutprlbi?filename=210617_204721.webm" type="video/mp4">Your browser does not support the video tag.</video></p>
<p>Great! It works, now its time for programming.</p>
<h2 id="46c46342-694c-4d56-a162-21066a7b54d5">Setting up the arduino development environment</h2>
<ul>
<li>sudo apt install arduino</li>
<li>arduino</li>
<li>files -&gt; preferences -&gt; add the board configuration file <a target="_blank" href="http://arduino.esp8266.com/stable/package_esp8266com_index.json">http://arduino.esp8266.com/stable/package_esp8266com_index.json</a></li>
</ul>
<figure><img src="https://konubinix.eu/ipfs/bafkreicnpxsat2udyndacqc5qgqtpp3ra7ge2gnaingcutctcdjanrqkva?filename=a.png">
</figure>

<ul>
<li>tools -&gt; boards -&gt; board manager -&gt; search esp8266 and install</li>
</ul>
<figure><img src="https://konubinix.eu/ipfs/bafkreicnowijuft7etxahjmzn73gumv75sojxq6bv27vx5rv7r5th6vedy?filename=a.png">
</figure>

<ul>
<li>tools -&gt; boards -&gt; lolin(wemos d1) r2 &amp; mini</li>
<li>C-S-i -&gt; install neopixel</li>
</ul>
<figure><img src="https://konubinix.eu/ipfs/bafkreieytgqwz4fatgap2e36jlmg54pansyu5ng46ymjwn27za7derwpzm?filename=a.png">
</figure>

<ul>
<li>C-S-i -&gt; install arduino json (see later my custom program)</li>
</ul>
<figure><img src="https://konubinix.eu/ipfs/bafkreib4bxxaeqphwv6ctvxrjwrn4b2ic7rygbboy3agymulpd5lkz327i?filename=a.png">
</figure>

<ul>
<li>
<p>plug the wemos d1</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>$ dmesg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ 6336.833294] usb 1-2.1.4.3: new full-speed USB device number 18 using xhci_hcd
</span></span><span style="display:flex;"><span>[ 6336.934752] usb 1-2.1.4.3: New USB device found, idVendor=1a86, idProduct=7523, bcdDevice= 2.54
</span></span><span style="display:flex;"><span>[ 6336.934768] usb 1-2.1.4.3: New USB device strings: Mfr=0, Product=2, SerialNumber=0
</span></span><span style="display:flex;"><span>[ 6336.934775] usb 1-2.1.4.3: Product: USB2.0-Ser!
</span></span><span style="display:flex;"><span>[ 6336.943668] ch341 1-2.1.4.3:1.0: ch341-uart converter detected
</span></span><span style="display:flex;"><span>[ 6336.944489] ch341-uart ttyUSB0: break control not supported, using simulated break
</span></span><span style="display:flex;"><span>[ 6336.944684] usb 1-2.1.4.3: ch341-uart converter now attached to ttyUSB0
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ls -la /dev/ttyUSB0
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>crw-rw----+ 1 root dialout 188, 0 Oct 21 09:15 /dev/ttyUSB0
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo adduser sam dialout
</span></span></code></pre></div></li>
<li>
<p>tools -&gt; port -&gt; /dev/ttyUSB0</p>
</li>
<li>
<p>C-u when the program is ready
sometimes, it does not succeed in uploading the program, try again or use another usb port</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Build options changed, rebuilding all
</span></span><span style="display:flex;"><span>Archiving built core (caching) in: /tmp/arduino_cache_952883/core/core_esp8266_esp8266_d1_mini_xtal_80,vt_flash,exception_disabled,stacksmash_disabled,ssl_all,mmu_3232,non32xfer_fast,eesz_4M2M,ip_lm2f,dbg_Disabled,lvl_None____,wipe_none,baud_921600_97c7015af2bc8fe6734cc71dd43401e2.a
</span></span><span style="display:flex;"><span>Executable segment sizes:
</span></span><span style="display:flex;"><span>ICACHE : 32768           - flash instruction cache
</span></span><span style="display:flex;"><span>IROM   : 269584          - code in flash         (default or ICACHE_FLASH_ATTR)
</span></span><span style="display:flex;"><span>IRAM   : 27501   / 32768 - code in IRAM          (IRAM_ATTR, ISRs...)
</span></span><span style="display:flex;"><span>DATA   : 1508  )         - initialized variables (global, static) in RAM/HEAP
</span></span><span style="display:flex;"><span>RODATA : 1192  ) / 81920 - constants             (global, static) in RAM/HEAP
</span></span><span style="display:flex;"><span>BSS    : 25944 )         - zeroed variables      (global, static) in RAM/HEAP
</span></span><span style="display:flex;"><span>Sketch uses 299785 bytes (28%) of program storage space. Maximum is 1044464 bytes.
</span></span><span style="display:flex;"><span>Global variables use 28644 bytes (34%) of dynamic memory, leaving 53276 bytes for local variables. Maximum is 81920 bytes.
</span></span><span style="display:flex;"><span>esptool.py v3.0
</span></span><span style="display:flex;"><span>Serial port /dev/ttyUSB0
</span></span><span style="display:flex;"><span>Connecting....
</span></span><span style="display:flex;"><span>Chip is ESP8266EX
</span></span><span style="display:flex;"><span>Features: WiFi
</span></span><span style="display:flex;"><span>Crystal is 26MHz
</span></span><span style="display:flex;"><span>MAC: c4:5b:be:62:c2:db
</span></span><span style="display:flex;"><span>Uploading stub...
</span></span><span style="display:flex;"><span>Running stub...
</span></span><span style="display:flex;"><span>Stub running...
</span></span><span style="display:flex;"><span>Changing baud rate to 460800
</span></span><span style="display:flex;"><span>Changed.
</span></span><span style="display:flex;"><span>Configuring flash size...
</span></span><span style="display:flex;"><span>Auto-detected Flash size: 4MB
</span></span><span style="display:flex;"><span>Compressed 303936 bytes to 221951...
</span></span><span style="display:flex;"><span>Writing at 0x00000000... (7 %)
</span></span><span style="display:flex;"><span>Writing at 0x00004000... (14 %)
</span></span><span style="display:flex;"><span>Writing at 0x00008000... (21 %)
</span></span><span style="display:flex;"><span>Writing at 0x0000c000... (28 %)
</span></span><span style="display:flex;"><span>Writing at 0x00010000... (35 %)
</span></span><span style="display:flex;"><span>Writing at 0x00014000... (42 %)
</span></span><span style="display:flex;"><span>Writing at 0x00018000... (50 %)
</span></span><span style="display:flex;"><span>Writing at 0x0001c000... (57 %)
</span></span><span style="display:flex;"><span>Writing at 0x00020000... (64 %)
</span></span><span style="display:flex;"><span>Traceback (most recent call last):
</span></span><span style="display:flex;"><span>  File &#34;/home/sam/.arduino15/packages/esp8266/hardware/esp8266/3.0.2/tools/upload.py&#34;, line 66, in &lt;module&gt;
</span></span><span style="display:flex;"><span>    esptool.main(cmdline)
</span></span><span style="display:flex;"><span>  File &#34;/home/sam/.arduino15/packages/esp8266/hardware/esp8266/3.0.2/tools/esptool/esptool.py&#34;, line 3604, in main
</span></span><span style="display:flex;"><span>    operation_func(esp, args)
</span></span><span style="display:flex;"><span>  File &#34;/home/sam/.arduino15/packages/esp8266/hardware/esp8266/3.0.2/tools/esptool/esptool.py&#34;, line 2987, in write_flash
</span></span><span style="display:flex;"><span>    esp.flash_defl_block(block, seq, timeout=DEFAULT_TIMEOUT * ratio * 2)
</span></span><span style="display:flex;"><span>  File &#34;/home/sam/.arduino15/packages/esp8266/hardware/esp8266/3.0.2/tools/esptool/esptool.py&#34;, line 113, in inner
</span></span><span style="display:flex;"><span>    return func(*args, **kwargs)
</span></span><span style="display:flex;"><span>  File &#34;/home/sam/.arduino15/packages/esp8266/hardware/esp8266/3.0.2/tools/esptool/esptool.py&#34;, line 761, in flash_defl_block
</span></span><span style="display:flex;"><span>    self.check_command(&#34;write compressed data to flash after seq %d&#34; % seq,
</span></span><span style="display:flex;"><span>  File &#34;/home/sam/.arduino15/packages/esp8266/hardware/esp8266/3.0.2/tools/esptool/esptool.py&#34;, line 423, in check_command
</span></span><span style="display:flex;"><span>    raise FatalError.WithResult(&#39;Failed to %s&#39; % op_description, status_bytes)
</span></span><span style="display:flex;"><span>esptool.FatalError: Failed to write compressed data to flash after seq 8 (result was C100)
</span></span><span style="display:flex;"><span>esptool.FatalError: Failed to write compressed data to flash after seq 8 (result was C100)
</span></span></code></pre></div></li>
<li>
<p>C-S-M to debug the program</p>
</li>
</ul>
<h2 id="3049d260-a684-47af-be69-113db7a9e68a">Programming</h2>
<p>I disliked the initial code. It was too low level. Also, because of all the
trouble I had printing one heart, I did not have time for printing a second one.</p>
<p>So I decided that there would be only one heart, on the living room with each
side telling the emotion of one of us. This is great, since we always teach our
kids to tell, name and accept their emotions. It is for us a good opportunity to
practice what we try to teach them.</p>
<p>I decided that the weemos memory was enough to write a more elegant C++ code,
with classes. I still did not have much time, so here is the end result.</p>
<p>Basically, it connects to the Wifi and polls every few seconds an endpoint that
gives the color and intensity information for both sides of the heart.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;Arduino.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;Arduino_JSON.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;math.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;Adafruit_NeoPixel.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;ESP8266WiFi.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;ESP8266WiFiMulti.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;ESP8266HTTPClient.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;WiFiClient.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span>ESP8266WiFiMulti WiFiMulti;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">class </span><span style="color:#458;font-weight:bold">Command</span> {
</span></span><span style="display:flex;"><span> <span style="color:#000;font-weight:bold">public</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> r1;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> g1;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> b1;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> v1;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> r2;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> g2;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> b2;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> v2;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">connected</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">connect</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#458;font-weight:bold">WiFi</span>.mode(WIFI_STA);
</span></span><span style="display:flex;"><span>        WiFiMulti.addAP(<span style="color:#d14">&#34;yourwifissid&#34;</span>, <span style="color:#d14">&#34;yourwifipassword&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">refresh</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#458;font-weight:bold">bool</span> result <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">false</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> ((WiFiMulti.<span style="color:#900;font-weight:bold">run</span>() <span style="color:#000;font-weight:bold">==</span> WL_CONNECTED))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#900;font-weight:bold">connected</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">true</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#458;font-weight:bold">WiFiClient</span> client;
</span></span><span style="display:flex;"><span>                HTTPClient http;
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> (http.<span style="color:#900;font-weight:bold">begin</span>(client, <span style="color:#d14">&#34;http://192.168.1.46:9696/get&#34;</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#458;font-weight:bold">int</span> httpCode <span style="color:#000;font-weight:bold">=</span> http.GET();
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">if</span> (httpCode <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">if</span> (httpCode <span style="color:#000;font-weight:bold">==</span> HTTP_CODE_OK <span style="color:#000;font-weight:bold">||</span> httpCode <span style="color:#000;font-weight:bold">==</span> HTTP_CODE_MOVED_PERMANENTLY) {
</span></span><span style="display:flex;"><span>                            <span style="color:#458;font-weight:bold">String</span> payload <span style="color:#000;font-weight:bold">=</span> http.getString();
</span></span><span style="display:flex;"><span>                            JSONVar myArray <span style="color:#000;font-weight:bold">=</span> JSON.parse(payload);
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>r1 <span style="color:#000;font-weight:bold">=</span> myArray[<span style="color:#099">0</span>];
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>g1 <span style="color:#000;font-weight:bold">=</span> myArray[<span style="color:#099">1</span>];
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>b1 <span style="color:#000;font-weight:bold">=</span> myArray[<span style="color:#099">2</span>];
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>v1 <span style="color:#000;font-weight:bold">=</span> myArray[<span style="color:#099">3</span>];
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>r2 <span style="color:#000;font-weight:bold">=</span> myArray[<span style="color:#099">4</span>];
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>g2 <span style="color:#000;font-weight:bold">=</span> myArray[<span style="color:#099">5</span>];
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>b2 <span style="color:#000;font-weight:bold">=</span> myArray[<span style="color:#099">6</span>];
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>v2 <span style="color:#000;font-weight:bold">=</span> myArray[<span style="color:#099">7</span>];
</span></span><span style="display:flex;"><span>                            result <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">true</span>;
</span></span><span style="display:flex;"><span>                        } <span style="color:#000;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                            <span style="color:#458;font-weight:bold">Serial</span>.printf(<span style="color:#d14">&#34;Bad http code %d</span><span style="color:#d14">\n</span><span style="color:#d14">&#34;</span>, httpCode);
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    } <span style="color:#000;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#458;font-weight:bold">Serial</span>.printf(<span style="color:#d14">&#34;[HTTP] GET... failed, error: %s</span><span style="color:#d14">\n</span><span style="color:#d14">&#34;</span>, http.errorToString(httpCode).c_str());
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    http.<span style="color:#900;font-weight:bold">end</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#000;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#458;font-weight:bold">Serial</span>.printf(<span style="color:#d14">&#34;[HTTP} Unable to connect</span><span style="color:#d14">\n</span><span style="color:#d14">&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#458;font-weight:bold">Serial</span>.printf(<span style="color:#d14">&#34;Waiting for connection</span><span style="color:#d14">\n</span><span style="color:#d14">&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#900;font-weight:bold">connected</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">false</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">print</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#900;font-weight:bold">connected</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#458;font-weight:bold">Serial</span>.printf(<span style="color:#d14">&#34;r1: %d</span><span style="color:#d14">\n</span><span style="color:#d14">&#34;</span>, <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>r1);
</span></span><span style="display:flex;"><span>                <span style="color:#458;font-weight:bold">Serial</span>.printf(<span style="color:#d14">&#34;g1: %d</span><span style="color:#d14">\n</span><span style="color:#d14">&#34;</span>, <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>g1);
</span></span><span style="display:flex;"><span>                <span style="color:#458;font-weight:bold">Serial</span>.printf(<span style="color:#d14">&#34;b1: %d</span><span style="color:#d14">\n</span><span style="color:#d14">&#34;</span>, <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>b1);
</span></span><span style="display:flex;"><span>                <span style="color:#458;font-weight:bold">Serial</span>.printf(<span style="color:#d14">&#34;v1: %d</span><span style="color:#d14">\n</span><span style="color:#d14">&#34;</span>, <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>v1);
</span></span><span style="display:flex;"><span>                <span style="color:#458;font-weight:bold">Serial</span>.printf(<span style="color:#d14">&#34;r2: %d</span><span style="color:#d14">\n</span><span style="color:#d14">&#34;</span>, <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>r2);
</span></span><span style="display:flex;"><span>                <span style="color:#458;font-weight:bold">Serial</span>.printf(<span style="color:#d14">&#34;g2: %d</span><span style="color:#d14">\n</span><span style="color:#d14">&#34;</span>, <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>g2);
</span></span><span style="display:flex;"><span>                <span style="color:#458;font-weight:bold">Serial</span>.printf(<span style="color:#d14">&#34;b2: %d</span><span style="color:#d14">\n</span><span style="color:#d14">&#34;</span>, <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>b2);
</span></span><span style="display:flex;"><span>                <span style="color:#458;font-weight:bold">Serial</span>.printf(<span style="color:#d14">&#34;v2: %d</span><span style="color:#d14">\n</span><span style="color:#d14">&#34;</span>, <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>v2);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#458;font-weight:bold">Serial</span>.printf(<span style="color:#d14">&#34;Not connected</span><span style="color:#d14">\n</span><span style="color:#d14">&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">class </span><span style="color:#458;font-weight:bold">LEDStrip</span> {
</span></span><span style="display:flex;"><span> <span style="color:#000;font-weight:bold">public</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> pin;
</span></span><span style="display:flex;"><span>    Adafruit_NeoPixel strip;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">uint8_t</span> r;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">uint8_t</span> g;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">uint8_t</span> b;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">uint8_t</span> v;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">bool</span> isShowing;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">uint32_t</span> npixels;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    LEDStrip(<span style="color:#458;font-weight:bold">int</span> pin, <span style="color:#458;font-weight:bold">int</span> npixels) {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>pin <span style="color:#000;font-weight:bold">=</span> pin;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>npixels <span style="color:#000;font-weight:bold">=</span> npixels;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>strip <span style="color:#000;font-weight:bold">=</span> Adafruit_NeoPixel(npixels, pin, NEO_GRB <span style="color:#000;font-weight:bold">+</span> NEO_KHZ800);
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>isShowing <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">void</span> init() {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>strip.<span style="color:#900;font-weight:bold">begin</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>strip.<span style="color:#900;font-weight:bold">clear</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">void</span> set(<span style="color:#458;font-weight:bold">uint8_t</span> r, <span style="color:#458;font-weight:bold">uint8_t</span> g, <span style="color:#458;font-weight:bold">uint8_t</span> b, <span style="color:#458;font-weight:bold">uint8_t</span> v) {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>r <span style="color:#000;font-weight:bold">=</span> r;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>g <span style="color:#000;font-weight:bold">=</span> g;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>b <span style="color:#000;font-weight:bold">=</span> b;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>v <span style="color:#000;font-weight:bold">=</span> v;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>isShowing <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> (<span style="color:#458;font-weight:bold">int</span> n<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>; n<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>npixels; n<span style="color:#000;font-weight:bold">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>strip.setPixelColor(n, <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>strip.Color(<span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>r, <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>g, <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>b));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>strip.setBrightness(<span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>v);
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">-&gt;</span>strip.show();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LEDStrip <span style="color:#900;font-weight:bold">right</span>(<span style="color:#099">5</span>, <span style="color:#099">5</span>);
</span></span><span style="display:flex;"><span>LEDStrip <span style="color:#900;font-weight:bold">left</span>(<span style="color:#099">4</span>, <span style="color:#099">5</span>);
</span></span><span style="display:flex;"><span>Command command;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setup</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">Serial</span>.<span style="color:#900;font-weight:bold">begin</span>(<span style="color:#099">9600</span>);
</span></span><span style="display:flex;"><span>    command.<span style="color:#900;font-weight:bold">connect</span>();
</span></span><span style="display:flex;"><span>    right.init();
</span></span><span style="display:flex;"><span>    left.init();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">loop</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span>(command.refresh())
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            right.set(command.r2, command.g2, command.b2, command.v2);
</span></span><span style="display:flex;"><span>            left.set(command.r1, command.g1, command.b1, command.v1);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            right.set(<span style="color:#099">255</span>, <span style="color:#099">255</span>, <span style="color:#099">255</span>, <span style="color:#099">10</span>);
</span></span><span style="display:flex;"><span>            left.set(<span style="color:#099">255</span>, <span style="color:#099">255</span>, <span style="color:#099">255</span>, <span style="color:#099">10</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">delay</span>(<span style="color:#099">1000</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="d9866f82-8ada-4783-bd27-5e3b3d563393">The server code</h3>
<p>As you could see, the arduino code polls an IP address to get the color and
intensity information.</p>
<p>I did not want to depend on some external service like blink, so I host my own
service. Fortunately, using <a target="_blank" href="https://konubinix.eu/braindump/posts/flexx/?title=flexx#">flexx</a>, it is a piece of cake.</p>
<p>Here is the final code.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># -*- coding:utf-8 -*-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">json</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">logging</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">pathlib</span> <span style="color:#000;font-weight:bold">import</span> Path
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">tornado.web</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">flexx</span> <span style="color:#000;font-weight:bold">import</span> config, flx
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">redis</span> <span style="color:#000;font-weight:bold">import</span> StrictRedis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logging<span style="color:#000;font-weight:bold">.</span>basicConfig(level<span style="color:#000;font-weight:bold">=</span>logging<span style="color:#000;font-weight:bold">.</span>DEBUG)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>config<span style="color:#000;font-weight:bold">.</span>hostname <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;0.0.0.0&#34;</span>
</span></span><span style="display:flex;"><span>config<span style="color:#000;font-weight:bold">.</span>port <span style="color:#000;font-weight:bold">=</span> os<span style="color:#000;font-weight:bold">.</span>environ[<span style="color:#d14">&#34;IOTHEARTS_PORT&#34;</span>]
</span></span><span style="display:flex;"><span>config<span style="color:#000;font-weight:bold">.</span>tornado_debug <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>config<span style="color:#000;font-weight:bold">.</span>log_level <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;debug&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># trying to increase the timeout 20 -&gt; 60 to be resilient to wifi disruption</span>
</span></span><span style="display:flex;"><span>config<span style="color:#000;font-weight:bold">.</span>ws_timeout <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">60</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>__version__ <span style="color:#000;font-weight:bold">=</span> (Path(__file__)<span style="color:#000;font-weight:bold">.</span>parent <span style="color:#000;font-weight:bold">/</span> <span style="color:#d14">&#39;VERSION&#39;</span>)<span style="color:#000;font-weight:bold">.</span>read_text()
</span></span><span style="display:flex;"><span>db <span style="color:#000;font-weight:bold">=</span> StrictRedis(os<span style="color:#000;font-weight:bold">.</span>environ[<span style="color:#d14">&#34;SERVICEMESH_IP&#34;</span>], decode_responses<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">add_data</span>(path):
</span></span><span style="display:flex;"><span>    path <span style="color:#000;font-weight:bold">=</span> Path(__file__)<span style="color:#000;font-weight:bold">.</span>parent <span style="color:#000;font-weight:bold">/</span> <span style="color:#d14">&#34;assets&#34;</span> <span style="color:#000;font-weight:bold">/</span> path
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> flx<span style="color:#000;font-weight:bold">.</span>assets<span style="color:#000;font-weight:bold">.</span>add_shared_data(path<span style="color:#000;font-weight:bold">.</span>name, path<span style="color:#000;font-weight:bold">.</span>read_bytes())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MANIFEST <span style="color:#000;font-weight:bold">=</span> add_data(<span style="color:#d14">&#34;manifest.js&#34;</span>)
</span></span><span style="display:flex;"><span>ICON <span style="color:#000;font-weight:bold">=</span> add_data(<span style="color:#d14">&#34;icon.png&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PEACE <span style="color:#000;font-weight:bold">=</span> add_data(<span style="color:#d14">&#34;peace.png&#34;</span>)
</span></span><span style="display:flex;"><span>JOY <span style="color:#000;font-weight:bold">=</span> add_data(<span style="color:#d14">&#34;joy.png&#34;</span>)
</span></span><span style="display:flex;"><span>ANGER <span style="color:#000;font-weight:bold">=</span> add_data(<span style="color:#d14">&#34;anger.png&#34;</span>)
</span></span><span style="display:flex;"><span>LOVE <span style="color:#000;font-weight:bold">=</span> add_data(<span style="color:#d14">&#34;love.png&#34;</span>)
</span></span><span style="display:flex;"><span>SADNESS <span style="color:#000;font-weight:bold">=</span> add_data(<span style="color:#d14">&#34;sadness.png&#34;</span>)
</span></span><span style="display:flex;"><span>FEAR <span style="color:#000;font-weight:bold">=</span> add_data(<span style="color:#d14">&#34;fear.png&#34;</span>)
</span></span><span style="display:flex;"><span>LEFT <span style="color:#000;font-weight:bold">=</span> add_data(<span style="color:#d14">&#34;left.png&#34;</span>)
</span></span><span style="display:flex;"><span>RIGHT <span style="color:#000;font-weight:bold">=</span> add_data(<span style="color:#d14">&#34;right.png&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">GetColors</span>(tornado<span style="color:#000;font-weight:bold">.</span>web<span style="color:#000;font-weight:bold">.</span>RequestHandler):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>write(
</span></span><span style="display:flex;"><span>            json<span style="color:#000;font-weight:bold">.</span>dumps(
</span></span><span style="display:flex;"><span>                json<span style="color:#000;font-weight:bold">.</span>loads(db<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;color_tuple_LEFT&#34;</span>) <span style="color:#000;font-weight:bold">or</span> <span style="color:#d14">&#34;[0, 0, 0]&#34;</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>                json<span style="color:#000;font-weight:bold">.</span>loads(db<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;color_tuple_RIGHT&#34;</span>) <span style="color:#000;font-weight:bold">or</span> <span style="color:#d14">&#34;[0, 0, 0]&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">GetColors2</span>(tornado<span style="color:#000;font-weight:bold">.</span>web<span style="color:#000;font-weight:bold">.</span>RequestHandler):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">get</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>write(
</span></span><span style="display:flex;"><span>            json<span style="color:#000;font-weight:bold">.</span>dumps({
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;left&#34;</span>:
</span></span><span style="display:flex;"><span>                json<span style="color:#000;font-weight:bold">.</span>loads(db<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;color_tuple_LEFT&#34;</span>) <span style="color:#000;font-weight:bold">or</span> <span style="color:#d14">&#34;[0, 0, 0]&#34;</span>),
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;right&#34;</span>:
</span></span><span style="display:flex;"><span>                json<span style="color:#000;font-weight:bold">.</span>loads(db<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;color_tuple_RIGHT&#34;</span>) <span style="color:#000;font-weight:bold">or</span> <span style="color:#d14">&#34;[0, 0, 0]&#34;</span>),
</span></span><span style="display:flex;"><span>            }))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">serve</span>(app):
</span></span><span style="display:flex;"><span>    flx<span style="color:#000;font-weight:bold">.</span>App(app, icon<span style="color:#000;font-weight:bold">=</span>ICON)<span style="color:#000;font-weight:bold">.</span>serve()
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> app
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Manifest</span>(flx<span style="color:#000;font-weight:bold">.</span>JsComponent):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">init</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">global</span> window
</span></span><span style="display:flex;"><span>        manifest <span style="color:#000;font-weight:bold">=</span> window<span style="color:#000;font-weight:bold">.</span>document<span style="color:#000;font-weight:bold">.</span>createElement(<span style="color:#d14">&#39;link&#39;</span>)
</span></span><span style="display:flex;"><span>        manifest[<span style="color:#d14">&#34;rel&#34;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;manifest&#39;</span>
</span></span><span style="display:flex;"><span>        manifest[<span style="color:#d14">&#34;href&#34;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/&#34;</span> <span style="color:#000;font-weight:bold">+</span> MANIFEST
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">global</span> document
</span></span><span style="display:flex;"><span>        document<span style="color:#000;font-weight:bold">.</span>getElementsByTagName(<span style="color:#d14">&#39;head&#39;</span>)[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>appendChild(manifest)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Image</span>(flx<span style="color:#000;font-weight:bold">.</span>ImageWidget):
</span></span><span style="display:flex;"><span>    inner_color <span style="color:#000;font-weight:bold">=</span> flx<span style="color:#000;font-weight:bold">.</span>StringProp(settable<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_create_dom</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">global</span> window
</span></span><span style="display:flex;"><span>        outer <span style="color:#000;font-weight:bold">=</span> window<span style="color:#000;font-weight:bold">.</span>document<span style="color:#000;font-weight:bold">.</span>createElement(<span style="color:#d14">&#39;div&#39;</span>)
</span></span><span style="display:flex;"><span>        inner <span style="color:#000;font-weight:bold">=</span> window<span style="color:#000;font-weight:bold">.</span>document<span style="color:#000;font-weight:bold">.</span>createElement(<span style="color:#d14">&#39;img&#39;</span>)
</span></span><span style="display:flex;"><span>        inner<span style="color:#000;font-weight:bold">.</span>style<span style="color:#000;font-weight:bold">.</span>display <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;block&#34;</span>
</span></span><span style="display:flex;"><span>        inner<span style="color:#000;font-weight:bold">.</span>style<span style="color:#000;font-weight:bold">.</span>margin <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;auto&#34;</span>
</span></span><span style="display:flex;"><span>        inner<span style="color:#000;font-weight:bold">.</span>style<span style="color:#000;font-weight:bold">.</span>verticalAlign <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;middle&#34;</span>
</span></span><span style="display:flex;"><span>        outer<span style="color:#000;font-weight:bold">.</span>appendChild(inner)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> outer, inner
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@flx.reaction</span>(<span style="color:#d14">&#34;inner_color&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_inner_color</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>ev):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>inner_color:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>node<span style="color:#000;font-weight:bold">.</span>style<span style="color:#000;font-weight:bold">.</span>borderColor <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>inner_color
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>node<span style="color:#000;font-weight:bold">.</span>style<span style="color:#000;font-weight:bold">.</span>borderStyle <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;solid&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>node<span style="color:#000;font-weight:bold">.</span>style<span style="color:#000;font-weight:bold">.</span>borderWidth <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;2px&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@serve</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">IOTHearts</span>(flx<span style="color:#000;font-weight:bold">.</span>PyWidget):
</span></span><span style="display:flex;"><span>    CSS <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">.selected &gt; img {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">background-color: lightGrey;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    side <span style="color:#000;font-weight:bold">=</span> flx<span style="color:#000;font-weight:bold">.</span>EnumProp([<span style="color:#d14">&#34;LEFT&#34;</span>, <span style="color:#d14">&#34;RIGHT&#34;</span>], settable<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">init</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>set_side(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>session<span style="color:#000;font-weight:bold">.</span>get_cookie(<span style="color:#d14">&#34;side&#34;</span>) <span style="color:#000;font-weight:bold">or</span> <span style="color:#d14">&#34;LEFT&#34;</span>)
</span></span><span style="display:flex;"><span>        _ <span style="color:#000;font-weight:bold">=</span> Manifest()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">with</span> flx<span style="color:#000;font-weight:bold">.</span>VSplit():
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">with</span> flx<span style="color:#000;font-weight:bold">.</span>HFix(flex<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.1</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>left <span style="color:#000;font-weight:bold">=</span> Image(source<span style="color:#000;font-weight:bold">=</span>LEFT)
</span></span><span style="display:flex;"><span>                <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>right <span style="color:#000;font-weight:bold">=</span> Image(source<span style="color:#000;font-weight:bold">=</span>RIGHT)
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>slider <span style="color:#000;font-weight:bold">=</span> flx<span style="color:#000;font-weight:bold">.</span>Slider(<span style="color:#0086b3">min</span><span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>, <span style="color:#0086b3">max</span><span style="color:#000;font-weight:bold">=</span><span style="color:#099">255</span>, value<span style="color:#000;font-weight:bold">=</span><span style="color:#099">50</span>, flex<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.1</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">with</span> flx<span style="color:#000;font-weight:bold">.</span>HSplit(flex<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.9</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">with</span> flx<span style="color:#000;font-weight:bold">.</span>VSplit(flex<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.3</span>):
</span></span><span style="display:flex;"><span>                    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>joy_color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;#FFFF00&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>joy <span style="color:#000;font-weight:bold">=</span> Image(source<span style="color:#000;font-weight:bold">=</span>JOY)
</span></span><span style="display:flex;"><span>                    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>peace_color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;#00FF00&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>peace <span style="color:#000;font-weight:bold">=</span> Image(source<span style="color:#000;font-weight:bold">=</span>PEACE)
</span></span><span style="display:flex;"><span>                    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fear_color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;#222222&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fear <span style="color:#000;font-weight:bold">=</span> Image(source<span style="color:#000;font-weight:bold">=</span>FEAR)
</span></span><span style="display:flex;"><span>                <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color <span style="color:#000;font-weight:bold">=</span> flx<span style="color:#000;font-weight:bold">.</span>ColorSelectWidget(
</span></span><span style="display:flex;"><span>                    flex<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.9</span>,
</span></span><span style="display:flex;"><span>                    color<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>db_color,
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">with</span> flx<span style="color:#000;font-weight:bold">.</span>VSplit(flex<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0.3</span>):
</span></span><span style="display:flex;"><span>                    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>anger_color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;#FF0000&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>anger <span style="color:#000;font-weight:bold">=</span> Image(source<span style="color:#000;font-weight:bold">=</span>ANGER)
</span></span><span style="display:flex;"><span>                    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>sadness_color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;#0000FF&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>sadness <span style="color:#000;font-weight:bold">=</span> Image(source<span style="color:#000;font-weight:bold">=</span>SADNESS)
</span></span><span style="display:flex;"><span>                    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>love_color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;#ff00ff&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>love <span style="color:#000;font-weight:bold">=</span> Image(source<span style="color:#000;font-weight:bold">=</span>LOVE)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@flx.reaction</span>(<span style="color:#d14">&#34;anger.pointer_click&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_anger</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>event):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>set_color(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>anger_color)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@flx.reaction</span>(<span style="color:#d14">&#34;peace.pointer_click&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_peace</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>event):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>set_color(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>peace_color)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@flx.reaction</span>(<span style="color:#d14">&#34;joy.pointer_click&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_joy</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>event):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>set_color(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>joy_color)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@flx.reaction</span>(<span style="color:#d14">&#34;sadness.pointer_click&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_sadness</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>event):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>set_color(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>sadness_color)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@flx.reaction</span>(<span style="color:#d14">&#34;love.pointer_click&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_love</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>event):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>set_color(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>love_color)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@flx.reaction</span>(<span style="color:#d14">&#34;fear.pointer_click&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_fear</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>event):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>set_color(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>fear_color)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@property</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">db_color</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> db<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>key_hex) <span style="color:#000;font-weight:bold">or</span> <span style="color:#d14">&#34;#000&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@property</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">db_slider</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> db<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>key_slider) <span style="color:#000;font-weight:bold">or</span> <span style="color:#d14">&#34;50&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@property</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">key_hex</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">f</span><span style="color:#d14">&#34;color_hex_</span><span style="color:#d14">{</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>side<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@property</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">key_slider</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">f</span><span style="color:#d14">&#34;color_slider_</span><span style="color:#d14">{</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>side<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@property</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">key_tuple</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">f</span><span style="color:#d14">&#34;color_tuple_</span><span style="color:#d14">{</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>side<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@flx.reaction</span>(<span style="color:#d14">&#34;side&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">side_updated</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>event):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>left<span style="color:#000;font-weight:bold">.</span>set_css_class(<span style="color:#d14">&#34;selected&#34;</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>side <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;LEFT&#39;</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#d14">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>right<span style="color:#000;font-weight:bold">.</span>set_css_class(<span style="color:#d14">&#34;selected&#34;</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>side <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;RIGHT&#39;</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#d14">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>session<span style="color:#000;font-weight:bold">.</span>set_cookie(<span style="color:#d14">&#34;side&#34;</span>, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>side)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>set_color(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>db_color)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>slider<span style="color:#000;font-weight:bold">.</span>set_value(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>db_slider)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@flx.reaction</span>(<span style="color:#d14">&#34;left.pointer_click&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_left</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>event):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>set_side(<span style="color:#d14">&#39;LEFT&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@flx.reaction</span>(<span style="color:#d14">&#34;right.pointer_click&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_right</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>event):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>set_side(<span style="color:#d14">&#39;RIGHT&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@flx.reaction</span>(<span style="color:#d14">&#34;color.color&#34;</span>, <span style="color:#d14">&#34;slider.value&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">update_color</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>events):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#0086b3">isinstance</span>(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>color, <span style="color:#0086b3">str</span>):
</span></span><span style="display:flex;"><span>            color_tuple <span style="color:#000;font-weight:bold">=</span> [
</span></span><span style="display:flex;"><span>                <span style="color:#0086b3">int</span>(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>t[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">255</span>),
</span></span><span style="display:flex;"><span>                <span style="color:#0086b3">int</span>(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>t[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">255</span>),
</span></span><span style="display:flex;"><span>                <span style="color:#0086b3">int</span>(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>t[<span style="color:#099">2</span>] <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">255</span>),
</span></span><span style="display:flex;"><span>                <span style="color:#0086b3">int</span>(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>slider<span style="color:#000;font-weight:bold">.</span>value),
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>            db<span style="color:#000;font-weight:bold">.</span>set(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>key_hex, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>hex)
</span></span><span style="display:flex;"><span>            db<span style="color:#000;font-weight:bold">.</span>set(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>key_slider, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>slider<span style="color:#000;font-weight:bold">.</span>value)
</span></span><span style="display:flex;"><span>            db<span style="color:#000;font-weight:bold">.</span>set(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>key_tuple, json<span style="color:#000;font-weight:bold">.</span>dumps(color_tuple))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@flx.reaction</span>(<span style="color:#d14">&#34;color.color&#34;</span>, <span style="color:#d14">&#34;slider.value&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_set_heart_colors</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>ev):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>set_heart_colors()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@flx.action</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">set_heart_colors</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>left<span style="color:#000;font-weight:bold">.</span>set_inner_color(db<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#39;color_hex_LEFT&#39;</span>) <span style="color:#000;font-weight:bold">or</span> <span style="color:#d14">&#39;#000&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>right<span style="color:#000;font-weight:bold">.</span>set_inner_color(db<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#39;color_hex_RIGHT&#39;</span>) <span style="color:#000;font-weight:bold">or</span> <span style="color:#d14">&#39;#000&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">main</span>():
</span></span><span style="display:flex;"><span>    tornado_app <span style="color:#000;font-weight:bold">=</span> flx<span style="color:#000;font-weight:bold">.</span>current_server()<span style="color:#000;font-weight:bold">.</span>app
</span></span><span style="display:flex;"><span>    tornado_app<span style="color:#000;font-weight:bold">.</span>add_handlers(<span style="color:#d14">r</span><span style="color:#d14">&#34;.*&#34;</span>, [
</span></span><span style="display:flex;"><span>        (<span style="color:#d14">r</span><span style="color:#d14">&#34;/get&#34;</span>, GetColors),
</span></span><span style="display:flex;"><span>        (<span style="color:#d14">r</span><span style="color:#d14">&#34;/get2&#34;</span>, GetColors2),
</span></span><span style="display:flex;"><span>    ])
</span></span><span style="display:flex;"><span>    flx<span style="color:#000;font-weight:bold">.</span>start()
</span></span></code></pre></div><p>There is nothing fancy here, the interface looks like this</p>
<figure><img src="https://konubinix.eu/ipfs/bafkreida3lza3m4bck6drfjhgxn6wlckr3q4ezs4hln2e22l6fgtbxrsou?filename=a.png">
</figure>

<p>One can select per heart on the top (a cookie is used to remember the selection)
and select the wanted color clicking on the big rectangle. The colored monsters
are shortcut to select classical colors.</p>
<p>The idea of the colored monster to show ones emotion is from <a target="_blank" href="https://www.amazon.com/couleur-emotions-French-Anna-Llenas/dp/B00KBJP0FK">this great popup
book</a>.</p>
<p>The slider is used to control the intensity.</p>
<h2 id="fd956866-3e9f-4ed4-bf58-d49312f2a42c">Profiting</h2>
<figure><img src="https://konubinix.eu/ipfs/bafybeiadt6oeegrda2cdw6oerc7i5owmdoarplbsgfaio475tvdwmfkeam?filename=a.png">
</figure>

<figure><img src="https://konubinix.eu/ipfs/bafybeifsdcplcmlxymikvat62un2gsqplf7cub3v6gr6rdo4cpga53gcwi?filename=a.png">
</figure>

<p>It works great. Even the kids now ask us how we feel from time to time.</p>
<!--more-->
<h2 id="notes-linking-here">Notes linking here</h2>
<ul>
<li><a target="_blank" href="https://konubinix.eu/braindump/posts/interesting_projects_maybe_list/?title=3d_print_maybe_list#3d-print-maybe-list">3D print maybe list</a> (braindump)</li>
<li><a target="_blank" href="https://konubinix.eu/braindump/posts/iot_heart_again_with_micropython/?title=iot_heart_again_with_micropython#">IOT heart again, with micropython</a> (braindump)</li>
<li><a target="_blank" href="https://konubinix.eu/braindump/posts/more_clever_night_light/?title=second_idea_use_a_extra_neopixel_from_my_iot_heart_project#second-idea-use-a-extra-neopixel-from-my-iot-heart-project">second idea -&gt; use a extra neopixel from my IOT heart project</a> (braindump)</li>
<li><a target="_blank" href="https://konubinix.eu/braindump/posts/why_does_my_model_shift/?title=why_does_my_model_shift#">why does my model shift</a> (braindump)</li>
</ul>
<h2 id="permalink"><a class="internal-link" href="https://konubinix.eu/blog/aef14727-4ae8-40b4-85f3-f2fac4753de3?title=iot_heart">Permalink</a></h2>
  </article>
  <aside class="date"><time>Last updated: 03 Nov 2024</time></aside>
  <aside class="date"><time>Published&nbsp;&nbsp;&nbsp;: 31 May 2021</time></aside>
</main>
<hr/>
<footer>
  <nav class="footer-nav">
  <ul>
	<li><a class="internal-link" href="/blog/posts/"><i class="icon fas fa-blog"></i></a></li>
    <li><a target="_blank" href="/braindump/"><i class="fas fa-brain"></i></a></li>
    <li><a target="_blank" href="mailto:konubinixweb@gmail.com"><i class="fas fa-envelope-square"></i></a></li>
    <li><a target="_blank" href="https://github.com/konubinix"><i class="fab fa-github-square"></i></a></li>
    <li><a target="_blank" href="https://linkedin.com/in/samuel-loury-61259040"><i class="fab fa-linkedin"></i></a></li>
    <li><a class="internal-link" href="/blog/index.xml"><i class="fas fa-rss-square"></i></a></li>
	<li><a class="internal-link" href="/blog/tags/"><i class="fa fa-tag"></i></a></li>
    <li><a class="internal-link" href="/blog/blog_search"><i class="icon fa fa-search"></i></a></li>
  </ul>
</nav>

  <p>&copy; 2025 Samuel Loury</p>
</footer>
</body>
</html>
