<!DOCTYPE html>
<html><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="bLmaFyyXugiCqSup-eIIIx0B4CngtdF_svyMMKQbS5E" />
<script src="https://hypothes.is/embed.js" async></script>
<title>A Python Runtime on Android &middot; Konubinix&#39; Site</title>

<link rel="stylesheet" class="internal-link" href="/blog/css/main.min.8e2ccebba2bd2b151f513c5ea3c62a25d4614364fb0bc5a0261ccdc2b49f020047a52512e7e59e5d513e3aec1ed4fedb503d494c430c930053ef8f6c8a5d7d23.css" integrity="sha512-jizOu6K9KxUfUTxeo8YqJdRhQ2T7C8WgJhzNwrSfAgBHpSUS5&#43;WeXVE&#43;Ouwe1P7bUD1JTEMMkwBT749sil19Iw==" type="text/css" />


<link rel="stylesheet" target="_blank" href="/ipfs/QmQFVQS89fv1XUNFcjwCKDePzckuT9kpuAVNYUwNdEfYcv/css/all.css"/>
<link rel="stylesheet" class="internal-link" href="/blog/css/links.min.66488b1bd98835c9d323aceb9cb379cbdf615c46936837066b038781a80444ba.css"/>
<script type="text/javascript"
		src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<link rel="shortcut icon" target="_blank" href="/ipfs/QmVFwYV7YRZLKU3ybN1hW4jqfyZGPLKJwd8toN2wHz5UAD?a.png" type="image/x-icon" />

<body class="container"><header>
	<a class="internal-link" href="/blog//"><h5 class="site-title">Konubinix&#39; site</h5></a>
  <nav class="footer-nav">
  <ul>
	<li><a class="internal-link" href="/blog/posts/"><i class="icon fas fa-blog"></i></a></li>
    <li><a target="_blank" href="/braindump/"><i class="fas fa-brain"></i></a></li>
    <li><a target="_blank" href="mailto:konubinixweb@gmail.com"><i class="fas fa-envelope-square"></i></a></li>
    <li><a target="_blank" href="https://github.com/konubinix"><i class="fab fa-github-square"></i></a></li>
    <li><a target="_blank" href="https://linkedin.com/in/samuel-loury-61259040"><i class="fab fa-linkedin"></i></a></li>
    <li><a class="internal-link" href="/blog/index.xml"><i class="fas fa-rss-square"></i></a></li>
	<li><a class="internal-link" href="/blog/tags/"><i class="fa fa-tag"></i></a></li>
    <li><a class="internal-link" href="/blog/blog_search"><i class="icon fa fa-search"></i></a></li>
  </ul>
</nav>

</header>

<main>
  <header>
	<h1 class="underline">A Python Runtime on Android</h1>
	<span class="badge badge-pill badge-warning"><a class="internal-link" href="/blog/tags/fleeting/">Fleeting</a></span></header>
  <article>
	<ul>
<li>see also,
<ul>
<li><a target="_blank" href="/braindump/posts/android/?title=android#">Android</a>,</li>
<li><a target="_blank" href="/braindump/posts/java_classes_from_python/?title=java_classes_from_python#">java classes from python</a>,</li>
<li><a target="_blank" href="/braindump/posts/python/?title=python#">python</a>,</li>
</ul>
</li>
</ul>
<p>I want to get access to the <a target="_blank" href="/braindump/posts/android/?title=android#">android</a> <a target="_blank" href="/braindump/posts/java_classes_from_python/?title=java_classes_from_python#">java classes from python</a> and in particular
<a target="_blank" href="/braindump/posts/connect_android_and_a_board_with_a_single_microcontroller/?title=connect_android_and_a_board_with_a_single_microcontroller#">connect android and a board with a single microcontroller</a>, hence being able to
use something like <a target="_blank" href="https://github.com/jacklinquan/usbserial4a">https://github.com/jacklinquan/usbserial4a</a>. Although there
are several libraries that provide access to <a target="_blank" href="/braindump/posts/java_classes_from_python/?title=java_classes_from_python#">java classes from python</a>, this one
depends on <a target="_blank" href="/braindump/posts/java_classes_from_python/?title=pyjnius#pyjnius">pyjnius</a>. Creating a compatibility layer should not be that hard, but
I would rather avoid that, so I will prefer solution encompassing <a target="_blank" href="/braindump/posts/java_classes_from_python/?title=pyjnius#pyjnius">pyjnius</a>.</p>
<p>My final objective is to be able to quickly prototype DIY funny useless
electronic stuffs using old phones. To have a <a target="_blank" href="/braindump/posts/fast_feedback_loop/?title=fast_feedback_loop#">fast feedback loop</a>, I would
remotely control the phone (using <a target="_blank" href="/braindump/posts/rpyc/?title=rpyc#">rpyc</a><sup id="fnref:1"><a class="internal-link" href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>) from the comfort of my PC. The
phone would provide the battery, processing power and its classical hardware
(<a target="_blank" href="/braindump/posts/satellite_navigation/?title=satellite_navigation#">GNSS</a>, light&hellip;) while the <a target="_blank" href="/braindump/posts/microcontroller/?title=microcontroller#">microcontroller</a> would provide analog control to deal
with motors, sensors, etc. The phone would provide power to the MCU over USB
while communicating using serial interface. Because <a target="_blank" href="/braindump/posts/microcontroller/?title=esp8266#esp8266">ESP8266</a> and <a target="_blank" href="/braindump/posts/microcontroller/?title=esp32#esp32">ESP32</a> provide
wifi and bluetooth, this requirement might be put into question, but it still
makes sense when I want to use some disconnected boards like an <a target="_blank" href="/braindump/posts/board_with_a_single_microcontroller/?title=uno_r3#uno-r3">uno r3</a>.</p>
<p>I will likely need to install the phone application several times, so this
should be as easy as dropping a file in the sdcard and that&rsquo;s all.</p>
<p>I don&rsquo;t need a <a target="_blank" href="/braindump/posts/graphical_interface/?title=graphical_interface#">graphical interface</a>, only a mean to control it remotely<sup id="fnref:2"><a class="internal-link" href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.</p>
<p>I have access to a powerful arm mac or I can use my cheap amd64 pc. I&rsquo;d rather
use the former for it is muuuuch faster.</p>
<h2 id="7dd29850-733e-4d71-8472-6babe19d6220">trying using <a target="_blank" href="/braindump/posts/buildozer/?title=buildozer#">buildozer</a></h2>
<p>I have already played a lot in the past with <a target="_blank" href="/braindump/posts/kivy/?title=kivy#">kivy</a> and <a target="_blank" href="/braindump/posts/buildozer/?title=buildozer#">buildozer</a>. Also, this is
were <a target="_blank" href="/braindump/posts/java_classes_from_python/?title=pyjnius#pyjnius">pyjnius</a> was born. Therefore, this is the obvious first candidate.</p>
<p>I used to use the kivy/buildozer image in the past, but it seems abandoned
now. So let&rsquo;s follow the documentation using earthly to get the best of both
worlds: an evolving setup with the reproducibility of <a target="_blank" href="/braindump/posts/earthly/?title=earthly#">earthly</a>.</p>
<p>I did a lot of trials and errors to find a configuration that works. The variables where:</p>
<ul>
<li>arm mac or amd64 pc</li>
<li>ubuntu or debian
<ul>
<li>if ubuntu, 20.04 or 22.04</li>
</ul>
</li>
<li>opendjdk X for X in [17..21]</li>
<li>openjdk manually installed or via the package manager</li>
<li>the version of p4a, dev, release or default</li>
</ul>
<p>Here are all my trials. It took ages because the cache is very poorly handled
in buildozer/p4a, and I often needed to clean the cache folders to actually
understand what happened. Of course, cleaning the cache means very long
builds.</p>
<pre tabindex="0"><code class="language-earthfile" data-lang="earthfile">VERSION 0.8

IMPORT github.com/Konubinix/Earthfile AS e

generate:
    FROM e+debian-python-user-venv --packages=&#34;buildozer&#34; --extra_packages=&#34;sed&#34;
    WORKDIR /app
    ARG name=proofofconcept
    RUN buildozer init
    RUN sed -i -r \
        -e &#34;s/^(title = .+)$/title = ${name}/&#34; \
        -e &#34;s/^(package.name = .+)$/package.name = ${name}/&#34; \
        -e &#39;s/^(requirements = .+)$/\1,android,pil,rpyc,plyer,pyjnius   /&#39; \
        -e &#39;s/^(#android.permissions = .+)$/android.permissions = CAMERA,VIBRATE,INTERNET,READ_EXTERNAL_STORAGE,MANAGE_EXTERNAL_STORAGE/&#39; \
        buildozer.spec
    # RUN echo &#34;p4a.branch = v2024.01.21&#34; &gt;&gt; buildozer.spec
    SAVE ARTIFACT buildozer.spec AS LOCAL buildozer.spec

apk:
    # https://buildozer.readthedocs.io/en/latest/installation.html
    # on ubuntu 22.04, macos --platform amd64, jdk 17 =&gt; sdkmanager platform-tools -&gt; Warning: IO exception while downloading manifest
    #    replay with --verbose gives -&gt; java.security.NoSuchAlgorithmException: in sdkmanager
    # same with 20.04
    # on ubuntu 22.04, macos --platform amd64, jdk 18 =&gt; sdkmanager &#34;platforms-tools&#34; -&gt; too many errors (no more info in --verbose)
    # on ubuntu 22.04, macos --platform amd64, jdk 21 =&gt; sdkmanager &#34;platforms;android-31&#34; -&gt; too many errors, Core dumped (no more info in --verbose)
    # on ubuntu 22.04, macos --platform amd64, jdk 17 manually installed like briefcase =&gt; sdkmanager &#34;platforms-tools&#34; -&gt; too many errors (no more info in --verbose)
    # on debian, macos --platform amd64, jdk 17 manually installed like briefcase =&gt;
    # on debian, macos --platform arm64, jdk 17 manually installed like briefcase =&gt; Aidl cannot be executed You might have missed to install 32bits libs
    # on debian, linux amd64, jdk17 -&gt; ok
    #FROM ubuntu:22.04
    # hack to avoid 20.04 from asking for the timezone -&gt; https://github.com/microsoft/AirSim/issues/3877
        # ARG DEBIAN_FRONTEND=noninteractive
        # ENV TZ=Europe/Paris
        # RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone
    # end of hack
    # RUN apt update &amp;&amp; apt install -y git zip unzip openjdk-17-jdk python3-pip autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev
    # RUN apt install -y libffi-dev zlib1g-dev
    # RUN pip3 install --upgrade buildozer Cython==0.29.33 # virtualenv  # the --user should be removed if you do this in a venv
    FROM e+debian-python-user-venv --packages &#34;buildozer Cython==0.29.33&#34; --extra_packages=&#34;build-essential libssl-dev automake curl patch libffi-dev zlib1g-dev  openjdk-17-jdk git zip unzip python3-pip autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev&#34;
    USER root
    ENV VIRTUAL_ENV=y # to avoid ths --user
    # install jdk manually, cloning the bebavior of briefcase
        # RUN apt purge -y openjdk-17-jdk
        # RUN apt update &amp;&amp; apt install -y curl

        # ENV JDK_MAJOR_VER=17
        # ENV JDK_RELEASE=17.0.12
        # ENV JDK_BUILD=7
        # ENV JAVA_HOME=/opt/openjdk
        # ENV PATH=&#34;${JAVA_HOME}/bin:${PATH}&#34;

        # RUN curl --fail --silent --show-error --location -o /tmp/openjdk.tar.gz \
        #         https://github.com/adoptium/temurin${JDK_MAJOR_VER}-binaries/releases/download/jdk-${JDK_RELEASE}+${JDK_BUILD}/OpenJDK${JDK_MAJOR_VER}U-jdk_x64_linux_hotspot_${JDK_RELEASE}_${JDK_BUILD}.tar.gz &amp;&amp; \
        #     mkdir -p ${JAVA_HOME} &amp;&amp; \
        #     tar -xzf /tmp/openjdk.tar.gz -C ${JAVA_HOME} --strip-components=1 &amp;&amp; \
        #     rm /tmp/openjdk.tar.gz
    # end of install

    WORKDIR /app
    COPY --dir main.py /app
    ARG gen=yes
    IF test &#34;${gen}&#34; = &#34;yes&#34;
        COPY --dir +generate/buildozer.spec /app/
    ELSE
        COPY --dir ./buildozer.spec /app/
    END
    CACHE /root/.buildozer
    CACHE /app/.buildozer
    ARG cleanapp=no
    IF test &#34;${cleanapp}&#34; = &#34;yes&#34;
       RUN --no-cache rm -rf /app/.buildozer/*
    END
    ARG cleanroot=no
    IF test &#34;${cleanroot}&#34; = &#34;yes&#34;
       RUN --no-cache rm -rf /root/.buildozer/*
    END
    RUN apt update
    RUN apt install -y libltdl-dev
    RUN yes y | buildozer android debug | grep -vi download
    RUN mv bin/*apk app.apk
    SAVE ARTIFACT app.apk AS LOCAL app.apk
</code></pre><p>I somehow managed to get a build from some of those setups, but barely that I
could reproduce easily after cleaning everything.</p>
<p>In the end, the only setup that kinda worked without much hassle was the
officially documented one: amd64, ubuntu 22.04, and the recommended list of
packages. Too bad for the use of mac&hellip;</p>
<p>There are several great features that come with this setup:</p>
<ul>
<li>I can quickly prototype <a target="_blank" href="/braindump/posts/graphical_interface/?title=graphical_interface#">graphical interface</a> if need be by simply putting
python code in the sdcard</li>
<li>I don&rsquo;t actually need to bother with one for now,</li>
<li>it comes with <a target="_blank" href="/braindump/posts/kivy/?title=kivy#">kivy</a> that is very nice to use (if need be),</li>
<li>it does not expect some boilerplate code to run, only the spec file and the
code,</li>
</ul>
<p>I can even run the app as a <a target="_blank" href="/braindump/posts/python_for_android/?title=python_for_android#">service</a>, making it run in the background.</p>
<p>As a conclusion, it works and should continue working as long as kivy gets
some momentum. I had to play a lot with it and dig into several github issues
to find some solutions, so it was definitely not easy. But, it appears to
provide enough flexibility to adapt to my edge case pretty well.</p>
<h2 id="08d1ce63-2199-433f-9798-8d40c6d92197">trying with with <a target="_blank" href="/braindump/posts/briefcase/?title=briefcase#">briefcase</a></h2>
<p>This is the new kid in the block. It uses <a target="_blank" href="/braindump/posts/chaquopy/?title=chaquopy#">chaquopy</a>, that feels more curated
and less hacky than python-for-android, but younger and much less featureful.</p>
<p>Unfortunately, adding a built dependency such as <a target="_blank" href="/braindump/posts/java_classes_from_python/?title=pyjnius#pyjnius">pyjnius</a> appears to be hard.
Trying using it will raise: <code>I get &quot;Chaquopy cannot compile native code&quot;</code>.
They have no incentive making it available for they already provide <a target="_blank" href="https://chaquo.com/chaquopy/doc/current/python.html">an
alternative</a>. See how <a target="_blank" href="https://github.com/chaquo/chaquopy/issues/1230">jpype won&rsquo;t make it in there</a>. On the other hand, it might
be an hint that they want to curate a small subset of working libraries, so
that might be a good sign after all.</p>
<p>Also, it needs some boilerplate code and therefore might lead to a difficult
maintenance.</p>
<p>In addition, it comes with the graphical interface and it is not clear whether
I can avoid using it or not.</p>
<pre tabindex="0"><code class="language-earthfile" data-lang="earthfile">VERSION 0.8

IMPORT github.com/Konubinix/Earthfile AS e

generate:
    FROM e+debian-python-user-venv --packages &#34;briefcase&#34; --extra_packages=&#34;git&#34;
    WORKDIR /app
    RUN briefcase new --no-input
    RUN sed -i -r &#39;s/^requires = \[/requires = \[&#34;rpyc&#34;,/&#39; helloworld/pyproject.toml
    SAVE ARTIFACT helloworld AS LOCAL helloworld

apk:
    FROM --platform linux/amd64 e+debian-python-user-venv --packages &#34;briefcase&#34; --extra_packages=&#34;python3 git build-essential pkg-config python3-dev python3-venv&#34;
    WORKDIR /app
    # CACHE /app/build # is not updated automatically ?
    CACHE /home/sam/.cache
    CACHE /root/.gradle
    USER root # to get access to the cache
    ARG cleanapp=no
    IF apk &#34;${cleanapp}&#34; = &#34;yes&#34;
       RUN --no-cache rm -rf /home/sam/.cache/*
    END
    ARG cleanroot=no
    IF apk &#34;${cleanroot}&#34; = &#34;yes&#34;
       RUN --no-cache rm -rf /root/.gradle/*
    END
    ARG gen=yes
    IF test &#34;${gen}&#34; = &#34;yes&#34;
        COPY --dir +generate/helloworld /app/
    ELSE
        COPY --dir ./helloworld /app/
    END
    COPY --dir ./app.py /app/helloworld/src/helloworld/app.py
    WORKDIR /app/helloworld
    RUN yes y | briefcase create android --no-input
    RUN briefcase build android
    RUN mv /app/helloworld/build/helloworld/android/gradle/app/build/outputs/apk/debug/app-debug.apk app.apk
    SAVE ARTIFACT app.apk AS LOCAL app.apk
</code></pre><p>It will work in mac, with the amd64 emulation, so that&rsquo;s a plus. With arm64 it
will complain that &ldquo;Briefcase cannot install Android SDK on this machine.&rdquo;</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>earthly --no-cache +apk --cleanroot<span style="color:#000;font-weight:bold">=</span>yes --cleanapp<span style="color:#000;font-weight:bold">=</span>yes
</span></span></code></pre></div><p>Takes 13 minutes.</p>
<p>Let&rsquo;s replace the code of the app by the call to rpyc.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;&lt;</span>rpyc<span style="color:#000;font-weight:bold">.</span>org:serve<span style="color:#000;font-weight:bold">-</span>ex()<span style="color:#000;font-weight:bold">&gt;&gt;</span>
</span></span></code></pre></div><p>As the time of writing this, there is no way to run the application as a
service (<a target="_blank" href="https://github.com/beeware/briefcase/discussions/1553">https://github.com/beeware/briefcase/discussions/1553</a>).</p>
<p>As a conclusion, this technology is more opinionated about using the full
beeware stack and in particular running a toga application. It does this job
pretty well. But for edge cases like mine, it feels like it might not be a
good candidate.</p>
<h2 id="1a50f819-d95e-47e2-8072-9f13e8c4cd13">do it for real</h2>
<p>As per my previous experiments, I decided to use buildozer.</p>
<h3 id="22db0059-40b6-4350-9de7-e55019dc4aac">the build</h3>
<p>To be able to use my application as a target of &ldquo;share with&rdquo;, I have to provide the following intent filter</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;intent-filter&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;action</span> <span style="color:#008080">android:name=</span><span style="color:#d14">&#34;android.intent.action.SEND&#34;</span> <span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;category</span> <span style="color:#008080">android:name=</span><span style="color:#d14">&#34;android.intent.category.DEFAULT&#34;</span> <span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;data</span> <span style="color:#008080">android:mimeType=</span><span style="color:#d14">&#34;text/plain&#34;</span> <span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/intent-filter&gt;</span>
</span></span></code></pre></div><p>Now, let&rsquo;s create an application, adding a bunch of dependencies that I deem useful.</p>
<pre tabindex="0"><code class="language-earthfile" data-lang="earthfile">VERSION 0.8

IMPORT github.com/Konubinix/Earthfile AS e

generate:
    FROM e+debian-python-user-venv --packages=&#34;buildozer&#34; --extra_packages=&#34;sed&#34;
    WORKDIR /app
    ARG title=proofofconcept
    ARG name=konixpoc
    ARG domain=eu.konubinix
    RUN buildozer init
    # permissions taken from https://github.com/kivy/kivy-launcher/blob/main/buildozer.spec
    # plumbum is required by rpyc
    # I added several dependencies that I wish I add in my previous PoC, so that I will be able to use them when my current phone will become old see below my experiment with the wiko cink peax
    # some packages that I wanted but cannot build
    # - scipy needs lapack that needs fortran that needs a legacy ndk
    # - zmq fails https://github.com/kivy/python-for-android/issues/2706
    ARG extra=&#34;,able_recipe,dbus-next,usbserial4a,usb4a,Pillow,av,av_codecs,cryptography,ffpyplayer,ffpyplayer_codecs,matplotlib,pandas,pycryptodome,sqlite3,requests,numpy,opencv,opencv_extras&#34;
    RUN sed -i -r \
        -e &#34;s/^(title = .+)$/title = ${title}/&#34; \
        -e &#34;s/^(package.name = .+)$/package.name = ${name}/&#34; \
        -e &#34;s/^(package.domain = .+)$/package.domain = ${domain}/&#34; \
        -e &#34;s/^(requirements = .+)$/\1,android,plumbum,rpyc,plyer,pyjnius,oscpy,requests${extra}/&#34; \
        -e &#34;s/# android.accept_sdk_license = False/android.accept_sdk_license = True/&#34; \
        -e &#34;s/^#android.manifest.intent_filters =.*$/android.manifest.intent_filters = intent-filter.xml/&#34; \
        -e &#39;s/^(#android.permissions = .+)$/android.permissions = WRITE_CALL_LOG,READ_CALL_LOG,WRITE_CONTACTS,READ_CONTACTS,INTERACT_ACROSS_USERS_FULL,SEND_SMS,READ_SMS,RECEIVE_SMS,WRITE_SMS,READ_PHONE_STATE,RECORD_AUDIO,CAMERA,WRITE_SETTINGS,VIBRATE,MANAGE_EXTERNAL_STORAGE,READ_EXTERNAL_STORAGE,WRITE_EXTERNAL_STORAGE,ACCESS_LOCATION_EXTRA_COMMANDS,ACCESS_NETWORK_STATE,ACCESS_NOTIFICATION_POLICY,ACCESS_WIFI_STATE,BLUETOOTH,BLUETOOTH_ADMIN,BROADCAST_STICKY,CHANGE_NETWORK_STATE,CHANGE_WIFI_MULTICAST_STATE,CHANGE_WIFI_STATE,DISABLE_KEYGUARD,EXPAND_STATUS_BAR,FOREGROUND_SERVICE,GET_PACKAGE_SIZE,INSTALL_SHORTCUT,INTERNET,KILL_BACKGROUND_PROCESSES,MANAGE_OWN_CALLS,MODIFY_AUDIO_SETTINGS,NFC,READ_SYNC_SETTINGS,READ_SYNC_STATS,RECEIVE_BOOT_COMPLETED,REORDER_TASKS,REQUEST_COMPANION_RUN_IN_BACKGROUND,REQUEST_COMPANION_USE_DATA_IN_BACKGROUND,REQUEST_DELETE_PACKAGES,REQUEST_IGNORE_BATTERY_OPTIMIZATIONS,SET_ALARM,SET_WALLPAPER,SET_WALLPAPER_HINTS,TRANSMIT_IR,USE_FINGERPRINT,VIBRATE,WAKE_LOCK,WRITE_SYNC_SETTINGS,BLUETOOTH, BLUETOOTH_ADMIN, BLUETOOTH_SCAN, BLUETOOTH_CONNECT, BLUETOOTH_ADVERTISE, ACCESS_FINE_LOCATION/&#39; \
        -e &#34;s|^(#services = NAME:ENTRYPOINT_TO_PY,NAME2:ENTRYPOINT2_TO_PY)$|services = ${name}:./service.py:foreground:sticky|&#34; \
        buildozer.spec

    # -e &#34;s/^(fullscreen = .+)$/fullscreen = 1/&#34; \ to get the app in fullscreen mode
    # RUN echo &#34;p4a.branch = v2024.01.21&#34; &gt;&gt; buildozer.spec

    SAVE ARTIFACT buildozer.spec AS LOCAL buildozer.spec

apk:
    # https://buildozer.readthedocs.io/en/latest/installation.html
    FROM ubuntu:22.04
    ARG extra_deps=&#34;ccache&#34;
    ARG lzma_deps=&#34;autopoint&#34;
    RUN apt update &amp;&amp; apt install -y ${lzma_deps} ${extra_deps} git zip unzip openjdk-17-jdk python3-pip autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev
    RUN pip3 install --upgrade buildozer Cython==0.29.33 # virtualenv  # the --user should be removed if you do this in a venv
    WORKDIR /app
    CACHE --id root-buildozer /root/.buildozer
    CACHE /app/.buildozer
    CACHE /root/.gradle
    ARG cleanp4a=no
    IF test &#34;${cleanp4a}&#34; = &#34;yes&#34;
       RUN --no-cache rm -rf /app/.buildozer/android/platform/python-for-android/
    END
    ARG cleanapp=no
    IF test &#34;${cleanapp}&#34; = &#34;yes&#34;
       RUN --no-cache rm -rf /app/.buildozer/*
    END
    ARG cleanroot=no
    IF test &#34;${cleanroot}&#34; = &#34;yes&#34;
       RUN --no-cache rm -rf /root/.buildozer/* /root/.gradle/*
    END
    ARG gen=yes
    IF test &#34;${gen}&#34; = &#34;yes&#34;
        COPY --dir +generate/buildozer.spec /app/
    ELSE
        COPY --dir ./buildozer.spec /app/
    END
    COPY --dir service.py main.py intent-filter.xml /app
    # skip the download lines to avoid killing my pc with all the output
    RUN yes y | buildozer android debug | grep -vi download &amp;&amp; mv bin/*apk app.apk
    SAVE ARTIFACT app.apk AS LOCAL app.apk
</code></pre><p>Now, let&rsquo;s build it</p>
<p>Takes 35 minutes with no cache and 1 minute when the cache is warm and I only
edited a python file. 25 minutes with a warn /root. It generates a 40M apk.</p>
<p>And with all the dependencies:
1h30m with a cleanapp=yes but a fresh cache for the rest.
It generates a 150M apk.</p>
<h3 id="7c46451e-d2f4-4f80-a685-16eb4916a82e">the entrypoints</h3>
<p>I want the application to load whatever code I decided to put in the sdcard.</p>
<p>Therefore, I need to split the code in two: the part that will be run inside
the apk, and the part inside the sdcard. The former is responsible to find
and run the later.</p>
<h4 id="9af56295-dadf-41f0-8738-e5b92923d7d6">inside the apk</h4>
<p>The main application will try to find /sdcard/poc/poc.py:main()</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">sys</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">jnius</span> <span style="color:#000;font-weight:bold">import</span> autoclass
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">pathlib</span> <span style="color:#000;font-weight:bold">import</span> Path
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">android.permissions</span> <span style="color:#000;font-weight:bold">import</span> request_permissions, Permission
</span></span><span style="display:flex;"><span>request_permissions([Permission<span style="color:#000;font-weight:bold">.</span>WRITE_EXTERNAL_STORAGE,Permission<span style="color:#000;font-weight:bold">.</span>READ_EXTERNAL_STORAGE])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;STARTED MAIN&#34;</span>)
</span></span><span style="display:flex;"><span>Environment <span style="color:#000;font-weight:bold">=</span> autoclass(<span style="color:#d14">&#39;android.os.Environment&#39;</span>)
</span></span><span style="display:flex;"><span>sys<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>append(<span style="color:#0086b3">str</span>(Path(Environment<span style="color:#000;font-weight:bold">.</span>getExternalStorageDirectory()<span style="color:#000;font-weight:bold">.</span>absolutePath) <span style="color:#000;font-weight:bold">/</span> <span style="color:#d14">&#34;poc&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">poc</span> <span style="color:#000;font-weight:bold">import</span> main
</span></span><span style="display:flex;"><span>main()
</span></span></code></pre></div><p>I did not put any wait on the permissions, therefore, it will likely crash
the first time will you press the accept button and work the second time.</p>
<p>Also, if you are running android 10+, you will have to accept that the application has access to the sdcard.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>clk android adb shell appops <span style="color:#0086b3">set</span> --uid eu.konubinix.konixpoc MANAGE_EXTERNAL_STORAGE allow
</span></span></code></pre></div><p>For more information, see the <a class="internal-link" href="#2217d655-6b01-4460-8e5e-89ae3f68a908">note about accessing the files</a>.</p>
<p>The service will try to run /sdcard/poc/poc.py:service()</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">sys</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">jnius</span> <span style="color:#000;font-weight:bold">import</span> autoclass
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">pathlib</span> <span style="color:#000;font-weight:bold">import</span> Path
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(<span style="color:#d14">f</span><span style="color:#d14">&#34;STARTED SERVICE -&gt; </span><span style="color:#d14">{</span>os<span style="color:#000;font-weight:bold">.</span>environ[<span style="color:#d14">&#39;PYTHON_SERVICE_ARGUMENT&#39;</span>]<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>)
</span></span><span style="display:flex;"><span>Environment <span style="color:#000;font-weight:bold">=</span> autoclass(<span style="color:#d14">&#39;android.os.Environment&#39;</span>)
</span></span><span style="display:flex;"><span>sys<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>append(<span style="color:#0086b3">str</span>(Path(Environment<span style="color:#000;font-weight:bold">.</span>getExternalStorageDirectory()<span style="color:#000;font-weight:bold">.</span>absolutePath) <span style="color:#000;font-weight:bold">/</span> <span style="color:#d14">&#34;poc&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">poc</span> <span style="color:#000;font-weight:bold">import</span> service
</span></span><span style="display:flex;"><span>service()
</span></span></code></pre></div><h4 id="43796a9c-6b5f-4678-b9ee-31de0d54aeeb">inside the sdcard</h4>
<p>Now, you can put whatever you want in the main() and service() functions in /sdcard/poc/poc.py</p>
<p>I personally decided to split the main and service code in separate modules.</p>
<p>Therefore, I created a directory <em>sdcard/poc/app</em> in which I put the service and the main code.</p>
<p>My entry point (/sdcard/poc/poc.py) looks like this</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">main</span>(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">from</span> <span style="color:#555">app</span> <span style="color:#000;font-weight:bold">import</span> main
</span></span><span style="display:flex;"><span>    main<span style="color:#000;font-weight:bold">.</span>run()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">service</span>(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">from</span> <span style="color:#555">app</span> <span style="color:#000;font-weight:bold">import</span> service
</span></span><span style="display:flex;"><span>    service<span style="color:#000;font-weight:bold">.</span>run()
</span></span></code></pre></div><p>Then, I created a main that simply runs the service and exits.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">run</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">from</span> <span style="color:#555">jnius</span> <span style="color:#000;font-weight:bold">import</span> autoclass
</span></span><span style="display:flex;"><span>    service <span style="color:#000;font-weight:bold">=</span> autoclass(<span style="color:#d14">&#39;eu.konubinix.konixpoc.ServiceKonixpoc&#39;</span>)
</span></span><span style="display:flex;"><span>    mActivity <span style="color:#000;font-weight:bold">=</span> autoclass(<span style="color:#d14">&#39;org.kivy.android.PythonActivity&#39;</span>)<span style="color:#000;font-weight:bold">.</span>mActivity
</span></span><span style="display:flex;"><span>    argument <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;FOOBAR&#34;</span>
</span></span><span style="display:flex;"><span>    service<span style="color:#000;font-weight:bold">.</span>start(mActivity, <span style="color:#d14">&#39;presplash&#39;</span>, <span style="color:#d14">&#39;title&#39;</span>, <span style="color:#d14">&#39;content&#39;</span>, argument)
</span></span></code></pre></div><p>To make my android a remotely controlled device, I will simply run rpyc.</p>
<p>Note that I need to import a few stuff for rpyc to correctly provide them
afterwards. I learn along the way and add them when I realize I need them.</p>
<p>I like being notified when the service is ready, hence the vibration
at the beginning.</p>
<p>About <code>PythonService.mService.setAutoRestartService(True)</code>, your mileage may
vary. I decided that I wanted a long running service and not bother
restarting it. This is also why I defined it as foreground and sticky in the
<a target="_blank" href="/braindump/posts/buildozer/?title=buildozer#">buildozer</a> definition.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">sys</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">jnius</span> <span style="color:#000;font-weight:bold">import</span> autoclass
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">pathlib</span> <span style="color:#000;font-weight:bold">import</span> Path
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># I need to start using at least one function of plyer from here, otherwise,</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># when controlling from rpyc, it will raise notimplementederror</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">plyer</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Same, trigger the load from here so that rpyc is ok</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># from usbserial4a import serial4a</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># from able import BluetoothDispatcher, GATT_SUCCESS</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">run</span>():
</span></span><span style="display:flex;"><span>    plyer<span style="color:#000;font-weight:bold">.</span>vibrator<span style="color:#000;font-weight:bold">.</span>vibrate()
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">f</span><span style="color:#d14">&#34;STARTED SERVICE POC -&gt; </span><span style="color:#d14">{</span>os<span style="color:#000;font-weight:bold">.</span>environ[<span style="color:#d14">&#39;PYTHON_SERVICE_ARGUMENT&#39;</span>]<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic"># see https://python-for-android.readthedocs.io/en/develop/services.html</span>
</span></span><span style="display:flex;"><span>    Environment <span style="color:#000;font-weight:bold">=</span> autoclass(<span style="color:#d14">&#39;android.os.Environment&#39;</span>)
</span></span><span style="display:flex;"><span>    PythonService <span style="color:#000;font-weight:bold">=</span> autoclass(<span style="color:#d14">&#39;org.kivy.android.PythonService&#39;</span>)
</span></span><span style="display:flex;"><span>    PythonService<span style="color:#000;font-weight:bold">.</span>mService<span style="color:#000;font-weight:bold">.</span>setAutoRestartService(<span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>    rpyc()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">rpyc</span>():
</span></span><span style="display:flex;"><span>    nil
</span></span></code></pre></div><h3 id="95dd17b0-db04-45e6-a07d-7aba1e9a91b8">make it shine!</h3>
<p>As described in the <a class="internal-link" href="#2217d655-6b01-4460-8e5e-89ae3f68a908">note about accessing the files</a>, from android 10, you
need to explicitly give the consent for the application to access the files.</p>
<p>This can be done from the command line.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>clk android adb shell appops <span style="color:#0086b3">set</span> --uid eu.konubinix.konixpoc MANAGE_EXTERNAL_STORAGE allow
</span></span></code></pre></div><p>Or from the dedicated graphical interface that you will find in the settings.</p>
<p>I personally start it with</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>clk android adb shell am start -a android.settings.MANAGE_ALL_FILES_ACCESS_PERMISSION
</span></span></code></pre></div><p>Then, you can run the application.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>clk android adb shell am start -n eu.konubinix.konixpoc/org.kivy.android.PythonActivity
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Starting: Intent { cmp=eu.konubinix.konixpoc/org.kivy.android.PythonActivity }
</span></span></code></pre></div><p>And to stop it</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>clk android adb shell am force-stop eu.konubinix.konixpoc
</span></span></code></pre></div><p>You should feel the phone vibrating and the</p>
<h3 id="3cfe583a-1c71-420d-ab33-39f6a660d633">to run a graphical user interface</h3>
<p>Pick whatever example from <a target="_blank" href="https://github.com/kivy/kivy/tree/master/examples">https://github.com/kivy/kivy/tree/master/examples</a> and put it in
/sdcard/poc/app/myexample</p>
<p>As long as the app loads this example, you should be good to go.</p>
<p>While trying this, I found several limitations though.</p>
<ol>
<li>the audio example makes the application crash after the first sound is played, (looks linked to kivy on android),</li>
<li>the demo/showcase fails because kivy.extras.highlight.KivyLexer is not part of the build</li>
<li>the demo/multistroke fails because either kivy does not find the .kv
files, or it does not manage to import the historymanager. The later is
easily fixed with appending the path to sys.path, but I don&rsquo;t know yet how
to fix the former. It might not be a big deal, but not something I want to
tackle for now.</li>
</ol>
<p>As long as the application is quite simple, I suppose this should work.</p>
<p>For instance, take the <a target="_blank" href="https://github.com/kivy/kivy/tree/2.3.0/examples/demo/pictures">demo/pictures</a> one, drop it in /sdcard/poc/app/pictures
and make the main.py:run() code load this example.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">run</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">from</span> <span style="color:#555">.pictures.main</span> <span style="color:#000;font-weight:bold">import</span> PicturesApp
</span></span><span style="display:flex;"><span>    PicturesApp()<span style="color:#000;font-weight:bold">.</span>run()
</span></span></code></pre></div><p>It works without issue on my <a target="_blank" href="/braindump/posts/nexus_5x/?title=nexus_5x#">bullhead</a></p>
<figure><img src="https://ipfs.konubinix.eu/ipfs/bafkreigbbesqt5bigx2p6q2nmp25wyjbgwsemtv65x7x47ywik3d76loma?filename=a.png">
</figure>

<h2 id="2217d655-6b01-4460-8e5e-89ae3f68a908">note about accessing the files</h2>
<p>Before android 10, an application could read and write the sdcard, provided
the application asked for it.</p>
<p>Introduced in 10 and enforced in 11, now applications have to use the <a target="_blank" href="/braindump/posts/android_11_scoped_storage/?title=android_11_scoped_storage#">scoped
storage</a>, in which the application won&rsquo;t directly access the files, but asks
the user for files using dedicated intents.</p>
<p>Fortunately, there is still a way to circumvent this, using
MANAGE_EXTERNAL_STORAGE that provides file access to the application. It was
meant for applications that needs to get them, because it does not make sense
otherwise, like antivirus. In my mind, this is one of those use cases.</p>
<p>Once installed, one needs to find the setting to &ldquo;allow access to all files&rdquo;
in android to allow the application.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>clk android adb shell am start -a android.settings.MANAGE_ALL_FILES_ACCESS_PERMISSION
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Starting: Intent { act=android.settings.MANAGE_ALL_FILES_ACCESS_PERMISSION }
</span></span></code></pre></div><figure><img src="https://ipfs.konubinix.eu/ipfs/bafkreiebwqrwwdrwtebebhyo5gipvmrdg7ajcd3frs3ihebv5e7a6tismq?filename=a.png">
</figure>

<p>You can do this automatically</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>clk android adb shell appops <span style="color:#0086b3">set</span> --uid eu.konubinix.konixpoc MANAGE_EXTERNAL_STORAGE allow
</span></span></code></pre></div><p>Doing this, you can continue loading a python module from the sdcard and get a
very <a target="_blank" href="/braindump/posts/fast_feedback_loop/?title=fast_feedback_loop#">fast feedback loop</a>.</p>
<h2 id="a98fae08-a7da-49a8-95ff-2a2c87332450">note about permissions</h2>
<p>Apart from the more specific case of MANAGE_EXTERNAL_STORAGE, you can grant
permission from the command line using commands such as</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>clk android adb shell pm grant eu.konubinix.konixpoc android.permission.CAMERA
</span></span><span style="display:flex;"><span>clk android adb shell pm grant eu.konubinix.konixpoc android.permission.READ_SMS
</span></span><span style="display:flex;"><span>clk android adb shell pm grant eu.konubinix.konixpoc android.permission.SEND_SMS
</span></span><span style="display:flex;"><span>clk android adb shell pm grant eu.konubinix.konixpoc android.permission.WRITE_EXTERNAL_STORAGE
</span></span></code></pre></div><p>See more at <a target="_blank" href="/braindump/posts/android/?title=list_and_grant_permissions_from_an_application#list-and-grant-permissions-from-an-application">list and grant permissions from an application</a>.</p>
<h2 id="1f4fc0a4-ceff-4973-9e09-a2bd5d9b3670">trying with an arduino board</h2>
<p>Using an <a target="_blank" href="/braindump/posts/board_with_a_single_microcontroller/?title=uno_r3#uno-r3">UNO R3</a> and the code from <a target="_blank" href="/braindump/posts/connect_android_and_a_board_with_a_single_microcontroller/?title=with_arduino#with-arduino">with arduino</a>.</p>
<p>Now, let&rsquo;s try to play with it from the comfort of my computer, while plugged
on my phone.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">rpyc</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>c <span style="color:#000;font-weight:bold">=</span> rpyc<span style="color:#000;font-weight:bold">.</span>classic<span style="color:#000;font-weight:bold">.</span>connect(ip, <span style="color:#0086b3">int</span>(port))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>usb <span style="color:#000;font-weight:bold">=</span> c<span style="color:#000;font-weight:bold">.</span>modules<span style="color:#000;font-weight:bold">.</span>usb4a<span style="color:#000;font-weight:bold">.</span>usb
</span></span><span style="display:flex;"><span>serial4a <span style="color:#000;font-weight:bold">=</span> c<span style="color:#000;font-weight:bold">.</span>modules<span style="color:#000;font-weight:bold">.</span>usbserial4a<span style="color:#000;font-weight:bold">.</span>serial4a
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">pprint</span> <span style="color:#000;font-weight:bold">import</span> pprint
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>usb_device_list <span style="color:#000;font-weight:bold">=</span> usb<span style="color:#000;font-weight:bold">.</span>get_usb_device_list()
</span></span><span style="display:flex;"><span>usb_device_name_list <span style="color:#000;font-weight:bold">=</span> [device<span style="color:#000;font-weight:bold">.</span>getDeviceName() <span style="color:#000;font-weight:bold">for</span> device <span style="color:#000;font-weight:bold">in</span> usb_device_list]
</span></span><span style="display:flex;"><span>usb_device_dict <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>    device<span style="color:#000;font-weight:bold">.</span>getDeviceName():[            <span style="color:#998;font-style:italic"># Device name</span>
</span></span><span style="display:flex;"><span>        device<span style="color:#000;font-weight:bold">.</span>getVendorId(),           <span style="color:#998;font-style:italic"># Vendor ID</span>
</span></span><span style="display:flex;"><span>        device<span style="color:#000;font-weight:bold">.</span>getManufacturerName(),   <span style="color:#998;font-style:italic"># Manufacturer name</span>
</span></span><span style="display:flex;"><span>        device<span style="color:#000;font-weight:bold">.</span>getProductId(),          <span style="color:#998;font-style:italic"># Product ID</span>
</span></span><span style="display:flex;"><span>        device<span style="color:#000;font-weight:bold">.</span>getProductName()         <span style="color:#998;font-style:italic"># Product name</span>
</span></span><span style="display:flex;"><span>    ] <span style="color:#000;font-weight:bold">for</span> device <span style="color:#000;font-weight:bold">in</span> usb_device_list
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>pprint(usb_device_dict)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>portstr <span style="color:#000;font-weight:bold">=</span> usb_device_list[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>getDeviceName()
</span></span><span style="display:flex;"><span>device <span style="color:#000;font-weight:bold">=</span> usb<span style="color:#000;font-weight:bold">.</span>get_usb_device(portstr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> usb<span style="color:#000;font-weight:bold">.</span>has_usb_permission(device):
</span></span><span style="display:flex;"><span>    usb<span style="color:#000;font-weight:bold">.</span>request_usb_permission(device)
</span></span><span style="display:flex;"><span>    exit(<span style="color:#099">0</span>) <span style="color:#998;font-style:italic"># needs to wait for the user input before going further</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>serial_port <span style="color:#000;font-weight:bold">=</span> serial4a<span style="color:#000;font-weight:bold">.</span>get_serial_port(
</span></span><span style="display:flex;"><span>    portstr,
</span></span><span style="display:flex;"><span>    <span style="color:#099">9600</span>,   <span style="color:#998;font-style:italic"># Baudrate</span>
</span></span><span style="display:flex;"><span>    <span style="color:#099">8</span>,      <span style="color:#998;font-style:italic"># Number of data bits(5, 6, 7 or 8)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#39;N&#39;</span>,    <span style="color:#998;font-style:italic"># Parity(&#39;N&#39;, &#39;E&#39;, &#39;O&#39;, &#39;M&#39; or &#39;S&#39;)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#099">1</span>,      <span style="color:#998;font-style:italic"># Number of stop bits(1, 1.5 or 2)</span>
</span></span><span style="display:flex;"><span>    timeout<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> serial_port<span style="color:#000;font-weight:bold">.</span>is_open:
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;Serial port not open, that&#39;s strange&#34;</span>)
</span></span><span style="display:flex;"><span>    exit(<span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>serial_port<span style="color:#000;font-weight:bold">.</span>write(<span style="color:#d14">b</span><span style="color:#d14">&#39;Hello world!&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>([line<span style="color:#000;font-weight:bold">.</span>decode()<span style="color:#000;font-weight:bold">.</span>strip() <span style="color:#000;font-weight:bold">for</span> line <span style="color:#000;font-weight:bold">in</span> serial_port<span style="color:#000;font-weight:bold">.</span>readlines()])
</span></span><span style="display:flex;"><span>serial_port<span style="color:#000;font-weight:bold">.</span>close()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{&#39;/dev/bus/usb/001/002&#39;: [9025, &#39;Arduino (www.arduino.cc)&#39;, 67, None]}
</span></span><span style="display:flex;"><span>[&#39;Received: H&#39;, &#39;Received: e&#39;, &#39;Received: l&#39;, &#39;Received: l&#39;, &#39;Received: o&#39;, &#39;Received:&#39;, &#39;Received: w&#39;, &#39;Received: o&#39;, &#39;Received: r&#39;, &#39;Received: l&#39;, &#39;Received: d&#39;, &#39;Received: !&#39;]
</span></span></code></pre></div><p>That rocks !</p>
<h2 id="c43ce607-aae5-4f08-bfb5-dfbf38fc9eb9">note about building on old phones</h2>
<p>To build for android 4, <a target="_blank" href="/braindump/posts/openai/?title=chatgpt#chatgpt">chatgpt</a> tells me that I need to target the API 19 (from 14 to 19) and ndk 19, the <a target="_blank" href="/braindump/posts/android/?title=sdkmanager#sdkmanager">sdkmanager</a> teels me that</p>
<blockquote>
<p>+apk | [WARNING]: Target API 19 &lt; 30
+apk | [WARNING]: Target APIs lower than 30 are no longer supported on Google Play, and are not recommended.</p>
</blockquote>
<p>Not being able to easily recreated an old apk incites me to create a very
generic application with as many useful dependencies as needed and allowing to
drop some files to the sdcard and archive it. That way, I can get back to an
old phone when I want instead of throwing them away.</p>
<p>Even so, the differences of versions of python/rpyc etc will most likely make
this difficult, but at least I will be able to try.</p>
<h2 id="b337b18b-84bf-4cee-8294-3e42b211623f">archiving for later</h2>
<p>Because building on old phones might be difficult, let&rsquo;s try to build one and
keep it for later.</p>
<h3 id="ec79821e-c81a-4296-960b-c98c01cdd46d">with sdk 31, ndk 23b</h3>
<h4 id="895f21cc-4b6f-438b-bcad-f6fb6375e376">without extras</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#  # --config /dev/null</span>
</span></span><span style="display:flex;"><span>earthly +apk --extra<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;&#34;</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> ipfa app.apk <span style="color:#000;font-weight:bold">&amp;&amp;</span> du -sh app.apk
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[[https://ipfs.konubinix.eu/ipfs/bafybeicyhehwkvb5w6ibh3zzyu733xewk6senzffni6eteubqex7tkjpjq?filename=app.apk][app.apk]]
</span></span><span style="display:flex;"><span>35M	app.apk
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#  # --config /dev/null</span>
</span></span><span style="display:flex;"><span>earthly +generate --extra<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;&#34;</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> ipfa buildozer.spec
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[[https://ipfs.konubinix.eu/ipfs/bafkreihugxllplw3uoj6sj7xrbzu66zici32g7gnjj3bhcas5fovuo4lbm?filename=buildozer.spec][buildozer.spec]]
</span></span></code></pre></div><h4 id="633efb88-2314-418f-9593-844e916c0031">with extras</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># --config /dev/null</span>
</span></span><span style="display:flex;"><span>earthly +apk <span style="color:#000;font-weight:bold">&amp;&amp;</span> ipfa app.apk <span style="color:#000;font-weight:bold">&amp;&amp;</span> du -sh app.apk
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[[https://ipfs.konubinix.eu/ipfs/bafybeibadym6ogsn4anvyisyzcbic2n5jognomnecao45sdqipldkx2nay?filename=app.apk][app.apk]]
</span></span><span style="display:flex;"><span>146M	app.apk
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># --config /dev/null</span>
</span></span><span style="display:flex;"><span>earthly +generate <span style="color:#000;font-weight:bold">&amp;&amp;</span> ipfa buildozer.spec
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[[https://ipfs.konubinix.eu/ipfs/bafkreial4yvpoxfgqprdi6ou63ps4ygp4jkqvndwg2mpyfd3csnyqpnd3i?filename=buildozer.spec][buildozer.spec]]
</span></span></code></pre></div><p>I tried on my <a target="_blank" href="/braindump/posts/zte/?title=zte_blade_s6#zte-blade-s6">zte blade s6</a> running android 5, I could communicate with the <a class="internal-link" href="#1f4fc0a4-ceff-4973-9e09-a2bd5d9b3670">arduino board</a> easily.</p>
<h3 id="a019d5cb-427b-48dd-9442-d1bcc41e723f">a legacy from another lifetime</h3>
<p>It is actually not the first time I wanted to do this. Here is an apk that
should work on older phones (android 4.1.2 and less).</p>
<p><a target="_blank" href="https://ipfs.konubinix.eu/ipfs/bafybeihx4r7xni2bpapmkypovc23qwzro6i3ncxnr6likited6pf77geni?filename=poc.apk">poc.apk</a></p>
<p>Note that while playing with it (see <a target="_blank" href="/braindump/posts/from_the_python_android_runtime_to_a_custom_app/?title=from_the_python_android_runtime_to_a_custom_app#">from the python android runtime to a
custom app</a>), I made some improvements, so I publish here the last
version. For instance, I applied the fix in</p>
<p><a target="_blank" href="https://github.com/kivy/python-for-android/pull/382/commits/f02e6ea956908bc08f42cf631c656a7ef4b301c6">https://github.com/kivy/python-for-android/pull/382/commits/f02e6ea956908bc08f42cf631c656a7ef4b301c6</a>.</p>
<p>I made it contain the same code as the more recent app. That way, I can put
the same code in and old and a new device, provided I write a code compatible
with python 2 AND 3 (without f-string for instance).</p>
<p>I also implemented a way to access dispatchKeyEvent, as per <a target="_blank" href="/braindump/posts/access_hardware_volume_keys_in_kivy/?title=access_hardware_volume_keys_in_kivy#">access hardware
volume keys in kivy</a>.</p>
<p>It will work-ish with <a target="_blank" href="/braindump/posts/rpyc/?title=rpyc#">rpyc</a>, but not in a satisfying way (see <a class="internal-link" href="#240d1b9b-3260-4a20-904f-3bebbb8feff2">trying on my old
wiko cink peax</a>). A lot of <code>EOFError: connection closed by peer</code> and plyer
needs several workaround to work that way.</p>
<ul>
<li>
<p>wakelock off, see <a target="_blank" href="/braindump/posts/android/?title=enable_wakelock#enable-wakelock">enable wakelock</a></p>
</li>
<li>
<p>orientation portrait, see <a target="_blank" href="/braindump/posts/android/?title=change_the_orientation#change-the-orientation">change the orientation</a></p>
</li>
<li>
<p>no fullscreen, see <a target="_blank" href="/braindump/posts/android/?title=change_fullscreen_settings#change-fullscreen-settings">change fullscreen settings</a></p>
</li>
<li>
<p>service ran using the new (in 2017) service API (it will crash on the AndroidService or start_service one <a target="_blank" href="https://github.com/kivy/python-for-android/issues/1049">https://github.com/kivy/python-for-android/issues/1049</a>)
In /sdcard/poc/main.py</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">run</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">from</span> <span style="color:#555">jnius</span> <span style="color:#000;font-weight:bold">import</span> autoclass
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">from</span> <span style="color:#555">android</span> <span style="color:#000;font-weight:bold">import</span> mActivity
</span></span><span style="display:flex;"><span>    service <span style="color:#000;font-weight:bold">=</span> autoclass(<span style="color:#d14">&#39;org.poc.poc.ServicePoc&#39;</span>)
</span></span><span style="display:flex;"><span>    argument <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    service<span style="color:#000;font-weight:bold">.</span>start(mActivity, argument)
</span></span></code></pre></div><p>Then, it will run /sdcard/poc/service/main.py:run(). It will show you in the
notification the status of the service. In case of Exception, it will put
the stack trace in /sdcard/serviceerror.txt</p>
</li>
<li>
<p>package=&ldquo;org.poc.poc&rdquo;</p>
</li>
<li>
<p>platformBuildVersionCode=&ldquo;19&rdquo;</p>
</li>
<li>
<p>platformBuildVersionName=&ldquo;4.4.2-1456859&rdquo;</p>
</li>
<li>
<p>python 2.7.2</p>
</li>
<li>
<p>kivy 1.10.0</p>
</li>
<li>
<p>rpyc 4.1.5</p>
</li>
<li>
<p>recently added requests, oscpy</p>
</li>
</ul>
<p>All of those are now available with new major version (hence incompatible ones).</p>
<p>Plus, python 2 reached its end of life in 2020, so using it might be like
shooting oneself in the foot.</p>
<h4 id="e16826fb-e4d9-46ac-a6b0-5ca50b53affb">to debug services</h4>
<p>In that version, you don&rsquo;t have the logs sent to logcat by default, hence the code <a target="_blank" href="/braindump/posts/from_the_python_android_runtime_to_a_custom_app/?title=from_the_python_android_runtime_to_a_custom_app#">I put</a> in the sdcard looks like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">sys</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">traceback</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">plyer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sys<span style="color:#000;font-weight:bold">.</span>path<span style="color:#000;font-weight:bold">.</span>insert(<span style="color:#099">0</span>, <span style="color:#d14">&#39;/sdcard/poc&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">poc</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>    plyer<span style="color:#000;font-weight:bold">.</span>notification<span style="color:#000;font-weight:bold">.</span>notify(<span style="color:#d14">&#34;Service running&#34;</span>)
</span></span><span style="display:flex;"><span>    poc<span style="color:#000;font-weight:bold">.</span>service()
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">except</span> <span style="color:#900;font-weight:bold">Exception</span> <span style="color:#000;font-weight:bold">as</span> e:
</span></span><span style="display:flex;"><span>    stack_trace <span style="color:#000;font-weight:bold">=</span> traceback<span style="color:#000;font-weight:bold">.</span>format_exc()
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">open</span>(<span style="color:#d14">&#34;/sdcard/serviceerror.txt&#34;</span>, <span style="color:#d14">&#34;w&#34;</span>)<span style="color:#000;font-weight:bold">.</span>write(stack_trace)
</span></span><span style="display:flex;"><span>    plyer<span style="color:#000;font-weight:bold">.</span>notification<span style="color:#000;font-weight:bold">.</span>notify(<span style="color:#d14">&#34;Service failed: </span><span style="color:#d14">{}</span><span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">.</span>format(e))
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>    plyer<span style="color:#000;font-weight:bold">.</span>notification<span style="color:#000;font-weight:bold">.</span>notify(<span style="color:#d14">&#34;Service ended gracefully&#34;</span>)
</span></span></code></pre></div><h4 id="240d1b9b-3260-4a20-904f-3bebbb8feff2">trying on my old <a target="_blank" href="/braindump/posts/afterlife_for_my_phones/?title=wiko_cink_peax_2#wiko-cink-peax-2">wiko cink peax</a></h4>
<p>Because I have an old phone (android 4.1.2), I decided to give it a try.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>clk android -d cinkpeax adb install poc.apk
</span></span><span style="display:flex;"><span>clk android -d cinkpeax adb shell am start -n org.poc.poc/org.kivy.android.PythonActivity
</span></span></code></pre></div><p>I tried putting the following code in the /sdcard/poc/main.py file</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>os<span style="color:#000;font-weight:bold">.</span>a <span style="color:#000;font-weight:bold">=</span> (<span style="color:#0086b3">locals</span>(), <span style="color:#0086b3">globals</span>())
</span></span><span style="display:flex;"><span>os<span style="color:#000;font-weight:bold">.</span>environ[<span style="color:#d14">&#34;NO_COLOR&#34;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">rpyc.core</span> <span style="color:#000;font-weight:bold">import</span> SlaveService
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">rpyc.utils.server</span> <span style="color:#000;font-weight:bold">import</span> ForkingServer
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">rpyc</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">sys</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;VERSIONS: &#34;</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#0086b3">str</span>(rpyc<span style="color:#000;font-weight:bold">.</span>__version__) <span style="color:#000;font-weight:bold">+</span> sys<span style="color:#000;font-weight:bold">.</span>version)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">run</span>():
</span></span><span style="display:flex;"><span>    ForkingServer(
</span></span><span style="display:flex;"><span>        SlaveService,
</span></span><span style="display:flex;"><span>        hostname<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;0.0.0.0&#34;</span>,
</span></span><span style="display:flex;"><span>        port<span style="color:#000;font-weight:bold">=</span><span style="color:#099">9999</span>,
</span></span><span style="display:flex;"><span>        reuse_addr<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>,
</span></span><span style="display:flex;"><span>    )<span style="color:#000;font-weight:bold">.</span>start()
</span></span></code></pre></div><p>Fortunately, python 2 is still available in nix, although considered
&ldquo;INSECURE&rdquo;.</p>
<p>Note: installing kivy 1.10.0 was is involved, because it needs cython and
some compilation steps. I did not try this. I would only need this to be
able to test a graphical interface before uploading it to the phone, so
that&rsquo;s not a blocker.</p>
<p>I pushed the code of usb4a and usbserial4a in the phone.</p>
<p>I could play with it, but several functions did not work, at least not using rpyc.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&gt;&gt;&gt; usb.get_usb_device_list()
</span></span><span style="display:flex;"><span>[&lt;android.hardware.usb.UsbDevice at 0x53777de0 jclass=android/hardware/usb/UsbDevice jself=&lt;LocalRef obj=0x1de0086e at 0x52f60550&gt;&gt;]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [34]: d.getDeviceClass()                                                                                                                                                                                    (6 results) 11:52:01 [514/2375]
</span></span><span style="display:flex;"><span>Out[34]: 2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [35]: d.getDeviceName()
</span></span><span style="display:flex;"><span>Out[35]: &#39;/dev/bus/usb/001/006
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [37]: d.getDeviceProtocol()
</span></span><span style="display:flex;"><span>Out[37]: 0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [39]: device.getManufacturerName()
</span></span><span style="display:flex;"><span>---------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>AttributeError                            Traceback (most recent call last)
</span></span><span style="display:flex;"><span>&lt;ipython-input-39-321147138486&gt; in &lt;module&gt;()
</span></span><span style="display:flex;"><span>----&gt; 1 device.getManufacturerName()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/home/sam/test/kivy/venv/lib/python2.7/site-packages/rpyc/core/netref.pyc in __getattr__(self, name)                                                                                                                                              151             return syncreq(self, consts.HANDLE_GETATTR, name)
</span></span><span style="display:flex;"><span>    152     def __getattr__(self, name):
</span></span><span style="display:flex;"><span>--&gt; 153         return syncreq(self, consts.HANDLE_GETATTR, name)
</span></span><span style="display:flex;"><span>    154     def __delattr__(self, name):
</span></span><span style="display:flex;"><span>    155         if name in _local_netref_attrs:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/home/sam/test/kivy/venv/lib/python2.7/site-packages/rpyc/core/netref.pyc in syncreq(proxy, handler, *args)
</span></span><span style="display:flex;"><span>     70         raise ReferenceError(&#39;weakly-referenced object no longer exists&#39;)
</span></span><span style="display:flex;"><span>     71     oid = object.__getattribute__(proxy, &#34;____oid__&#34;)
</span></span><span style="display:flex;"><span>---&gt; 72     return conn.sync_request(handler, oid, *args)
</span></span><span style="display:flex;"><span>     73
</span></span><span style="display:flex;"><span>     74 def asyncreq(proxy, handler, *args):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/home/sam/test/kivy/venv/lib/python2.7/site-packages/rpyc/core/protocol.pyc in sync_request(self, handler, *args)
</span></span><span style="display:flex;"><span>    521         isexc, obj = self._sync_replies.pop(seq)
</span></span><span style="display:flex;"><span>    522         if isexc:
</span></span><span style="display:flex;"><span>--&gt; 523             raise obj
</span></span><span style="display:flex;"><span>    524         else:
</span></span><span style="display:flex;"><span>    525             return obj
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>AttributeError: &#39;android.hardware.usb.UsbDevice&#39; object has no attribute &#39;getManufacturerName
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>========= Remote Traceback (1) =========
</span></span><span style="display:flex;"><span>Traceback (most recent call last):
</span></span><span style="display:flex;"><span>  File &#34;/home/test/project/.buildozer/android/platform/build/dists/poc/private/lib/python2.7/site-packages/rpyc/core/protocol.py&#34;, line 347, in _dispatch_request
</span></span><span style="display:flex;"><span>  File &#34;/home/test/project/.buildozer/android/platform/build/dists/poc/private/lib/python2.7/site-packages/rpyc/core/protocol.py&#34;, line 630, in _handle_getattr
</span></span><span style="display:flex;"><span>  File &#34;/home/test/project/.buildozer/android/platform/build/dists/poc/private/lib/python2.7/site-packages/rpyc/core/protocol.py&#34;, line 596, in _access_attr
</span></span><span style="display:flex;"><span>AttributeError: &#39;android.hardware.usb.UsbDevice&#39; object has no attribute &#39;getManufacturerName
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [48]: usb.has_usb_permission(device)
</span></span><span style="display:flex;"><span>---------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>jnius.jnius.JavaException                 Traceback (most recent call last)
</span></span><span style="display:flex;"><span>&lt;ipython-input-48-e5961d8985eb&gt; in &lt;module&gt;()
</span></span><span style="display:flex;"><span>----&gt; 1 usb.has_usb_permission(device)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/home/sam/test/kivy/venv/lib/python2.7/site-packages/rpyc/core/netref.pyc in __call__(_self, *args, **kwargs)
</span></span><span style="display:flex;"><span>    197         def __call__(_self, *args, **kwargs):
</span></span><span style="display:flex;"><span>    198             kwargs = tuple(kwargs.items())
</span></span><span style="display:flex;"><span>--&gt; 199             return syncreq(_self, consts.HANDLE_CALL, args, kwargs)
</span></span><span style="display:flex;"><span>    200         __call__.__doc__ = doc
</span></span><span style="display:flex;"><span>    201         return __call__
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/home/sam/test/kivy/venv/lib/python2.7/site-packages/rpyc/core/netref.pyc in syncreq(proxy, handler, *args)
</span></span><span style="display:flex;"><span>     70         raise ReferenceError(&#39;weakly-referenced object no longer exists&#39;)
</span></span><span style="display:flex;"><span>     71     oid = object.__getattribute__(proxy, &#34;____oid__&#34;)
</span></span><span style="display:flex;"><span>---&gt; 72     return conn.sync_request(handler, oid, *args)
</span></span><span style="display:flex;"><span>     73
</span></span><span style="display:flex;"><span>     74 def asyncreq(proxy, handler, *args):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/home/sam/test/kivy/venv/lib/python2.7/site-packages/rpyc/core/protocol.pyc in sync_request(self, handler, *args)
</span></span><span style="display:flex;"><span>    521         isexc, obj = self._sync_replies.pop(seq)
</span></span><span style="display:flex;"><span>    522         if isexc:
</span></span><span style="display:flex;"><span>--&gt; 523             raise obj
</span></span><span style="display:flex;"><span>    524         else:
</span></span><span style="display:flex;"><span>    525             return obj
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jnius.jnius.JavaException: JVM exception occurred: Unknown exception code: 1401250256 msg null
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>========= Remote Traceback (1) =========
</span></span><span style="display:flex;"><span>Traceback (most recent call last):
</span></span><span style="display:flex;"><span>  File &#34;/home/test/project/.buildozer/android/platform/build/dists/poc/private/lib/python2.7/site-packages/rpyc/core/protocol.py&#34;, line 347, in _dispatch_request
</span></span><span style="display:flex;"><span>  File &#34;/home/test/project/.buildozer/android/platform/build/dists/poc/private/lib/python2.7/site-packages/rpyc/core/protocol.py&#34;, line 624, in _handle_call
</span></span><span style="display:flex;"><span>  File &#34;/sdcard/poc/usb4a/usb.py&#34;, line 112, in has_usb_permission
</span></span><span style="display:flex;"><span>    return usb_manager.hasPermission(usb_device)
</span></span><span style="display:flex;"><span>  File &#34;jnius/jnius_export_class.pxi&#34;, line 906, in jnius.jnius.JavaMultipleMethod.__call__ (jnius/jnius.c:29136)
</span></span><span style="display:flex;"><span>  File &#34;jnius/jnius_export_class.pxi&#34;, line 638, in jnius.jnius.JavaMethod.__call__ (jnius/jnius.c:25547)
</span></span><span style="display:flex;"><span>  File &#34;jnius/jnius_export_class.pxi&#34;, line 732, in jnius.jnius.JavaMethod.call_method (jnius/jnius.c:26739)
</span></span><span style="display:flex;"><span>  File &#34;jnius/jnius_utils.pxi&#34;, line 93, in jnius.jnius.check_exception (jnius/jnius.c:4317)
</span></span><span style="display:flex;"><span>JavaException: JVM exception occurred: Unknown exception code: 1401250256 msg null
</span></span></code></pre></div><p>But, putting this code inside the main.py, I could manage to get some communication with the arduino board.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">usbserial4a</span> <span style="color:#000;font-weight:bold">import</span> serial4a
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">usb4a</span> <span style="color:#000;font-weight:bold">import</span> usb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>get_serial_port <span style="color:#000;font-weight:bold">=</span> serial4a<span style="color:#000;font-weight:bold">.</span>get_serial_port
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>l <span style="color:#000;font-weight:bold">=</span> usb<span style="color:#000;font-weight:bold">.</span>get_usb_device_list()
</span></span><span style="display:flex;"><span>d <span style="color:#000;font-weight:bold">=</span> l[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>portstr <span style="color:#000;font-weight:bold">=</span> d<span style="color:#000;font-weight:bold">.</span>getDeviceName()
</span></span><span style="display:flex;"><span>device <span style="color:#000;font-weight:bold">=</span> usb<span style="color:#000;font-weight:bold">.</span>get_usb_device(portstr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>usb<span style="color:#000;font-weight:bold">.</span>request_usb_permission(device)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>serial_port <span style="color:#000;font-weight:bold">=</span> serial4a<span style="color:#000;font-weight:bold">.</span>get_serial_port(
</span></span><span style="display:flex;"><span>    portstr,
</span></span><span style="display:flex;"><span>    <span style="color:#099">9600</span>,  <span style="color:#998;font-style:italic"># Baudrate</span>
</span></span><span style="display:flex;"><span>    <span style="color:#099">8</span>,  <span style="color:#998;font-style:italic"># Number of data bits(5, 6, 7 or 8)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#39;N&#39;</span>,  <span style="color:#998;font-style:italic"># Parity(&#39;N&#39;, &#39;E&#39;, &#39;O&#39;, &#39;M&#39; or &#39;S&#39;)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#099">1</span>,  <span style="color:#998;font-style:italic"># Number of stop bits(1, 1.5 or 2)</span>
</span></span><span style="display:flex;"><span>    timeout<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>serial_port<span style="color:#000;font-weight:bold">.</span>write(<span style="color:#d14">b</span><span style="color:#d14">&#39;Hello world!&#39;</span>)
</span></span><span style="display:flex;"><span>message <span style="color:#000;font-weight:bold">=</span> [line<span style="color:#000;font-weight:bold">.</span>decode()<span style="color:#000;font-weight:bold">.</span>strip() <span style="color:#000;font-weight:bold">for</span> line <span style="color:#000;font-weight:bold">in</span> serial_port<span style="color:#000;font-weight:bold">.</span>readlines()]
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#serial_port.close()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>os<span style="color:#000;font-weight:bold">.</span>a <span style="color:#000;font-weight:bold">=</span> (<span style="color:#0086b3">locals</span>(), <span style="color:#0086b3">globals</span>())
</span></span><span style="display:flex;"><span>os<span style="color:#000;font-weight:bold">.</span>environ[<span style="color:#d14">&#34;NO_COLOR&#34;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">rpyc.core</span> <span style="color:#000;font-weight:bold">import</span> SlaveService
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">rpyc.utils.server</span> <span style="color:#000;font-weight:bold">import</span> ForkingServer
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">rpyc</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">sys</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;VERSIONS: &#34;</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#0086b3">str</span>(rpyc<span style="color:#000;font-weight:bold">.</span>__version__) <span style="color:#000;font-weight:bold">+</span> sys<span style="color:#000;font-weight:bold">.</span>version)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">run</span>():
</span></span><span style="display:flex;"><span>    ForkingServer(
</span></span><span style="display:flex;"><span>        SlaveService,
</span></span><span style="display:flex;"><span>        hostname<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;0.0.0.0&#34;</span>,
</span></span><span style="display:flex;"><span>        port<span style="color:#000;font-weight:bold">=</span><span style="color:#099">9999</span>,
</span></span><span style="display:flex;"><span>        reuse_addr<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>,
</span></span><span style="display:flex;"><span>    )<span style="color:#000;font-weight:bold">.</span>start()
</span></span></code></pre></div><p>Now, I can see some data flowing between the devices, although some of it
gets lost.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>In [120]: serial_port.write(&#34;truc&#34;)
</span></span><span style="display:flex;"><span>Out[120]: 4
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [121]: serial_port.readline()
</span></span><span style="display:flex;"><span>Out[121]: &#39;Reeceived: r\r\n
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [122]: serial_port.readline()
</span></span><span style="display:flex;"><span>Out[122]: &#39;Received: u\r\n
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [123]: serial_port.readline()
</span></span><span style="display:flex;"><span>Out[123]: &#39;Received: c\r\n
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [124]: serial_port.readline()
</span></span><span style="display:flex;"><span>Out[124]:
</span></span></code></pre></div><p>As a conclusion, I proved that I could make something out of an old phone
and play with some board, but it lacked a bit of the <a target="_blank" href="/braindump/posts/fast_feedback_loop/?title=fast_feedback_loop#">fast feedback loop</a>
aspect that makes python enjoyable in the first place.</p>
<p>Also, I was lucky that I could still run ipython with python2 and rpyc3.</p>
<p>There are so many abandoned old phones out there with which I would have
less troubles. Thus, I don&rsquo;t think this use case is worth it.</p>
<h2 id="notes-linking-here">Notes linking here</h2>
<ul>
<li><a target="_blank" href="/braindump/posts/android/?title=4#4">4</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/android_kivy_application_to_multiple_downloads_using_the_storage_access_framework/?title=android_kivy_application_to_multiple_downloads_using_the_storage_access_framework#">android kivy application to multiple downloads using the storage access framework</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/buildozer/?title=buildozer#">buildozer</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/android/?title=change_the_orientation#change-the-orientation">change the orientation</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/from_the_python_android_runtime_to_a_custom_app/?title=changing_the_python_script#changing-the-python-script">changing the python script</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/connect_to_a_wiimote/?title=connect_to_a_wiimote#">connect to a wiimote</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/deuxieme_cerveau_et_garder_une_trace/?title=deuxieme_cerveau_et_garder_une_trace#">deuxième cerveau et garder une trace</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/discover_where_my_chicken_get_out_of_the_fence/?title=discover_where_my_chicken_get_out_of_the_fence#">discover where my chicken get out of the fence</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/android/?title=enable_wakelock#enable-wakelock">enable wakelock</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/from_the_python_android_runtime_to_a_custom_app/?title=from_the_python_android_runtime_to_a_custom_app#">from the python android runtime to a custom app</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/more_clever_night_light_in_kivy/?title=more_clever_night_light_in_kivy#">more clever night light in kivy</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/pomodo_timer_on_kivy/?title=pomodo_timer_on_kivy#">pomodo timer on kivy</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/pwa_vs_kivy_app/?title=pwa_vs_kivy_app#">pwa vs kivy app</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/simple_python_web_server_in_android/?title=simple_python_web_server_in_android#">simple python web server in android</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/afterlife_for_my_phones/?title=some_note_if_using_with_kivy#some-note-if-using-with-kivy">some note if using with kivy</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/use_https_on_old_android_phones/?title=use_https_on_old_android_phones#">use https on old android phones</a> (braindump)</li>
<li><a class="internal-link" href="/blog/posts/use_the_camera_with_kivy_on_android/">use the camera with kivy on android</a></li>
<li><a target="_blank" href="/braindump/posts/afterlife_for_my_phones/?title=wiko_cink_peax_2#wiko-cink-peax-2">wiko cink peax 2</a> (braindump)</li>
<li><a target="_blank" href="/braindump/posts/afterlife_for_my_phones/?title=zte_blade_s6_p839f30#zte-blade-s6-p839f30">zte blade s6 (p839f30)</a> (braindump)</li>
</ul>
<h2 id="permalink"><a class="internal-link" href="/blog/a078544e-ccad-4fa2-b96e-5e02bb4f2be3?title=a_python_runtime_on_android">Permalink</a></h2>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>It would have been awesome to use a <a target="_blank" href="/braindump/posts/jupyter/?title=kernel#kernel">jupyter kernel</a> instead, but last time
I tried, building libzmq was veeery difficult.&#160;<a class="internal-link" href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>And even if I wanted a, interface, I would likely create a <a target="_blank" href="/braindump/posts/progressive_web_app/?title=progressive_web_app#">progressive
web app</a> using <a target="_blank" href="/braindump/posts/alpine_js/?title=alpine_js#">alpine.js</a>, and discussing with the app on 127.0.0.1, and not use
whatever the app framework provides to have a <a target="_blank" href="/braindump/posts/fast_feedback_loop/?title=fast_feedback_loop#">fast feedback loop</a>.</p>
<!--more-->
&#160;<a class="internal-link" href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></li>
</ol>
</div>
  </article>
  <aside class="date"><time>Last updated: 01 Jul 2025</time></aside>
  <aside class="date"><time>Published&nbsp;&nbsp;&nbsp;: 25 Oct 2024</time></aside>
</main>
<hr/>
<footer>
  <nav class="footer-nav">
  <ul>
	<li><a class="internal-link" href="/blog/posts/"><i class="icon fas fa-blog"></i></a></li>
    <li><a target="_blank" href="/braindump/"><i class="fas fa-brain"></i></a></li>
    <li><a target="_blank" href="mailto:konubinixweb@gmail.com"><i class="fas fa-envelope-square"></i></a></li>
    <li><a target="_blank" href="https://github.com/konubinix"><i class="fab fa-github-square"></i></a></li>
    <li><a target="_blank" href="https://linkedin.com/in/samuel-loury-61259040"><i class="fab fa-linkedin"></i></a></li>
    <li><a class="internal-link" href="/blog/index.xml"><i class="fas fa-rss-square"></i></a></li>
	<li><a class="internal-link" href="/blog/tags/"><i class="fa fa-tag"></i></a></li>
    <li><a class="internal-link" href="/blog/blog_search"><i class="icon fa fa-search"></i></a></li>
  </ul>
</nav>

  <p>&copy; 2025 Samuel Loury</p>
</footer>
</body>
</html>
