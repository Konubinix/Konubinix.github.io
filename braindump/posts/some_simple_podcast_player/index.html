<!DOCTYPE html>
<html><title>some simple podcast player</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="bLmaFyyXugiCqSup-eIIIx0B4CngtdF_svyMMKQbS5E" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, minimum-scale=0.5, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src="https://hypothes.is/embed.js" async></script>


<link rel="stylesheet" href="/braindump/css/main.min.56b43bcbc759a196f9dd525bee62bdec45a29ba95902bbab74a4f7ad2ea3e8cb.css"/>

<link rel="stylesheet" href="/braindump/css/links.min.4bf1990b213fb76d2a66153dc6ef9a57d49f536c6baf6e7f19a7948470a38141.css"/>

<link rel="stylesheet" href="/braindump/css/konubinix.min.cf2d0f36945178c647979ee68f1830892e06aa3d481d8913728b5c7462b97f6e.css"/>

<link rel="stylesheet" href="/ipfs/QmQFVQS89fv1XUNFcjwCKDePzckuT9kpuAVNYUwNdEfYcv/css/all.css"/>
<link rel="shortcut icon" href="/ipfs/QmVFwYV7YRZLKU3ybN1hW4jqfyZGPLKJwd8toN2wHz5UAD?a.png" type="image/x-icon" />

<body><header>
  <div>
	<a href="/braindump//"><h5 class="site-title">Konubinix&#39; opinionated web of thoughts</h5></a>
  </div>
  <span>
	<a href="/blog/"><i class="icon fas fa-blog"></i></a>
	<a href="/braindump/posts/"><i class="icon fas fa-brain"></i></a>
    <a href="mailto:konubinixweb@gmail.com"><i class="icon fas fa-envelope-square"></i></a>
    <a href="https://github.com/konubinix"><i class="icon fab fa-github-square"></i></a>
    <a href="https://linkedin.com/in/samuel-loury-61259040"><i class="icon fab fa-linkedin"></i></a>
	<a href="/braindump/graph.html"><i class="icon fas fa-project-diagram"></i></a>
	<a href="/braindump/index.xml"><i class="icon fas fa-rss-square"></i></a>
	<a href="/braindump/tags/"><i class="icon fa fa-tag"></i></a>
	<a href="/braindump/braindump_search"><i class="icon fa fa-search"></i></a>
  </span>
</header>

<div class="grid-container">
  <div class="grid">
    <div class="page" data-level="1">
      <div class="content">
		<p class="lead">
        <h1>Some Simple Podcast Player</h1>
		<span class="badge badge-pill badge-warning"><a href="/braindump/tags/fleeting/">Fleeting</a></span></p>
        <p>some simple podcast tool, very specialized to my stack.</p>
<p>For audiobooks, prefer using <a href="/braindump/posts/voice_audiobook_player/">Voice Audiobook Player</a>, much more attractive (I
think).</p>
<p><a id="code-snippet--root"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mhtml" data-lang="mhtml"><span style="display:flex;"><span>&lt;<span style="color:#000080">html</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">meta</span> <span style="color:#008080">charset</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;UTF-8&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">meta</span> <span style="color:#008080">name</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;viewport&#34;</span> <span style="color:#008080">content</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">link</span> <span style="color:#008080">rel</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;manifest&#34;</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;./podcastmanifest.json&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;module&#34;</span> <span style="color:#008080">src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/ipfs/bafkreiap4qt2hkswcidxgqnzdt4irhslfc6kbpa2bw2lscz7zsd3gwr7mu?filename=yjs.js&#34;</span>&gt;&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;module&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">import</span> { Doc, WebsocketProvider, IndexeddbPersistence } from <span style="color:#d14">&#39;/ipfs/bafkreiap4qt2hkswcidxgqnzdt4irhslfc6kbpa2bw2lscz7zsd3gwr7mu?filename=yjs.js&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">const</span> doc <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Doc();
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">const</span> ymap <span style="color:#000;font-weight:bold">=</span> doc.getMap(<span style="color:#d14">&#34;state&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">const</span> wsProvider <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> WebsocketProvider(
</span></span><span style="display:flex;"><span>          <span style="color:#d14">&#39;ws://192.168.2.14:9905&#39;</span>, <span style="color:#d14">&#39;podcast&#39;</span>,
</span></span><span style="display:flex;"><span>          doc,
</span></span><span style="display:flex;"><span>      )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">const</span> indexeddb <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> IndexeddbPersistence(<span style="color:#d14">&#39;podcast&#39;</span>, doc)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">// I can export the Doc so that it will be used in the dom
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      <span style="color:#0086b3">window</span>.doc <span style="color:#000;font-weight:bold">=</span> doc
</span></span><span style="display:flex;"><span>      <span style="color:#0086b3">window</span>.ymap <span style="color:#000;font-weight:bold">=</span> ymap
</span></span><span style="display:flex;"><span>      <span style="color:#0086b3">window</span>.wsProvider <span style="color:#000;font-weight:bold">=</span> wsProvider
</span></span><span style="display:flex;"><span>      <span style="color:#0086b3">window</span>.indexeddb <span style="color:#000;font-weight:bold">=</span> indexeddb
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span> <span style="color:#008080">defer</span> <span style="color:#008080">src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/ipfs/bafkreidregenuw7nhqewvimq7p3vwwlrqcxjcrs4tiocrujjzggg26gzcu?orig=https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js&#34;</span>&gt;&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span> <span style="color:#008080">defer</span> <span style="color:#008080">src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/ipfs/bafkreighmyou4lhqizpdzvutdeg6xnpvskwhfxgez7tfawason3hkwfspm?orig=https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js&#34;</span>&gt;&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span> <span style="color:#008080">defer</span> <span style="color:#008080">src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/ipfs/bafkreic33rowgvvugzgzajagkuwidfnit2dyqyn465iygfs67agsukk24i?orig=https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js&#34;</span>&gt;&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span> <span style="color:#008080">src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/ipfs/bafybeihp5kzlgqt56dmy5l4z7kpymfc4kn3fnehrrtr7cid7cn7ra36yha?orig=https://cdn.tailwindcss.com/3.4.3&#34;</span>&gt;&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>    [[wip_ipfsdocs_slider_alpinejs.org:toast-code-ex()]]
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">if</span> (<span style="color:#d14">&#39;serviceWorker&#39;</span> <span style="color:#000;font-weight:bold">in</span> navigator) {
</span></span><span style="display:flex;"><span>          navigator.serviceWorker
</span></span><span style="display:flex;"><span>              .register(<span style="color:#d14">&#39;./swpodcast.js&#39;</span>)
</span></span><span style="display:flex;"><span>              .then(<span style="color:#000;font-weight:bold">function</span>() {
</span></span><span style="display:flex;"><span>                  console.log(<span style="color:#d14">&#39;Service Worker Registered&#39;</span>);
</span></span><span style="display:flex;"><span>              })
</span></span><span style="display:flex;"><span>              .<span style="color:#000;font-weight:bold">catch</span>(error =&gt; {
</span></span><span style="display:flex;"><span>                  console.error(<span style="color:#d14">&#39;Service Worker registration failed:&#39;</span>, error);
</span></span><span style="display:flex;"><span>                  alert(<span style="color:#d14">`Service Worker registration failed: </span><span style="color:#d14">${</span>error<span style="color:#d14">}</span><span style="color:#d14">`</span>);
</span></span><span style="display:flex;"><span>              });
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">function</span> formatTime(seconds) {
</span></span><span style="display:flex;"><span>          <span style="color:#998;font-style:italic">// remove the milliseconds
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>          seconds <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">Math</span>.floor(seconds)
</span></span><span style="display:flex;"><span>          <span style="color:#998;font-style:italic">// Calculate hours, minutes, and remaining seconds
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>          <span style="color:#000;font-weight:bold">let</span> hours <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">Math</span>.floor(seconds <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">3600</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#000;font-weight:bold">let</span> minutes <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">Math</span>.floor((seconds <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">3600</span>) <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">60</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#000;font-weight:bold">let</span> remainingSeconds <span style="color:#000;font-weight:bold">=</span> seconds <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">60</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#998;font-style:italic">// Create an array to store parts of the time
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>          <span style="color:#000;font-weight:bold">let</span> parts <span style="color:#000;font-weight:bold">=</span> [];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#998;font-style:italic">// Add hours if its greater than 0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>          <span style="color:#000;font-weight:bold">if</span> (hours <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0</span>) {
</span></span><span style="display:flex;"><span>              parts.push(hours.toString().padStart(<span style="color:#099">2</span>, <span style="color:#d14">&#39;0&#39;</span>));
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#998;font-style:italic">// Always add minutes and seconds
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>          parts.push(minutes.toString().padStart(<span style="color:#099">2</span>, <span style="color:#d14">&#39;0&#39;</span>));
</span></span><span style="display:flex;"><span>          parts.push(remainingSeconds.toString().padStart(<span style="color:#099">2</span>, <span style="color:#d14">&#39;0&#39;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#998;font-style:italic">// Join the parts with &#39;:&#39; and return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>          <span style="color:#000;font-weight:bold">return</span> parts.join(<span style="color:#d14">&#39;:&#39;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#0086b3">document</span>.addEventListener(<span style="color:#d14">&#39;alpine:init&#39;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>          Alpine.data(<span style="color:#d14">&#39;app&#39;</span>, () =&gt; ({
</span></span><span style="display:flex;"><span>              src<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;podcasts.json&#34;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#000;font-weight:bold">async</span> init_app () {
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">try</span>{
</span></span><span style="display:flex;"><span>                      wsProvider.on(<span style="color:#d14">&#39;status&#39;</span>, event =&gt; {
</span></span><span style="display:flex;"><span>                          info(<span style="color:#d14">`WS: </span><span style="color:#d14">${</span>event.status<span style="color:#d14">}</span><span style="color:#d14">`</span>) ;
</span></span><span style="display:flex;"><span>                      })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                      indexeddb.on(<span style="color:#d14">&#39;synced&#39;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>                          info(<span style="color:#d14">`IDB: ready`</span>) ;
</span></span><span style="display:flex;"><span>                      })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                      wsProvider.on(<span style="color:#d14">&#39;sync&#39;</span>, event =&gt; {
</span></span><span style="display:flex;"><span>                          <span style="color:#998;font-style:italic">// something new from outside
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                      });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                      ymap.observe(ymapEvent =&gt; {
</span></span><span style="display:flex;"><span>                          <span style="color:#998;font-style:italic">// set the values, such as show_old,
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                          <span style="color:#0086b3">window</span>.event <span style="color:#000;font-weight:bold">=</span> ymapEvent
</span></span><span style="display:flex;"><span>                          <span style="color:#000;font-weight:bold">for</span>(<span style="color:#000;font-weight:bold">const</span> keychanged <span style="color:#000;font-weight:bold">of</span> ymapEvent.keysChanged) {
</span></span><span style="display:flex;"><span>                              <span style="color:#998;font-style:italic">// info(`Setting: ${keychanged}`)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                              <span style="color:#000;font-weight:bold">this</span>[keychanged] <span style="color:#000;font-weight:bold">=</span> ymap.get(keychanged)
</span></span><span style="display:flex;"><span>                          }
</span></span><span style="display:flex;"><span>                      });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                      <span style="color:#998;font-style:italic">// no-store because the browser cache will hide changes in
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                      <span style="color:#998;font-style:italic">// the file.  This is dealt with by the service worker
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                      <span style="color:#998;font-style:italic">// anyway
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                      res <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> fetch(<span style="color:#d14">`./</span><span style="color:#d14">${</span><span style="color:#000;font-weight:bold">this</span>.src<span style="color:#d14">}</span><span style="color:#d14">`</span>, {cache<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;no-store&#39;</span>})
</span></span><span style="display:flex;"><span>                      <span style="color:#000;font-weight:bold">this</span>.dirs <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> res.json()
</span></span><span style="display:flex;"><span>                      <span style="color:#000;font-weight:bold">var</span> lastpodcast
</span></span><span style="display:flex;"><span>                      <span style="color:#000;font-weight:bold">var</span> lastdir
</span></span><span style="display:flex;"><span>                      <span style="color:#000;font-weight:bold">var</span> keepcurrent <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#000;font-weight:bold">var</span> keeplastdir
</span></span><span style="display:flex;"><span>                      <span style="color:#000;font-weight:bold">var</span> keeplastpodcast
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                      <span style="color:#000;font-weight:bold">for</span>(<span style="color:#000;font-weight:bold">const</span> dir <span style="color:#000;font-weight:bold">in</span> <span style="color:#000;font-weight:bold">this</span>.dirs) {
</span></span><span style="display:flex;"><span>                          lastdir <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.dir_last_episode[dir]
</span></span><span style="display:flex;"><span>                          keeplastdir <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>                          <span style="color:#000;font-weight:bold">for</span>(<span style="color:#000;font-weight:bold">const</span> podcast <span style="color:#000;font-weight:bold">of</span> <span style="color:#000;font-weight:bold">this</span>.dirs[dir]){
</span></span><span style="display:flex;"><span>                              lastpodcast <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.podcast_last_episode[podcast.name]
</span></span><span style="display:flex;"><span>                              keeplastpodcast <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>                              <span style="color:#000;font-weight:bold">for</span>(<span style="color:#000;font-weight:bold">const</span> episode <span style="color:#000;font-weight:bold">of</span> podcast.episodes){
</span></span><span style="display:flex;"><span>                                  <span style="color:#000;font-weight:bold">if</span>(lastdir <span style="color:#000;font-weight:bold">&amp;&amp;</span> episode.url <span style="color:#000;font-weight:bold">===</span> lastdir.episode.url){
</span></span><span style="display:flex;"><span>                                      keeplastdir <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>                                  }
</span></span><span style="display:flex;"><span>                                  <span style="color:#000;font-weight:bold">if</span>(lastpodcast <span style="color:#000;font-weight:bold">&amp;&amp;</span> episode.url <span style="color:#000;font-weight:bold">===</span> lastpodcast.episode.url){
</span></span><span style="display:flex;"><span>                                      keeplastpodcast <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>                                  }
</span></span><span style="display:flex;"><span>                                  <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.current_episode <span style="color:#000;font-weight:bold">&amp;&amp;</span> <span style="color:#000;font-weight:bold">this</span>.current_episode.url <span style="color:#000;font-weight:bold">===</span> episode.url) {
</span></span><span style="display:flex;"><span>                                      keepcurrent <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>                                  }
</span></span><span style="display:flex;"><span>                              }
</span></span><span style="display:flex;"><span>                              <span style="color:#000;font-weight:bold">if</span>(lastpodcast <span style="color:#000;font-weight:bold">&amp;&amp;</span> <span style="color:#000;font-weight:bold">!</span>keeplastpodcast) {
</span></span><span style="display:flex;"><span>                                  <span style="color:#000;font-weight:bold">delete</span> <span style="color:#000;font-weight:bold">this</span>.podcast_last_episode[podcast.name]
</span></span><span style="display:flex;"><span>                                  <span style="color:#000;font-weight:bold">this</span>.podcast_last_episode <span style="color:#000;font-weight:bold">=</span> {...<span style="color:#000;font-weight:bold">this</span>.podcast_last_episode}
</span></span><span style="display:flex;"><span>                              }
</span></span><span style="display:flex;"><span>                          }
</span></span><span style="display:flex;"><span>                          <span style="color:#000;font-weight:bold">if</span>(lastdir <span style="color:#000;font-weight:bold">&amp;&amp;</span> <span style="color:#000;font-weight:bold">!</span>keeplastdir) {
</span></span><span style="display:flex;"><span>                              <span style="color:#000;font-weight:bold">delete</span> <span style="color:#000;font-weight:bold">this</span>.dir_last_episode[dir]
</span></span><span style="display:flex;"><span>                              <span style="color:#000;font-weight:bold">this</span>.dir_last_episode <span style="color:#000;font-weight:bold">=</span> {...<span style="color:#000;font-weight:bold">this</span>.dir_last_episode}
</span></span><span style="display:flex;"><span>                          }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                      }
</span></span><span style="display:flex;"><span>                      <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">!</span> keepcurrent) {
</span></span><span style="display:flex;"><span>                          <span style="color:#000;font-weight:bold">this</span>.current_episode <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>                      }
</span></span><span style="display:flex;"><span>                  }
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">catch</span>(err)
</span></span><span style="display:flex;"><span>                  {
</span></span><span style="display:flex;"><span>                      error(err)
</span></span><span style="display:flex;"><span>                  }
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>              dirs<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">undefined</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>              show_old<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>, <span style="color:#998;font-style:italic">// Alpine.$persist(false).as(&#34;show_old&#34;),
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>              podcast_last_episode<span style="color:#000;font-weight:bold">:</span> {}, <span style="color:#998;font-style:italic">// Alpine.$persist({}).as(&#34;podcast_last_episode3&#34;),
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>              dir_last_episode<span style="color:#000;font-weight:bold">:</span> {}, <span style="color:#998;font-style:italic">// Alpine.$persist({}).as(&#34;dir_last_episode&#34;),
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>              current_speed<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>              current_progress<span style="color:#000;font-weight:bold">:</span> {cur<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">0</span>, duration<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">0</span>},
</span></span><span style="display:flex;"><span>              current_dir<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>, <span style="color:#998;font-style:italic">// Alpine.$persist(null).as(&#34;dir&#34;),
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>              current_episode<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>, <span style="color:#998;font-style:italic">// Alpine.$persist(null).as(&#34;episode&#34;),
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>              current_podcast<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>, <span style="color:#998;font-style:italic">// Alpine.$persist(null).as(&#34;podcast&#34;),
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>              current_playing<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>              sync_state<span style="color:#000;font-weight:bold">:</span> {}, <span style="color:#998;font-style:italic">// Alpine.$persist({}).as(&#34;sync_state2&#34;),
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>              key(stuff) {
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">`</span><span style="color:#d14">${</span>stuff<span style="color:#d14">}</span><span style="color:#d14">_</span><span style="color:#d14">${</span><span style="color:#000;font-weight:bold">this</span>.current_episode.url<span style="color:#d14">}</span><span style="color:#d14">`</span>
</span></span><span style="display:flex;"><span>              },
</span></span><span style="display:flex;"><span>              <span style="color:#000;font-weight:bold">async</span> goto_next() {
</span></span><span style="display:flex;"><span>                  localStorage.setItem(<span style="color:#000;font-weight:bold">this</span>.key(<span style="color:#d14">&#39;time&#39;</span>), <span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">this</span>.sync_state[<span style="color:#000;font-weight:bold">this</span>.key(<span style="color:#d14">&#39;time&#39;</span>)] <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">let</span> pos_current_episode <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.current_podcast.episodes.findIndex(
</span></span><span style="display:flex;"><span>                      (episode) =&gt; episode.url <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">this</span>.current_episode.url
</span></span><span style="display:flex;"><span>                  )
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">if</span>(pos_current_episode <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">this</span>.current_podcast.episodes.length) {
</span></span><span style="display:flex;"><span>                      localStorage.setItem(<span style="color:#000;font-weight:bold">this</span>.current_podcast.name <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;_looped_first_episode&#34;</span>, <span style="color:#000;font-weight:bold">this</span>.current_podcast.episodes[<span style="color:#099">0</span>].url)
</span></span><span style="display:flex;"><span>                      <span style="color:#000;font-weight:bold">this</span>.sync_state[<span style="color:#000;font-weight:bold">this</span>.current_podcast.name <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;_looped_first_episode&#34;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.current_podcast.episodes[<span style="color:#099">0</span>].url
</span></span><span style="display:flex;"><span>                  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">this</span>.current_episode <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.$nextTick() <span style="color:#998;font-style:italic">// give time to the player to disappear
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                  <span style="color:#000;font-weight:bold">this</span>.current_episode <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.current_podcast.episodes[(pos_current_episode <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">%</span> <span style="color:#000;font-weight:bold">this</span>.current_podcast.episodes.length]
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.$nextTick() <span style="color:#998;font-style:italic">// give time to the player to appear
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>              },
</span></span><span style="display:flex;"><span>              <span style="color:#000;font-weight:bold">async</span> goto_prev() {
</span></span><span style="display:flex;"><span>                  localStorage.setItem(<span style="color:#000;font-weight:bold">this</span>.key(<span style="color:#d14">&#39;time&#39;</span>), <span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">this</span>.sync_state[<span style="color:#000;font-weight:bold">this</span>.key(<span style="color:#d14">&#39;time&#39;</span>)] <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">let</span> pos_current_episode <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.current_podcast.episodes.findIndex(
</span></span><span style="display:flex;"><span>                      (episode) =&gt; episode.url <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">this</span>.current_episode.url
</span></span><span style="display:flex;"><span>                  )
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">this</span>.current_episode <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.$nextTick() <span style="color:#998;font-style:italic">// give time to the player to disapear
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                  <span style="color:#000;font-weight:bold">this</span>.current_episode <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.current_podcast.episodes[(pos_current_episode <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">this</span>.current_podcast.episodes.length) <span style="color:#000;font-weight:bold">%</span> <span style="color:#000;font-weight:bold">this</span>.current_podcast.episodes.length]
</span></span><span style="display:flex;"><span>                  <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.$nextTick() <span style="color:#998;font-style:italic">// give time to the player to appear
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>              },
</span></span><span style="display:flex;"><span>              localstoragegetter(key) {
</span></span><span style="display:flex;"><span>                  <span style="color:#998;font-style:italic">//return localStorage.getItem(key)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                  <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span>.sync_state[key]
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>          }))
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">body</span> <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;app&#34;</span> <span style="color:#008080">x-init</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;init_app&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">podcast_last_episode</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;ymap.set(&#39;podcast_last_episode&#39;, podcast_last_episode)&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">dir_last_episode</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;ymap.set(&#39;dir_last_episode&#39;, dir_last_episode)&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">show_old</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;ymap.set(&#39;show_old&#39;, show_old)&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">current_episode</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;ymap.set(&#39;current_episode&#39;, current_episode)&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">current_podcast</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;ymap.set(&#39;current_podcast&#39;, current_podcast)&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">current_dir</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;ymap.set(&#39;current_dir&#39;, current_dir)&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">sync-state</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;ymap.set(&#39;sync_state&#39;, sync_state)&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">gotonext</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   if($event.detail.playing){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   current_playing = true
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   await goto_next()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   &#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">gotoprev</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   if($event.detail.playing){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   current_playing = true
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   await goto_prev()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   &#34;</span>
</span></span><span style="display:flex;"><span>        &gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;listings&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;h-screen flex flex-col&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">div</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;podcasts&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;flex-grow border-red-100 border-4 overflow-scroll&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">save-old-podcats</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                      if(current_podcast &amp;&amp; current_episode &amp;&amp; current_dir){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                          let old = {...podcast_last_episode}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                          old[current_podcast.name] = {episode: current_episode, dir: current_dir}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                          podcast_last_episode = old
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                          old = {...dir_last_episode}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                          old[current_dir] = {episode: current_episode, podcast: current_podcast}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                          dir_last_episode = old
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                      }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                      &#34;</span>
</span></span><span style="display:flex;"><span>           &gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-for</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;(podcasts, dir) in dirs&#34;</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;dir&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{extended: false}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">h1</span>
</span></span><span style="display:flex;"><span>              <span style="color:#008080">:class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;bg-yellow-100&#39;: current_dir === dir
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}&#34;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;rounded&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;extended = !extended&#34;</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-8 inline-block text-right&#34;</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;extended ? &#39;↓&#39; : &#39;→&#39;&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text-2xl&#34;</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;dir&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text-sm&#34;</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">stop</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   current_podcast = podcasts[0]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   current_dir = dir
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   current_episode = null // to trigger reload
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   await $nextTick()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   current_episode = podcasts[0].episodes[0]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   localStorage.setItem(`time_${current_episode.url}`, 0)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   sync_state[`time_${current_episode.url}`] = 0
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   await $nextTick() // wait for it to be ready
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   $dispatch(&#39;pleaseplay&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   $dispatch(&#39;pleaserewind&#39;)&#34;</span>&gt;▶&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text-sm&#34;</span> <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;dir in dir_last_episode&#34;</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">stop</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   let podcast = dir_last_episode[dir].podcast
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   let episode = dir_last_episode[dir].episode
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   current_podcast = podcast
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   current_dir = dir
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   current_episode = null // to trigger reload
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   await $nextTick()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   current_episode = episode
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   await $nextTick() // wait for it to be ready
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   $dispatch(&#39;pleaseplay&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                   $dispatch(&#39;pleaserewind&#39;)&#34;</span>
</span></span><span style="display:flex;"><span>                      &gt;resume&lt;/<span style="color:#000080">button</span>&gt; &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text-xs&#34;</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;dir_last_episode[dir] &amp;&amp; dir_last_episode[dir].podcast.name&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">h1</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">div</span> <span style="color:#008080">x-collapse</span> <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;extended&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;border-2 border-yellow-100 rounded&#34;</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-for</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;podcast in podcasts&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;podcast&#34;</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{extended: false}&#34;</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;show_old || localstoragegetter(podcast.name + &#39;_looped_first_episode&#39;) !== podcast.episodes[0].url&#34;</span>
</span></span><span style="display:flex;"><span>                     &gt;
</span></span><span style="display:flex;"><span>                  &lt;<span style="color:#000080">h2</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#008080">:class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;bg-blue-100&#39;: current_podcast &amp;&amp; current_podcast.name === podcast.name,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;text-red-100&#39;: localstoragegetter(podcast.name + &#39;_looped_first_episode&#39;) === podcast.episodes[0].url,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;font-bold&#39;: dir_last_episode[dir] &amp;&amp; (podcast.name === dir_last_episode[dir].podcast.name),
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}	&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;extended = !extended&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;rounded pl-8&#34;</span>
</span></span><span style="display:flex;"><span>                    &gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-8 inline-block text-right&#34;</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;extended ? &#39;↓&#39; : &#39;→&#39;&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;podcast.name&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text-lg&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text-sm&#34;</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">stop</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         current_podcast = podcast
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         current_dir = dir
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         current_episode = null // to trigger reload
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         await $nextTick()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         current_episode = podcast.episodes[0]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         localStorage.setItem(`time_${current_episode.url}`, 0)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         sync_state[`time_${current_episode.url}`] = 0
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         await $nextTick() // wait for it to be ready
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         $dispatch(&#39;pleaseplay&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         $dispatch(&#39;pleaserewind&#39;)&#34;</span>&gt;▶&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text-sm&#34;</span> <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;podcast.name in podcast_last_episode&#34;</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">stop</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         let dir = podcast_last_episode[podcast.name].dir
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         let episode = podcast_last_episode[podcast.name].episode
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         current_dir = dir
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         current_podcast = podcast
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         current_episode = null // to trigger reload
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         await $nextTick()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         current_episode = episode
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         await $nextTick() // wait for it to be ready
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         $dispatch(&#39;pleaseplay&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                         $dispatch(&#39;pleaserewind&#39;)&#34;</span>&gt;resume&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>                  &lt;/<span style="color:#000080">h2</span>&gt;
</span></span><span style="display:flex;"><span>                  &lt;<span style="color:#000080">div</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;episodes&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-slate-100 border-2 overflow-x-scroll&#34;</span> <span style="color:#008080">x-collapse</span> <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;extended&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-for</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;(episode, index) in podcast.episodes&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                      &lt;<span style="color:#000080">div</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;episode&#34;</span>
</span></span><span style="display:flex;"><span>                           <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">dblclick</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_episode = null ; await $nextTick() ; current_episode = episode ; current_podcast = podcast ; current_dir = dir ; current_playing = true&#34;</span>
</span></span><span style="display:flex;"><span>                           <span style="color:#008080">:class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;bg-green-100&#39;: current_episode &amp;&amp; current_episode.url === episode.url,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;text-red-100&#39;: localstoragegetter(podcast.name + &#39;_looped_first_episode&#39;) === podcast.episodes[0].url,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;font-bold&#39;: podcast.name in podcast_last_episode &amp;&amp; podcast_last_episode[podcast.name].episode.url === episode.url,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}&#34;</span>
</span></span><span style="display:flex;"><span>                           <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;rounded w-fit text-nowrap&#34;</span>
</span></span><span style="display:flex;"><span>                           &gt;
</span></span><span style="display:flex;"><span>                        &lt;<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>                          &lt;<span style="color:#000080">span</span> <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;episode.album&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;episode.album&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;:
</span></span><span style="display:flex;"><span>                            &lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;episode.index&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt; -
</span></span><span style="display:flex;"><span>                          &lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>                          &lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;episode.name&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;&lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;episode.date ? &#39; - &#39; + episode.date : &#39;&#39;&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>                      &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>                  &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">div</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;countdown&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;current_progress.duration&#39;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{motionreplaytimer: null, countdown: null, remaining_time: 0, time: $persist(1),
</span></span></span><span style="display:flex;"><span><span style="color:#d14"> start() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">     this.$dispatch(&#39;pleaseplay&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">     this.remaining_time = this.time * 60
</span></span></span><span style="display:flex;"><span><span style="color:#d14">     if(this.countdown)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">     {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         clearInterval(this.countdown)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         this.countdown = null
</span></span></span><span style="display:flex;"><span><span style="color:#d14">     }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">     this.countdown = setInterval(() =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         this.remaining_time-=1
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         if(this.remaining_time == 4)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">             this.$dispatch(&#39;pleasevolume&#39;, {volume: 0.8})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         if(this.remaining_time == 3)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">             this.$dispatch(&#39;pleasevolume&#39;, {volume: 0.6})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         if(this.remaining_time == 2)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">             this.$dispatch(&#39;pleasevolume&#39;, {volume: 0.4})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         if(this.remaining_time == 1)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">             this.$dispatch(&#39;pleasevolume&#39;, {volume: 0.2})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         if(this.remaining_time &lt;= 0){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">             this.$dispatch(&#39;pleasepause&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">             this.$dispatch(&#39;pleaserewind&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">             this.remaining_time = 0
</span></span></span><span style="display:flex;"><span><span style="color:#d14">             clearInterval(this.countdown)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">             this.countdown=null
</span></span></span><span style="display:flex;"><span><span style="color:#d14">             if(this.motionreplaytimer){clearTimeout(this.motionreplaytimer)}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">             this.motionreplaytimer = setTimeout(() =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 info(&#39;end of time to shake to play&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 this.motionreplaytimer = null
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 this.$dispatch(&#39;pleaserewind&#39;, {time: 50}) // I most likely missed the end
</span></span></span><span style="display:flex;"><span><span style="color:#d14">             }, 10000)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">         }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">     }, 1000)
</span></span></span><span style="display:flex;"><span><span style="color:#d14"> },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-full flex&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">devicemotion</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;let motion = (
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                 $event.acceleration.x * $event.acceleration.x
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                 + $event.acceleration.y * $event.acceleration.y
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                 + $event.acceleration.z * $event.acceleration.z
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                 )
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                 if(motion &gt; 400 &amp;&amp; motionreplaytimer){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                 clearTimeout(motionreplaytimer)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                 motionreplaytimer = null
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                 info(&#39;shaked, again!!&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                 start()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                 }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                 &#34;</span>
</span></span><span style="display:flex;"><span>           &gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">input</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;number&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-8&#34;</span> <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;time&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">input</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;number&#34;</span> <span style="color:#008080">disabled</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-8&#34;</span> <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;remaining_time&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">input</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;range&#34;</span> <span style="color:#008080">min</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;0&#34;</span> <span style="color:#008080">disabled</span> <span style="color:#008080">:max</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;time * 60&#34;</span> <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;time * 60 - remaining_time&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;flex-grow&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">button</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        if(countdown){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        clearInterval(countdown)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        countdown = null
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        $dispatch(&#39;pleasepause&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        $dispatch(&#39;pleaserewind&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        remaining_time = 0
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        else
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        start()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        &#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;countdown ? &#39;stop&#39; : &#39;start&#39;&#34;</span>&gt;&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_progress.duration&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">div</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;controls&#34;</span> <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_episode &amp;&amp; dirs&#34;</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">span</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;controls&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;flex place-content-evenly text-3xl&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">button</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;$dispatch(&#39;gotoprev&#39;)&#34;</span>&gt;⏮&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">button</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;$dispatch(&#39;pleaserewind&#39;)&#34;</span>&gt;⏪&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">button</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;$dispatch(current_playing ? &#39;pleasepause&#39; : &#39;pleaseplay&#39;)&#34;</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_playing ? &#39;⏸&#39; : &#39;▶&#39;&#34;</span>&gt;&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">button</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;$dispatch(&#39;pleaseffwd&#39;)&#34;</span>&gt;⏩&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">button</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;$dispatch(&#39;gotonext&#39;)&#34;</span>&gt;⏭&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">input</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;checkbox&#34;</span> <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;show_old&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text-sm&#34;</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    disabled: true,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    disabled_timer: null,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    async set_timer () {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        if(this.disabled_timer !== null){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            clearTimeout(this.disabled_timer)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        this.disabled_timer = setTimeout(() =&gt; {this.disabled = true; this.disabled_timer = null}, 5000)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}&#34;</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">dblclick</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;disabled = !disabled ; if(! disabled) {await set_timer()} else if (disabled_timer !== null) {clearTimeout(disabled_timer) ; disabled_timer=null;}&#34;</span>
</span></span><span style="display:flex;"><span>                  &gt;
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-8 text-right inline-block&#34;</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_speed&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;:
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#000080">input</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;align-middle&#34;</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;range&#34;</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">follow-current-episode</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if(current_episode){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    current_speed = localstoragegetter(key(&#39;rate&#39;)) || 1
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}&#34;</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_speed&#34;</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#008080">:disabled</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;disabled&#34;</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">input</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;$dispatch(&#39;pleasesetspeed&#39;, {speed: $el.value}) ; await set_timer()&#34;</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#008080">min</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;0.25&#34;</span> <span style="color:#008080">max</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;4&#34;</span> <span style="color:#008080">step</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;0.25&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">span</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;progress&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text-sm w-full flex flex-row&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    disabled: true,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    disabled_timer: null,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    async set_timer () {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        if(this.disabled_timer !== null){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            clearTimeout(this.disabled_timer)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        this.disabled_timer = setTimeout(() =&gt; {this.disabled = true; this.disabled_timer = null}, 5000)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">dblclick</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;disabled = !disabled ; if(! disabled) {await set_timer()} else if (disabled_timer !== null) {clearTimeout(disabled_timer) ; disabled_timer=null;}&#34;</span>
</span></span><span style="display:flex;"><span>                &gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;formatTime(current_progress.cur)&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;/&lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;formatTime(current_progress.duration)&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">input</span>
</span></span><span style="display:flex;"><span>              <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;range&#34;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;flex-grow&#34;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#008080">min</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;0&#34;</span> <span style="color:#008080">:max</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_progress.duration&#34;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#008080">:disabled</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;disabled&#34;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_progress.cur&#34;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">input</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;$dispatch(&#39;setcurrenttime&#39;, {value: $el.value}) ; await set_timer()&#34;</span>
</span></span><span style="display:flex;"><span>              /&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;player&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;flex justify-center bg-black&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    init_values() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        let cur = localstoragegetter(key(&#39;time&#39;))
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        if(cur)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.$el.currentTime = cur
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        let episode_rate = localstoragegetter(key(&#39;rate&#39;))
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        if(episode_rate)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.$el.playbackRate = parseFloat(episode_rate)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        else
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            let podcast_rate = localstoragegetter(`rate_${current_podcast.name}`)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            if(podcast_rate)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                this.$el.playbackRate = parseFloat(podcast_rate)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        window.v = this.$el
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    onended() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        localStorage.setItem(this.key(&#39;time&#39;), 0)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        sync_state[this.key(&#39;time&#39;)] = 0
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        this.$dispatch(&#39;gotonext&#39;, {playing: true})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    medium: {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        async [&#39;x-init&#39;]() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.init_values($el)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            if(&#39;mediaSession&#39; in navigator) {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                var artist = &#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                if(this.current_episode.index !== null)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    artist += `${this.current_episode.index}`
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                if(this.current_episode.number !== null)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    artist += `/${this.current_episode.number}`
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                if(artist !== &#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    artist += &#39; &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                artist += this.current_podcast.name
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                navigator.mediaSession.metadata = new MediaMetadata({
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    title: this.current_episode.name,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    artist: artist,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    album: this.current_episode.album || this.current_podcast.name,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                });
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                navigator.mediaSession.setActionHandler(&#39;nexttrack&#39;, () =&gt; {this.$dispatch(&#39;gotonext&#39;, {playing: true})});
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                navigator.mediaSession.setActionHandler(&#39;previoustrack&#39;, () =&gt; {this.$dispatch(&#39;gotoprev&#39;, {playing: true})});
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                navigator.mediaSession.playbackState = &#39;paused&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@pleasesetspeed.window&#39;]() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.$el.playbackRate = this.$event.detail.speed
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@pleasescroll.window&#39;]() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.$el.scrollIntoView()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@canplay&#39;]() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            if(this.current_playing) {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                this.$el.play()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.current_progress = {cur: this.$el.currentTime, duration: this.$el.duration}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@play&#39;]() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.$el.volume = 1
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.current_playing = true
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@pleaseplay.window&#39;](){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.$el.play()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@pleasevolume.window&#39;](){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.$el.volume = this.$event.detail.volume
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@pleasepause.window&#39;](){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.$el.pause()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@pleaseffwd.window&#39;](){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.$el.currentTime += 10
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@pleaserewind.window&#39;](){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.$el.currentTime -= this.$event.detail.time || 10
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@pause.window&#39;](){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.$el.pause()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        async [&#39;@loadeddata&#39;](){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            await $nextTick()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.$el.scrollIntoView()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@pause&#39;]() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.current_playing = false
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            if(this.$el.currentTime === this.$el.duration)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                this.onended()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@ended&#39;]() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            // this is not triggerd for audio in qutebrowser
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@timeupdate&#39;](){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            localStorage.setItem(this.key(&#39;time&#39;), this.$el.currentTime)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            sync_state[this.key(&#39;time&#39;)] = this.$el.currentTime
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.current_progress = {cur: this.$el.currentTime, duration: this.$el.duration}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@setcurrenttime.window&#39;]() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.$el.currentTime = this.$event.detail.value
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        [&#39;@ratechange&#39;](){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            localStorage.setItem(this.key(&#39;rate&#39;), this.$el.playbackRate)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            sync_state[this.key(&#39;rate&#39;)] = this.$el.playbackRate
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            localStorage.setItem(`rate_${current_podcast.name}`, this.$el.playbackRate)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            sync_state[`rate_${current_podcast.name}`] = this.$el.playbackRate
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            this.current_speed = this.$el.playbackRate
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}&#34;</span>
</span></span><span style="display:flex;"><span>         &gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_episode &amp;&amp; ( current_episode.url.endsWith(&#39;mp3&#39;) || current_episode.url.endsWith(&#39;ogg&#39;) || current_episode.url.endsWith(&#39;m4a&#39;))&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">audio</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-full&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#008080">x-bind</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;medium&#34;</span>
</span></span><span style="display:flex;"><span>               &gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">source</span> <span style="color:#008080">:src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_episode &amp;&amp; current_episode.url&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;audio/mpeg&#34;</span>&gt;
</span></span><span style="display:flex;"><span>          Your browser does not support the audio element.
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">audio</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_episode &amp;&amp; ! ( current_episode.url.endsWith(&#39;mp3&#39;) || current_episode.url.endsWith(&#39;ogg&#39;) || current_episode.url.endsWith(&#39;m4a&#39;))&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">video</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-screen max-h-screen object-contain&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#008080">x-bind</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;medium&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       async click(event) {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       xpos = event.offsetX / event.target.clientWidth
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       ypos = event.offsetY / event.target.clientHeight
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       if(xpos &lt; 0.25) {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       info(&#39;rewind&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       this.$dispatch(&#39;pleaserewind&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       else if (xpos &gt; 0.75) {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       info(&#39;ffwd&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       this.$dispatch(&#39;pleaseffwd&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       else {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       if(ypos &gt; 0.80)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       info(&#39;PIP&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       try{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       await this.$el.requestPictureInPicture()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       } catch(e) {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       info(JSON.stringify(e))
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       else
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       info(&#39;toggling&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       if(this.current_playing){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       this.$dispatch(&#39;pleasepause&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       else
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       this.$dispatch(&#39;pleaseplay&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                       }&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">dblclick</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;await click($event)&#34;</span>
</span></span><span style="display:flex;"><span>               &gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">source</span> <span style="color:#008080">:src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_episode &amp;&amp; current_episode.url&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;audio/mpeg&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">video</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">html</span>&gt;
</span></span></code></pre></div><p><a id="code-snippet--manifest"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;podcast&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;short_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;podcast&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;podcast&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;start_url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;./podcast.html&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;fullscreen&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;background_color&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;#cccccc&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;theme_color&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;#4285f4&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;orientation&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;any&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;icons&#34;</span><span style="color:#000;font-weight:bold">:</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;src&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;./podcast.png&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;image/png&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;sizes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;192x192&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;scope&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;./&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;permissions&#34;</span><span style="color:#000;font-weight:bold">:</span> [],
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;splash_pages&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;categories&#34;</span><span style="color:#000;font-weight:bold">:</span> []
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Note: Beware that we should not provide an orientation so as to follow the device one.</p>
<p>I put this icon aside with the manifest (generated with the prompt &ldquo;generate a 192x192 image on the theme podcast&rdquo; in chatgpt).</p>
<figure><img src="https://ipfs.konubinix.eu/ipfs/bafkreidevqahhxwujey5dh6jdzwtjipc6tkd7ndcgq547mvgfsuu433xci?filename=podcast.png">
</figure>

<p><a id="code-snippet--sw"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// taken from https://googlechrome.github.io/samples/service-worker/basic/
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">const</span> CACHE_NAME <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;podcastcache&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">const</span> DYNAMIC_URLS <span style="color:#000;font-weight:bold">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;./podcast.html&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;./podcasts.json&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;./podcastmanifest.json&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;./swpodcast.js&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;./podcast.png&#34;</span>,
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">// A list of local resources we always want to be cached.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">const</span> PRECACHE_URLS <span style="color:#000;font-weight:bold">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;/ipfs/bafkreidregenuw7nhqewvimq7p3vwwlrqcxjcrs4tiocrujjzggg26gzcu?orig=https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;/ipfs/bafkreighmyou4lhqizpdzvutdeg6xnpvskwhfxgez7tfawason3hkwfspm?orig=https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;/ipfs/bafkreic33rowgvvugzgzajagkuwidfnit2dyqyn465iygfs67agsukk24i?orig=https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;/ipfs/bafybeihp5kzlgqt56dmy5l4z7kpymfc4kn3fnehrrtr7cid7cn7ra36yha?orig=https://cdn.tailwindcss.com/3.4.3&#34;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span>self.addEventListener(<span style="color:#d14">&#39;install&#39;</span>, event =&gt; {
</span></span><span style="display:flex;"><span>    event.waitUntil(
</span></span><span style="display:flex;"><span>        caches.open(CACHE_NAME)
</span></span><span style="display:flex;"><span>            .then(cache =&gt; cache.addAll([
</span></span><span style="display:flex;"><span>                ...PRECACHE_URLS,
</span></span><span style="display:flex;"><span>                ...DYNAMIC_URLS
</span></span><span style="display:flex;"><span>            ]))
</span></span><span style="display:flex;"><span>            .then(self.skipWaiting())
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">// clean up old caches
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>self.addEventListener(<span style="color:#d14">&#39;activate&#39;</span>, event =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">const</span> currentCaches <span style="color:#000;font-weight:bold">=</span> [CACHE_NAME];
</span></span><span style="display:flex;"><span>    event.waitUntil(
</span></span><span style="display:flex;"><span>        caches.keys().then(cacheNames =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> cacheNames.filter(cacheName =&gt; <span style="color:#000;font-weight:bold">!</span>currentCaches.includes(cacheName));
</span></span><span style="display:flex;"><span>        }).then(cachesToDelete =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> <span style="color:#0086b3">Promise</span>.all(cachesToDelete.map(cacheToDelete =&gt; {
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">return</span> caches.<span style="color:#000;font-weight:bold">delete</span>(cacheToDelete);
</span></span><span style="display:flex;"><span>            }));
</span></span><span style="display:flex;"><span>        }).then(() =&gt; self.clients.claim())
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">// taken from https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Guides/Caching
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">function</span> cacheFirst(request) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">const</span> cachedResponse <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> caches.match(request);
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> (cachedResponse) {
</span></span><span style="display:flex;"><span>        console.log(<span style="color:#d14">`Get </span><span style="color:#d14">${</span>request.url<span style="color:#d14">}</span><span style="color:#d14"> from the cache (cacheFirst)`</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> cachedResponse;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// for some reason, the intercepted requests uses crendentials: include,
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// leading to an error, explicitely tell to omit credentials then. I
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// also have to explicitely tell it that I want to use cors.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">const</span> networkResponse <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> fetch(request, { mode<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;cors&#39;</span>, credentials<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;omit&#39;</span> });
</span></span><span style="display:flex;"><span>        console.log(<span style="color:#d14">`cacheFirst: </span><span style="color:#d14">${</span>request.url<span style="color:#d14">}</span><span style="color:#d14">: </span><span style="color:#d14">${</span>request.credentials<span style="color:#d14">}</span><span style="color:#d14">, </span><span style="color:#d14">${</span>networkResponse.ok<span style="color:#d14">}</span><span style="color:#d14">, </span><span style="color:#d14">${</span>networkResponse.status<span style="color:#d14">}</span><span style="color:#d14">, </span><span style="color:#d14">${</span>networkResponse.statusText<span style="color:#d14">}</span><span style="color:#d14">`</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> (networkResponse.ok) {
</span></span><span style="display:flex;"><span>            console.log(<span style="color:#d14">`cacheFirst: Put </span><span style="color:#d14">${</span>request.url<span style="color:#d14">}</span><span style="color:#d14"> into the cache`</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">const</span> cache <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> caches.open(CACHE_NAME);
</span></span><span style="display:flex;"><span>            cache.put(request, networkResponse.clone());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            console.log(<span style="color:#d14">`cacheFirst: bad response with </span><span style="color:#d14">${</span>request.url<span style="color:#d14">}</span><span style="color:#d14">`</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> networkResponse;
</span></span><span style="display:flex;"><span>    } <span style="color:#000;font-weight:bold">catch</span> (error) {
</span></span><span style="display:flex;"><span>        console.log(<span style="color:#d14">`cacheFirst: error with </span><span style="color:#d14">${</span>request.url<span style="color:#d14">}</span><span style="color:#d14">`</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> Response.error();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">function</span> networkFirst(request) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">const</span> networkResponse <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> fetch(request);
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> (networkResponse.ok) {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">const</span> cache <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> caches.open(CACHE_NAME);
</span></span><span style="display:flex;"><span>            console.log(<span style="color:#d14">`Put </span><span style="color:#d14">${</span>request.url<span style="color:#d14">}</span><span style="color:#d14"> into the cache (networkfirst), </span><span style="color:#d14">${</span>request.credentials<span style="color:#d14">}</span><span style="color:#d14">`</span>)
</span></span><span style="display:flex;"><span>            cache.put(request, networkResponse.clone());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> networkResponse;
</span></span><span style="display:flex;"><span>    } <span style="color:#000;font-weight:bold">catch</span> (error) {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">const</span> cachedResponse <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> caches.match(request);
</span></span><span style="display:flex;"><span>        console.log(<span style="color:#d14">`Got </span><span style="color:#d14">${</span>request.url<span style="color:#d14">}</span><span style="color:#d14"> from the cache (networkfirst)`</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> cachedResponse <span style="color:#000;font-weight:bold">||</span> Response.error();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>self.addEventListener(<span style="color:#d14">&#39;fetch&#39;</span>, event =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">const</span> dynamicUrlsRegex <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> <span style="color:#0086b3">RegExp</span>(<span style="color:#d14">`^.*(</span><span style="color:#d14">${</span>DYNAMIC_URLS.join(<span style="color:#d14">&#39;|&#39;</span>)<span style="color:#d14">}</span><span style="color:#d14">).*`</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> (event.request.url.match(dynamicUrlsRegex)) {
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// this is likely to change from time to time, use a network first approach
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        console.log(<span style="color:#d14">`Dealing with </span><span style="color:#d14">${</span>event.request.url<span style="color:#d14">}</span><span style="color:#d14"> (networkfirst)`</span>)
</span></span><span style="display:flex;"><span>        event.respondWith(networkFirst(event.request));
</span></span><span style="display:flex;"><span>    } <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> (event.request.url.includes(<span style="color:#d14">&#34;/ipfs/&#34;</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// ipfs content never changes, get it from the cache if possible
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        console.log(<span style="color:#d14">`Dealing with </span><span style="color:#d14">${</span>event.request.url<span style="color:#d14">}</span><span style="color:#d14"> (cacheFirst)`</span>)
</span></span><span style="display:flex;"><span>        event.respondWith(cacheFirst(event.request));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        console.log(<span style="color:#d14">`Leaving </span><span style="color:#d14">${</span>event.request.url<span style="color:#d14">}</span><span style="color:#d14"> to the browser`</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="notes-linking-here">Notes linking here</h2>
<ul>
<li><a href="/braindump/posts/pwa_vs_kivy_app/">pwa vs kivy app</a></li>
</ul>
<h2 id="permalink"><a href="/braindump/9e6b6eff-c01c-478a-980a-859acd4073a3?title=some_simple_podcast_player">Permalink</a></h2>
      </div>
	  <aside class="date"><time>Last updated: 30 Jun 2025</time></aside>
	  <aside class="date"><time>Published&nbsp;&nbsp;&nbsp;: 17 Mar 2024</time></aside>
    </div>
  </div>
</div>

<script src="/braindump/js/URI.js" type="text/javascript"></script>

<script src="/braindump/js/page.js" type="text/javascript"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
