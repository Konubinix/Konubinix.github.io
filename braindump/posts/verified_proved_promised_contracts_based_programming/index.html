<!DOCTYPE html>
<html><title>verified/proved promised contracts based programming</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="bLmaFyyXugiCqSup-eIIIx0B4CngtdF_svyMMKQbS5E" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, minimum-scale=0.5, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src="https://hypothes.is/embed.js" async></script>


<link rel="stylesheet" href="/braindump/css/main.min.56b43bcbc759a196f9dd525bee62bdec45a29ba95902bbab74a4f7ad2ea3e8cb.css"/>

<link rel="stylesheet" href="/braindump/css/links.min.4bf1990b213fb76d2a66153dc6ef9a57d49f536c6baf6e7f19a7948470a38141.css"/>

<link rel="stylesheet" href="/braindump/css/konubinix.min.cf2d0f36945178c647979ee68f1830892e06aa3d481d8913728b5c7462b97f6e.css"/>

<link rel="stylesheet" href="/ipfs/QmQFVQS89fv1XUNFcjwCKDePzckuT9kpuAVNYUwNdEfYcv/css/all.css"/>
<link rel="shortcut icon" href="/ipfs/QmVFwYV7YRZLKU3ybN1hW4jqfyZGPLKJwd8toN2wHz5UAD?a.png" type="image/x-icon" />

<body><header>
  <div>
	<a href="/braindump//"><h5 class="site-title">Konubinix&#39; opinionated web of thoughts</h5></a>
  </div>
  <span>
	<a href="/blog/"><i class="icon fas fa-blog"></i></a>
	<a href="/braindump/posts/"><i class="icon fas fa-brain"></i></a>
    <a href="mailto:konubinixweb@gmail.com"><i class="icon fas fa-envelope-square"></i></a>
    <a href="https://github.com/konubinix"><i class="icon fab fa-github-square"></i></a>
    <a href="https://linkedin.com/in/samuel-loury-61259040"><i class="icon fab fa-linkedin"></i></a>
	<a href="/braindump/graph.html"><i class="icon fas fa-project-diagram"></i></a>
	<a href="/braindump/index.xml"><i class="icon fas fa-rss-square"></i></a>
	<a href="/braindump/tags/"><i class="icon fa fa-tag"></i></a>
	<a href="/braindump/braindump_search"><i class="icon fa fa-search"></i></a>
  </span>
</header>

<div class="grid-container">
  <div class="grid">
    <div class="page" data-level="1">
      <div class="content">
		<p class="lead">
        <h1>Verified/Proved Promised Contracts Based Programming</h1>
		<span class="badge badge-pill badge-warning"><a href="/braindump/tags/fleeting/">Fleeting</a></span></p>
        <blockquote>
<p>thinking about your solution to figure out its properties can give you deeper
insights into the problem, leading to even better solutions</p>
</blockquote>
<blockquote>
<p>&mdash; <a href="https://semaphoreci.com/blog/property-based-testing-python-hypothesis-pytest">https://semaphoreci.com/blog/property-based-testing-python-hypothesis-pytest</a></p>
</blockquote>
<p>link with <a href="/braindump/posts/test_driven_development/">TDD</a> and <a href="/braindump/posts/behavior_driven_development/">BDD</a> -&gt; you focus on the <a href="/braindump/posts/objectif_final/">final objective</a> -&gt; describe as good as
possible the properties the code needs to have. The tests are only the measure
of those property in time.</p>
<p><a href="/braindump/posts/consider_tests_as_being_an_instrumental_objective/">consider tests as being an instrumental objective</a></p>
<p><a href="/braindump/posts/how_to_organise_your_tests/">how to organise your tests?</a>, <a href="/braindump/posts/common_structure_of_tests/">common structure of tests</a>, <a href="/braindump/posts/tdd_vs_bdd/">tdd vs bdd</a>,</p>
<p>the test checks that the property P is there, hence</p>
<p>the code has property P =&gt; the test passes</p>
<p>therefore the test does not pass =&gt; the code does not have property P</p>
<p>but also</p>
<p>the code does not have property P =&gt; the test does not pass</p>
<p>therefore</p>
<p>the test passes =&gt; the code has property P</p>
<p>There should be a logical link between those. In current situations, there are
tests and code, but they are not linked to the promises.</p>
<p>When creating some code, one makes <a href="https://konubinix.eu/blog/posts/making_an_api_is_making_a_promise/?title=making_an_api_is_making_a_promise#">promises</a> about what the code does. The tests
should be the way to make sure those (the verifiers) promises still hold in time.</p>
<p>because <a href="#docs-and-tests-are-two-sides-of-the-same-coin">docs and tests are two sides of the same coin</a>, it would be great to have
some link between those, maybe using <a href="/braindump/posts/literate_programming/">literate programming</a>. The source of truth
would not be the test or the documentation, but this first document that link
both. (<a href="/braindump/posts/curated_tests/">curated tests</a>)</p>
<p>When a test fails, you can trace it back to the promise that won&rsquo;t hold
anymore. Having a document telling the story and extracting the tests from it
would ease this.</p>
<p>Also, this would ease getting to <a href="/braindump/posts/promises_coverage/">promises coverage</a>.</p>
<p>Anecdote. I was being shown the code of some person that took pride in how much
the code coverage was high and in the number of tests. I simply tried the code
in the situation that was documented. Doing so, we highlighted several bugs and
some &ldquo;yeah, I know, I need to work on that&rdquo;. In that case, I think the colleague
focused so much on the test that per did not think about what promise about the
code per would need to make.</p>
<p>I think that writing low level tests help a lot, mostly during the development
(see <a href="/braindump/posts/test_driven_development/">TDD</a>). But people tend to write them and forget them. I think they need
to be constantly revised to check whether they still verify something that makes
sense with regard to what the code is promised to do. Sometimes, you write
higher level tests that encompass several stuff and are fast enough to be run in
all the situations the low level tests also run. In that case, the low level
tests are of little importance. Even the argument of &ldquo;one test for each tiny
piece of information&rdquo; does not hold in my experience,</p>
<ol>
<li>I have never seen a case where I could not guess the low level issue behind a higher level test,</li>
<li>the low level test is generally so precise that you don&rsquo;t even understand why
you tested that in the first place,</li>
</ol>
<p>There are so many ways the code may behave that we know we cannot follow all
those paths. We have to make choices about the paths we ought to test. Using
promises helps a lot doing so. Focusing to much on the low level tests makes
people loose sight of the <a href="/braindump/posts/gestalt/">gestalt</a> and the paths that actually make sense.</p>
<p>When one works on a piece of code, one needs to be clear about how per code will
be used. Those promises become the contract that the person ought to
respect. For instance, if you write a whole application, the contract is towards
the end user. Testing the libraries should be done only if there is confidence
that it gives insights on whether this high level contract is respected or
not. On the other hand, when working in a big company on a big program, you
might end up working on only a library of the whole stuff. In that case, I think
knowing the bigger pictures helps making good decisions, but the contract is
about the library itself, with whomever will use it.</p>
<p>IOT, it is the interface with whomever will use your work that matter, not the
lower level details that build those interfaces.</p>
<p>In my mind, this reasoning leads to the same kind of <a href="/braindump/posts/pyramid_of_tests/">pyramid of tests</a>, with unit
tests, integration tests and so on. Only that having this reasoning helps not
<a href="/braindump/posts/avoir_raison_pour_de_mauvaises_raisons/">being right for the wrong reasons</a> and then make better decisions when the test
stack becomes so big it cannot pass in a few seconds and some architectural
choices need to be taken w.r.t. testing.</p>
<p>For example, it makes total sense to scan thoroughly some function if it is part of your promise.</p>
<blockquote>
<p>@given(
st.integers(min_value=1, max_value=100),
st.integers(min_value=-500, max_value=500),
)
def test_gcd(n, m):
d = gcd(n, m)</p>
<p>&mdash; <a href="https://semaphoreci.com/blog/property-based-testing-python-hypothesis-pytest">https://semaphoreci.com/blog/property-based-testing-python-hypothesis-pytest</a></p>
</blockquote>
<p>Yet, it makes much fewer sense if this function is only part of some bigger
stack that you know won&rsquo;t use most of its values.</p>
<p>It&rsquo;s like having E -&gt; f -&gt; F, you could test all the possible values of E, or
only the subset E&rsquo; that matter for your promises.</p>
<p>Tests should not be done per se, but they should be done because they measure
how much we satisfy some promise about some interface. The real question is &ldquo;Is
this promise held about the interface with the user of my work?&rdquo; and by
<a href="/braindump/posts/substitution_de_question/">question substitution</a>, it becomes &ldquo;How much tests and code coverage do I
have?&rdquo;. I think it is important to work on the latter (as <a href="/braindump/posts/heuristique/">heuristic</a>) while
being able to focus on the former when hard decisions are needed.</p>
<p>If one has the sensible habit of always testing the code per write, it is easy
to have a high <a href="/braindump/posts/code_coverage/">code coverage</a> value in the end. But when the code is not part of
the paths triggered by the interface anymore, then this coverage covers mostly
dead code.</p>
<p>Also, you may write tests to check some paths that theoretically could happen
when using the library, but cannot structurally be called while using the
interface.</p>
<p>There should be a link between the interface and the tests so that you can
answer the question &ldquo;why does this tests exist?&rdquo;. The answer should be &ldquo;this
test is useful because it verifies the promise X&rdquo;.</p>
<p><a href="/braindump/posts/gherkin_language/">Gherkin</a> helps in the sense it gives a high level way of telling the promise the
interface makes, written in collaboration with the <a href="/braindump/posts/three_amigos/">three amigos</a>. There should be
a way to link those to lower level tests.</p>
<ol>
<li>tell a proposition on the code that is important. This is generally a high level story.</li>
<li>decide how you will measure that this proposition is true
<ol>
<li>either run the whole story,</li>
<li>or run a thing slightly shorter, but with explanation (proof) of how it
entails the proposition,</li>
<li>or run several slightly shorter stuff, but with explanation (proof) of how
those, together, entail the proposition.</li>
</ol>
</li>
</ol>
<p>Doing so, you hopefully will get used to maintain the proofs as well as the code
running them and the logical construct &ldquo;Proposition1 =&gt; Test1 ^ Test2 ^ &hellip; ^
Testn&rdquo; is written down. That way, you can safely say that if either Test1 to
Testn fails, then the proposition is false and hope for the equivalence.</p>
<h2 id="docs-and-tests-are-two-sides-of-the-same-coin">docs and tests are two sides of the same coin</h2>
<p>When you write the doc, you try to educate the reader with what the code promises it will bring to them.</p>
<p>When you write the tests, you try as automatically as possible to make sure that those promises hold</p>
<h2 id="example-with-clk">example with clk</h2>
<p>After a <a href="https://github.com/clk-project/clk/commit/f681c096fc1bb1db117cb3279c94ee58c1da2e45">small change</a> of only 3 lines of code.</p>
<ol>
<li>only two lines were covered by tests, hence 66% on <a href="/braindump/posts/sonar_new_code_definition/">sonar new code definition</a></li>
<li><a href="/braindump/posts/sonar_cloud/">sonar cloud</a> tells me I don&rsquo;t pass the <a href="/braindump/posts/sonar_quality_gate/">sonar quality gate</a></li>
<li>my <a href="/braindump/posts/machine_associative/">system 1</a> tells me to create a test to cover that line and keep going</li>
<li>but my <a href="/braindump/posts/controleur_paresseux/">system 2</a> tells me to wonder why this line exists.</li>
<li>I end up writing a <a href="https://clk-project.org/doc/use_cases/bash_command_from_alias.html">full document</a><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> to explain the feature, why it is there
and how it is meant to be used.</li>
<li>in the process I realized that there were a bunch of issues that I did not
spot. Even the two lines of code that where covered were completely
wrong. The story I wanted to tell did not actually work unless I fixed the
code at a few more locations. This is <a href="https://github.com/clk-project/clk/commit/d50c5583613e7a11cfcf1ea685bbd97878e309e3">the commit</a> I ended with.</li>
<li>in the end, it took a long time to write, but it was worth it, because
<ol>
<li>I could clarify the promise I wanted to make,</li>
<li>I could fix other parts of the code,</li>
<li>It felt <a href="/braindump/posts/intellectually_honest/">right</a> to make a promise about the code and making sure it goes
as intended. I felt like I did not fall into the trap of
<a href="/braindump/posts/loi_de_goodhart/">measure-objective inversion</a> and <a href="/braindump/posts/avoir_l_intuition_de_faire_les_choses_bien_vs_etre_convaincu_de_faire_les_choses_bien/">feeling good bias</a></li>
</ol>
</li>
</ol>
<h2 id="notes-linking-here">Notes linking here</h2>
<ul>
<li><a href="/braindump/posts/affranchir_de_la_pyramide_des_tests_jonathan_boccara/">affranchir de la Pyramide des Tests (Jonathan Boccara)</a></li>
<li><a href="/braindump/posts/apprendre_de_nos_erreurs/">apprendre de nos erreurs</a></li>
<li><a href="/braindump/posts/place_of_tests_in_software_development/">place of tests in software development</a></li>
<li><a href="/braindump/posts/progressive_enhancement/">progressive enhancement</a></li>
<li><a href="/braindump/posts/several_flavors_of_testing_one_s_code/">several flavors of testing one&rsquo;s code</a></li>
<li><a href="/braindump/posts/should_we_create_implementations_that_deals_with_anticipated_features/">should we create implementations that deals with anticipated features?</a></li>
<li><a href="/braindump/posts/test_driven_development/">test-driven development</a></li>
<li><a href="/braindump/posts/code_coverage/#id-97111bc8-3cfa-4a1f-8a34-c689d66ee9f2-unintended-consequences-of-id-8bc70880-877b-4d06-ab3b-7aea191ef83e-code-coverage">unintended consequences of code coverage</a></li>
</ul>
<h2 id="permalink"><a href="https://konubinix.eu/braindump/a0c856fe-e0cf-4eef-bd30-53c867a2a299?title=verified_proved_promised_contracts_based_programming">Permalink</a></h2>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>I don&rsquo;t have permalinks for that. Hopefully it won&rsquo;t lead to 404 error. If so, please let me know.</p>
<!--more-->
&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></li>
</ol>
</div>
      </div>
	  <aside class="date"><time>Last updated: 26 Sep 2023</time></aside>
	  <aside class="date"><time>Published&nbsp;&nbsp;&nbsp;: 02 Jan 2023</time></aside>
    </div>
  </div>
</div>

<script src="/braindump/js/URI.js" type="text/javascript"></script>

<script src="/braindump/js/page.js" type="text/javascript"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
