<!DOCTYPE html>
<html><title>pomodo timer on kivy</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="bLmaFyyXugiCqSup-eIIIx0B4CngtdF_svyMMKQbS5E" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, minimum-scale=0.5, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src="https://hypothes.is/embed.js" async></script>


<link rel="stylesheet" href="/braindump/css/main.min.56b43bcbc759a196f9dd525bee62bdec45a29ba95902bbab74a4f7ad2ea3e8cb.css"/>

<link rel="stylesheet" href="/braindump/css/links.min.4bf1990b213fb76d2a66153dc6ef9a57d49f536c6baf6e7f19a7948470a38141.css"/>

<link rel="stylesheet" href="/braindump/css/konubinix.min.cf2d0f36945178c647979ee68f1830892e06aa3d481d8913728b5c7462b97f6e.css"/>

<link rel="stylesheet" href="/ipfs/QmQFVQS89fv1XUNFcjwCKDePzckuT9kpuAVNYUwNdEfYcv/css/all.css"/>
<link rel="shortcut icon" href="/ipfs/QmVFwYV7YRZLKU3ybN1hW4jqfyZGPLKJwd8toN2wHz5UAD?a.png" type="image/x-icon" />

<body><header>
  <div>
	<a href="/braindump//"><h5 class="site-title">Konubinix&#39; opinionated web of thoughts</h5></a>
  </div>
  <span>
	<a href="/blog/"><i class="icon fas fa-blog"></i></a>
	<a href="/braindump/posts/"><i class="icon fas fa-brain"></i></a>
    <a href="mailto:konubinixweb@gmail.com"><i class="icon fas fa-envelope-square"></i></a>
    <a href="https://github.com/konubinix"><i class="icon fab fa-github-square"></i></a>
    <a href="https://linkedin.com/in/samuel-loury-61259040"><i class="icon fab fa-linkedin"></i></a>
	<a href="/braindump/graph.html"><i class="icon fas fa-project-diagram"></i></a>
	<a href="/braindump/index.xml"><i class="icon fas fa-rss-square"></i></a>
	<a href="/braindump/tags/"><i class="icon fa fa-tag"></i></a>
	<a href="/braindump/braindump_search"><i class="icon fa fa-search"></i></a>
  </span>
</header>

<div class="grid-container">
  <div class="grid">
    <div class="page" data-level="1">
      <div class="content">
		<p class="lead">
        <h1>Pomodo Timer on Kivy</h1>
		<span class="badge badge-pill badge-warning"><a href="/braindump/tags/fleeting/">Fleeting</a></span></p>
        <p><a href="/braindump/posts/pomodoro_technique/">pomodo timer</a> on <a href="/braindump/posts/kivy/">kivy</a>, using my <a href="https://konubinix.eu/blog/posts/a_python_runtime_on_android/?title=a_python_runtime_on_android#">a python runtime on android</a></p>
<p>Following the code of <a href="/braindump/posts/interval_timer/#887c6b43-0363-429d-9bc7-6b1492cc262e">doing again, with old python2 kivy, to reuse my wiko cink peax</a></p>
<p><a id="code-snippet--main-ex"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-org" data-lang="org"><span style="display:flex;"><span>import time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>import plyer
</span></span><span style="display:flex;"><span>from kivy.app import App
</span></span><span style="display:flex;"><span>from jnius import autoclass
</span></span><span style="display:flex;"><span>import requests
</span></span><span style="display:flex;"><span>from kivy.clock import Clock
</span></span><span style="display:flex;"><span>from kivy.lang import Builder
</span></span><span style="display:flex;"><span>from kivy.uix.boxlayout import BoxLayout
</span></span><span style="display:flex;"><span>from kivy.core.camera import Camera
</span></span><span style="display:flex;"><span>import base64
</span></span><span style="display:flex;"><span>from datetime import datetime, timedelta
</span></span><span style="display:flex;"><span>from kivy.graphics import Color, Rectangle
</span></span><span style="display:flex;"><span>from kivy.properties import StringProperty
</span></span><span style="display:flex;"><span>import os
</span></span><span style="display:flex;"><span>from datetime import datetime
</span></span><span style="display:flex;"><span>from kivy.uix.screenmanager import Screen, ScreenManagerException, ScreenManager
</span></span><span style="display:flex;"><span>from helpers.osc import oschandler, to_service
</span></span><span style="display:flex;"><span>from helpers.wakelock import WakeLock
</span></span><span style="display:flex;"><span>from logging import getLogger
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logger = getLogger(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>wl = WakeLock(&#39;pomodorotimer&#39;, wakeup=True)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pink = (1, 0.75, 0.8, 1)
</span></span><span style="display:flex;"><span>cyan = (0, 1, 1, 1)
</span></span><span style="display:flex;"><span>grey = (0.3, 0.3, 0.3, 1)
</span></span><span style="display:flex;"><span>green = (0, 0.9, 0.3, 1)
</span></span><span style="display:flex;"><span>blue = (0, 0.8, 0.8, 1)
</span></span><span style="display:flex;"><span>yellow = (0.8, 0.8, 0, 1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Builder.load_string(&#34;&#34;&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#d14">Pomodoro</span>&gt;:
</span></span><span style="display:flex;"><span>    id: pomodoro
</span></span><span style="display:flex;"><span>    orientation: &#34;vertical&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    BoxLayout:
</span></span><span style="display:flex;"><span>        orientation: &#34;horizontal&#34;
</span></span><span style="display:flex;"><span>        size_hint: (1, 0.5)
</span></span><span style="display:flex;"><span>        Label:
</span></span><span style="display:flex;"><span>            id: endtime
</span></span><span style="display:flex;"><span>            text: &#34;&#34;
</span></span><span style="display:flex;"><span>            font_size: 100
</span></span><span style="display:flex;"><span>            color: (0, 0, 0, 1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Label:
</span></span><span style="display:flex;"><span>            id: countdown
</span></span><span style="display:flex;"><span>            text: &#34;&#34;
</span></span><span style="display:flex;"><span>            font_size: 100
</span></span><span style="display:flex;"><span>            color: (0, 0, 0, 1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ProgressBar:
</span></span><span style="display:flex;"><span>        id: progress
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    BoxLayout:
</span></span><span style="display:flex;"><span>        orientation: &#34;horizontal&#34;
</span></span><span style="display:flex;"><span>        size_hint: (1, 0.5)
</span></span><span style="display:flex;"><span>        Button:
</span></span><span style="display:flex;"><span>            disabled: pomodoro.state not in (&#34;idle&#34;, &#34;break&#34;)
</span></span><span style="display:flex;"><span>            text: &#34;Start&#34;
</span></span><span style="display:flex;"><span>            on_press: root.start()
</span></span><span style="display:flex;"><span>            color: (0, 0, 0, 1)
</span></span><span style="display:flex;"><span>            background_color: {pink}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Button:
</span></span><span style="display:flex;"><span>            text: &#34;Break&#34;
</span></span><span style="display:flex;"><span>            disabled: pomodoro.state != &#34;idle&#34;
</span></span><span style="display:flex;"><span>            on_press: root.short_break()
</span></span><span style="display:flex;"><span>            color: (0, 0, 0, 1)
</span></span><span style="display:flex;"><span>            background_color: {green}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Button:
</span></span><span style="display:flex;"><span>            disabled: pomodoro.state != &#34;idle&#34;
</span></span><span style="display:flex;"><span>            text: &#34;Long Break&#34;
</span></span><span style="display:flex;"><span>            on_press: root.long_break()
</span></span><span style="display:flex;"><span>            color: (0, 0, 0, 1)
</span></span><span style="display:flex;"><span>            background_color: {green}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Button:
</span></span><span style="display:flex;"><span>            disabled: pomodoro.state not in (&#34;pomodoro&#34;, &#34;interruption&#34;)
</span></span><span style="display:flex;"><span>            text: &#34;Interruption&#34;
</span></span><span style="display:flex;"><span>            on_press: root.interruption()
</span></span><span style="display:flex;"><span>            color: (0, 0, 0, 1)
</span></span><span style="display:flex;"><span>            background_color: {blue}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Button:
</span></span><span style="display:flex;"><span>            text: &#34;Exterruption&#34;
</span></span><span style="display:flex;"><span>            disabled: pomodoro.state not in (&#34;pomodoro&#34;, &#34;exterruption&#34;)
</span></span><span style="display:flex;"><span>            on_press: root.exterruption()
</span></span><span style="display:flex;"><span>            color: (0, 0, 0, 1)
</span></span><span style="display:flex;"><span>            background_color: {blue}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Button:
</span></span><span style="display:flex;"><span>            disabled: pomodoro.state not in (&#34;pomodoro&#34;, &#34;twominutes&#34;)
</span></span><span style="display:flex;"><span>            text: &#34;Two minutes&#34;
</span></span><span style="display:flex;"><span>            on_press: root.twominutes()
</span></span><span style="display:flex;"><span>            color: (0, 0, 0, 1)
</span></span><span style="display:flex;"><span>            background_color: {yellow}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># copy from the source code of kivy, but increased</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#d14">ProgressBar</span>&gt;:
</span></span><span style="display:flex;"><span>    canvas:
</span></span><span style="display:flex;"><span>        Color:
</span></span><span style="display:flex;"><span>            rgb: 1, 1, 1
</span></span><span style="display:flex;"><span>        BorderImage:
</span></span><span style="display:flex;"><span>            border: (12, 12, 12, 12)
</span></span><span style="display:flex;"><span>            pos: self.x, self.y
</span></span><span style="display:flex;"><span>            size: self.width, self.height
</span></span><span style="display:flex;"><span>            source: &#39;atlas://data/images/defaulttheme<span style="color:#000;font-style:italic">/progressbar_background&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        BorderImage:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            border: [int(min(self.width * (self.value /</span> float(self.max)) if self.max else 0, 12))] * 4
</span></span><span style="display:flex;"><span>            pos: self.x, self.y
</span></span><span style="display:flex;"><span>            size: self.width * (self.value <span style="color:#000;font-style:italic">/ float(self.max)) if self.max else 0, self.height
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            source: &#39;atlas:/</span>/data/images/defaulttheme<span style="color:#000;font-style:italic">/progressbar&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">&#34;&#34;&#34;.format(**{&#34;blue&#34;: blue, &#34;yellow&#34;: yellow, &#34;pink&#34;: pink, &#34;cyan&#34;: cyan, &#34;grey&#34;: grey, &#34;green&#34;: green, &#34;yellow&#34;: yellow}))
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">class PomodoroScreen(Screen):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def __init__(self, *args, **kwargs):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        super(PomodoroScreen, self).__init__(*args, **kwargs)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.pomodorotimer = Pomodoro()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.add_widget(self.pomodorotimer)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.bind(on_enter=self.enter_handler)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.bind(on_pre_leave=self.pre_leave_handler)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        @oschandler(&#34;pomodoro:start&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        def _(_):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.pomodorotimer.start()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        @oschandler(&#34;pomodoro:break&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        def _(_):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.pomodorotimer.short_break()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def pre_leave_handler(self, _):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.pomodorotimer.leave()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def enter_handler(self, _):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        from plyer import orientation
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        orientation.set_sensor()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.pomodorotimer.enter()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">class Pomodoro(BoxLayout):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    state = StringProperty(&#34;idle&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def _update_rect(self, instance, value):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.rect.pos = instance.pos
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.rect.size = instance.size
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def __init__(self, **kwargs):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        super(Pomodoro, self).__init__(**kwargs)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        with self.canvas.before:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.color = Color(1, 0, 0, 1)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.rect = Rectangle(size=self.size, pos=self.pos)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.interrupted_time = None
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.bind(size=self._update_rect, pos=self._update_rect)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.pomodoro_duration = 25
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def update(self, _):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        if self.running:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.ids.progress.value += 1
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            remaining = int(self.ids.progress.max - self.ids.progress.value)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.ids.countdown.text = &#34;{:02d}:{:02d}&#34;.format(remaining // 60, remaining % 60)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            if self.ids.progress.value == self.ids.progress.max:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                self.interrupted_time = None
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                self.ids.progress.value = 0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                if self.state == &#34;pomodoro&#34;:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                    requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/event/fire<span style="color:#000;font-style:italic">/pomodoro&#34;, data=&#39;&#39;&#39;{&#34;message&#34;: &#34;done&#34;}&#39;&#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                elif self.state == &#34;break&#34;:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                    requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/event/fire<span style="color:#000;font-style:italic">/pomodoro&#34;, data=&#39;&#39;&#39;{&#34;message&#34;: &#34;done_break&#34;}&#39;&#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                elif self.state in (&#34;interruption&#34;, &#34;exterruption&#34;):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                    requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/event/fire<span style="color:#000;font-style:italic">/pomodoro&#34;, data=&#39;&#39;&#39;{&#34;message&#34;: &#34;interruption_too_big&#34;}&#39;&#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                elif self.state == &#34;twominutes&#34;:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                    requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/event/fire<span style="color:#000;font-style:italic">/pomodoro&#34;, data=&#39;&#39;&#39;{&#34;message&#34;: &#34;two_minutes_over&#34;}&#39;&#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                requests.delete(&#34;http:/</span>/192.168.1.244:8500/v1/kv<span style="color:#000;font-style:italic">/pomodoro&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                self.reset()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        else:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            end = datetime.now() + timedelta(minutes=25)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.ids.endtime.text = end.strftime(&#34;%H:%M&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.ids.countdown.text = &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def enter(self):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.reset()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        resp = requests.get(&#34;http:/</span>/192.168.1.244:8500/v1/kv<span style="color:#000;font-style:italic">/pomodoro&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        if resp.status_code == 200:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.start_state()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            # endtime = datetime.fromisoformat(base64.b64decode(resp.json()[0][&#34;Value&#34;]).decode())
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            # compatibility python2
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            endtime = datetime.strptime(base64.b64decode(resp.json()[0][&#34;Value&#34;]).decode(), &#34;%Y-%m-%dT%H:%M:%S.%f&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            now = datetime.now()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.ids.progress.value = self.ids.progress.max - (endtime - now).total_seconds()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.ids.endtime.text = endtime.strftime(&#34;%H:%M&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.clock = Clock.schedule_interval(self.update, 1)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        wl.acquire()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        to_service(&#34;pomodoro:entered&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def leave(self):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        Clock.unschedule(self.clock)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.clock = None
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        wl.release()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def reset(self):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.state = &#34;idle&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.running = False
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.color.rgb = grey[:3]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def interruption(self):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        if self.state == &#34;interruption&#34;:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/event/fire<span style="color:#000;font-style:italic">/pomodoro&#34;, data=&#39;&#39;&#39;{&#34;message&#34;: &#34;handled_interruption&#34;}&#39;&#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            if self.interrupted_time:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                self.start()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            else:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                self.reset()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            return
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        else:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/event/fire<span style="color:#000;font-style:italic">/pomodoro&#34;, data=&#39;&#39;&#39;{&#34;message&#34;: &#34;interruption&#34;}&#39;&#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        if self.state == &#34;pomodoro&#34; and not self.interrupted_time:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.interrupted_time = (self.ids.progress.value, self.ids.progress.max)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.reset()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.running = True
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.state = &#34;interruption&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        duration = 1
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.ids.progress.max = duration * 60
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.ids.progress.value = 0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.color.rgb = blue[:3]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def exterruption(self):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        if self.state == &#34;exterruption&#34;:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/event/fire<span style="color:#000;font-style:italic">/pomodoro&#34;, data=&#39;&#39;&#39;{&#34;message&#34;: &#34;handled_ext_interruption&#34;}&#39;&#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            if self.interrupted_time:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                self.start()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            else:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                self.reset()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            return
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        else:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/event/fire<span style="color:#000;font-style:italic">/pomodoro&#34;, data=&#39;&#39;&#39;{&#34;message&#34;: &#34;external_interruption&#34;}&#39;&#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        if self.state == &#34;pomodoro&#34; and not self.interrupted_time:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.interrupted_time = (self.ids.progress.value, self.ids.progress.max)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.reset()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.running = True
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.state = &#34;exterruption&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        duration = 1
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.ids.progress.max = duration * 60
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.ids.progress.value = 0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.color.rgb = blue[:3]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def twominutes(self):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        if self.state == &#34;twominutes&#34;:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/event/fire<span style="color:#000;font-style:italic">/pomodoro&#34;, data=&#39;&#39;&#39;{&#34;message&#34;: &#34;two_minutes_done&#34;}&#39;&#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            if self.interrupted_time:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                self.start()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            else:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                self.reset()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            return
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        else:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/event/fire<span style="color:#000;font-style:italic">/pomodoro&#34;, data=&#39;&#39;&#39;{&#34;message&#34;: &#34;two_minutes&#34;}&#39;&#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        if self.state == &#34;pomodoro&#34; and not self.interrupted_time:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.interrupted_time = (self.ids.progress.value, self.ids.progress.max)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.reset()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.running = True
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.state = &#34;twominutes&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        duration = 2
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.ids.progress.max = duration * 60
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.ids.progress.value = 0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.color.rgb = yellow[:3]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def short_break(self):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/event/fire<span style="color:#000;font-style:italic">/pomodoro&#34;, data=&#39;&#39;&#39;{&#34;message&#34;: &#34;start_break&#34;}&#39;&#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.reset()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.running = True
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.state = &#34;break&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        duration = 4
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.ids.progress.max = duration * 60
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.ids.progress.value = 0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.color.rgb = green[:3]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def long_break(self):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/event/fire<span style="color:#000;font-style:italic">/pomodoro&#34;, data=&#39;&#39;&#39;{&#34;message&#34;: &#34;start_long_break&#34;}&#39;&#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.reset()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.running = True
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.state = &#34;break&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        duration = 20
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.ids.progress.max = duration * 60
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.ids.progress.value = 0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.color.rgb = green[:3]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def start_state(self):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.running = True
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.state = &#34;pomodoro&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.color.rgb = pink[:3]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.ids.progress.value = 0
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.ids.progress.max = self.pomodoro_duration * 60
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">    def start(self):
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        if self.running and self.state == &#34;pomodoro&#34;:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            logger.debug(&#34;Already in a pomodoro&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            return
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.start_state()
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        if self.interrupted_time:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            (self.ids.progress.value, self.ids.progress.max) = self.interrupted_time
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            remaining_seconds = self.ids.progress.max - self.ids.progress.value
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            end = datetime.now() + timedelta(seconds=remaining_seconds)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            self.interrupted_time = None
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            duration = remaining_seconds // 60
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        else:
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            duration = self.pomodoro_duration
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">            end = datetime.now() + timedelta(minutes=duration)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        self.ids.endtime.text = end.strftime(&#34;%H:%M&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        session_id = requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/session<span style="color:#000;font-style:italic">/create&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                     json={
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                         &#34;TTL&#34;: &#34;{}m&#34;.format(duration),
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                         &#34;Behavior&#34;: &#34;delete&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                         &#34;Name&#34;: &#34;pomodoro&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                         &#34;Checks&#34;: [],
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                     }).json()[&#34;ID&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        logger.debug(&#34;Registering pomodoro for session {}&#34;.format(session_id))
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        requests.delete(&#34;http:/</span>/192.168.1.244:8500/v1/kv<span style="color:#000;font-style:italic">/pomodoro&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/kv<span style="color:#000;font-style:italic">/pomodoro?acquire={}&#34;.format(session_id),
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">                     data=end.isoformat())
</span></span></span><span style="display:flex;"><span><span style="color:#000;font-style:italic">        requests.put(&#34;http:/</span>/192.168.1.244:8500/v1/event/fire/pomodoro&#34;, data=&#39;{{&#34;message&#34;: &#34;start_pomodoro&#34;, &#34;end&#34;: &#34;{}&#34;}}&#39;.format(end.isoformat()))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>class PomodoroApp(App):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @staticmethod
</span></span><span style="display:flex;"><span>    def populate(sm):
</span></span><span style="display:flex;"><span>        try:
</span></span><span style="display:flex;"><span>            sm.get_screen(&#39;pomodorotimer&#39;)
</span></span><span style="display:flex;"><span>            return
</span></span><span style="display:flex;"><span>        except ScreenManagerException:
</span></span><span style="display:flex;"><span>            pass # not populated yet
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sm.add_widget(PomodoroScreen(name=&#39;pomodorotimer&#39;))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    def build(self):
</span></span><span style="display:flex;"><span>        sm = ScreenManager()
</span></span><span style="display:flex;"><span>        self.populate(sm)
</span></span><span style="display:flex;"><span>        return sm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def run():
</span></span><span style="display:flex;"><span>    PomodoroApp().run()
</span></span></code></pre></div><p><a id="code-snippet--main"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">time</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">plyer</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.app</span> <span style="color:#000;font-weight:bold">import</span> App
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">jnius</span> <span style="color:#000;font-weight:bold">import</span> autoclass
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">requests</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.clock</span> <span style="color:#000;font-weight:bold">import</span> Clock
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.lang</span> <span style="color:#000;font-weight:bold">import</span> Builder
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.uix.boxlayout</span> <span style="color:#000;font-weight:bold">import</span> BoxLayout
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.core.camera</span> <span style="color:#000;font-weight:bold">import</span> Camera
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">base64</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">datetime</span> <span style="color:#000;font-weight:bold">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.graphics</span> <span style="color:#000;font-weight:bold">import</span> Color, Rectangle
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.properties</span> <span style="color:#000;font-weight:bold">import</span> StringProperty
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">datetime</span> <span style="color:#000;font-weight:bold">import</span> datetime
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.uix.screenmanager</span> <span style="color:#000;font-weight:bold">import</span> Screen, ScreenManagerException, ScreenManager
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">helpers.osc</span> <span style="color:#000;font-weight:bold">import</span> oschandler, to_service
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">helpers.wakelock</span> <span style="color:#000;font-weight:bold">import</span> WakeLock
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">logging</span> <span style="color:#000;font-weight:bold">import</span> getLogger
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logger <span style="color:#000;font-weight:bold">=</span> getLogger(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>wl <span style="color:#000;font-weight:bold">=</span> WakeLock(<span style="color:#d14">&#39;pomodorotimer&#39;</span>, wakeup<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pink <span style="color:#000;font-weight:bold">=</span> (<span style="color:#099">1</span>, <span style="color:#099">0.75</span>, <span style="color:#099">0.8</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>cyan <span style="color:#000;font-weight:bold">=</span> (<span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>grey <span style="color:#000;font-weight:bold">=</span> (<span style="color:#099">0.3</span>, <span style="color:#099">0.3</span>, <span style="color:#099">0.3</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>green <span style="color:#000;font-weight:bold">=</span> (<span style="color:#099">0</span>, <span style="color:#099">0.9</span>, <span style="color:#099">0.3</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>blue <span style="color:#000;font-weight:bold">=</span> (<span style="color:#099">0</span>, <span style="color:#099">0.8</span>, <span style="color:#099">0.8</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>yellow <span style="color:#000;font-weight:bold">=</span> (<span style="color:#099">0.8</span>, <span style="color:#099">0.8</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Builder<span style="color:#000;font-weight:bold">.</span>load_string(<span style="color:#d14">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">&lt;Pomodoro&gt;:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    id: pomodoro
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    orientation: &#34;vertical&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    BoxLayout:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        orientation: &#34;horizontal&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        size_hint: (1, 0.5)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        Label:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            id: endtime
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            text: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            font_size: 100
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            color: (0, 0, 0, 1)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        Label:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            id: countdown
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            text: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            font_size: 100
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            color: (0, 0, 0, 1)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    ProgressBar:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        id: progress
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    BoxLayout:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        orientation: &#34;horizontal&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        size_hint: (1, 0.5)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        Button:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            disabled: pomodoro.state not in (&#34;idle&#34;, &#34;break&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            text: &#34;Start&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            on_press: root.start()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            color: (0, 0, 0, 1)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            background_color: </span><span style="color:#d14">{pink}</span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        Button:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            text: &#34;Break&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            disabled: pomodoro.state != &#34;idle&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            on_press: root.short_break()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            color: (0, 0, 0, 1)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            background_color: </span><span style="color:#d14">{green}</span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        Button:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            disabled: pomodoro.state != &#34;idle&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            text: &#34;Long Break&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            on_press: root.long_break()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            color: (0, 0, 0, 1)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            background_color: </span><span style="color:#d14">{green}</span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        Button:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            disabled: pomodoro.state not in (&#34;pomodoro&#34;, &#34;interruption&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            text: &#34;Interruption&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            on_press: root.interruption()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            color: (0, 0, 0, 1)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            background_color: </span><span style="color:#d14">{blue}</span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        Button:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            text: &#34;Exterruption&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            disabled: pomodoro.state not in (&#34;pomodoro&#34;, &#34;exterruption&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            on_press: root.exterruption()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            color: (0, 0, 0, 1)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            background_color: </span><span style="color:#d14">{blue}</span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        Button:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            disabled: pomodoro.state not in (&#34;pomodoro&#34;, &#34;twominutes&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            text: &#34;Two minutes&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            on_press: root.twominutes()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            color: (0, 0, 0, 1)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            background_color: </span><span style="color:#d14">{yellow}</span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14"># copy from the source code of kivy, but increased
</span></span></span><span style="display:flex;"><span><span style="color:#d14">&lt;ProgressBar&gt;:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    canvas:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        Color:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            rgb: 1, 1, 1
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        BorderImage:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            border: (12, 12, 12, 12)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            pos: self.x, self.y
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            size: self.width, self.height
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            source: &#39;atlas://data/images/defaulttheme/progressbar_background&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        BorderImage:
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            border: [int(min(self.width * (self.value / float(self.max)) if self.max else 0, 12))] * 4
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            pos: self.x, self.y
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            size: self.width * (self.value / float(self.max)) if self.max else 0, self.height
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            source: &#39;atlas://data/images/defaulttheme/progressbar&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">&#34;&#34;&#34;</span><span style="color:#000;font-weight:bold">.</span>format(<span style="color:#000;font-weight:bold">**</span>{<span style="color:#d14">&#34;blue&#34;</span>: blue, <span style="color:#d14">&#34;yellow&#34;</span>: yellow, <span style="color:#d14">&#34;pink&#34;</span>: pink, <span style="color:#d14">&#34;cyan&#34;</span>: cyan, <span style="color:#d14">&#34;grey&#34;</span>: grey, <span style="color:#d14">&#34;green&#34;</span>: green, <span style="color:#d14">&#34;yellow&#34;</span>: yellow}))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PomodoroScreen</span>(Screen):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> __init__(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">super</span>(PomodoroScreen, <span style="color:#999">self</span>)<span style="color:#000;font-weight:bold">.</span>__init__(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kwargs)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pomodorotimer <span style="color:#000;font-weight:bold">=</span> Pomodoro()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>add_widget(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pomodorotimer)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>bind(on_enter<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>enter_handler)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>bind(on_pre_leave<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pre_leave_handler)
</span></span><span style="display:flex;"><span>        <span style="color:#3c5d5d;font-weight:bold">@oschandler</span>(<span style="color:#d14">&#34;pomodoro:start&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_</span>(_):
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pomodorotimer<span style="color:#000;font-weight:bold">.</span>start()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3c5d5d;font-weight:bold">@oschandler</span>(<span style="color:#d14">&#34;pomodoro:break&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_</span>(_):
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pomodorotimer<span style="color:#000;font-weight:bold">.</span>short_break()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">pre_leave_handler</span>(<span style="color:#999">self</span>, _):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pomodorotimer<span style="color:#000;font-weight:bold">.</span>leave()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">enter_handler</span>(<span style="color:#999">self</span>, _):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">from</span> <span style="color:#555">plyer</span> <span style="color:#000;font-weight:bold">import</span> orientation
</span></span><span style="display:flex;"><span>        orientation<span style="color:#000;font-weight:bold">.</span>set_sensor()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pomodorotimer<span style="color:#000;font-weight:bold">.</span>enter()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Pomodoro</span>(BoxLayout):
</span></span><span style="display:flex;"><span>    state <span style="color:#000;font-weight:bold">=</span> StringProperty(<span style="color:#d14">&#34;idle&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_update_rect</span>(<span style="color:#999">self</span>, instance, value):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>rect<span style="color:#000;font-weight:bold">.</span>pos <span style="color:#000;font-weight:bold">=</span> instance<span style="color:#000;font-weight:bold">.</span>pos
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>rect<span style="color:#000;font-weight:bold">.</span>size <span style="color:#000;font-weight:bold">=</span> instance<span style="color:#000;font-weight:bold">.</span>size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> __init__(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">super</span>(Pomodoro, <span style="color:#999">self</span>)<span style="color:#000;font-weight:bold">.</span>__init__(<span style="color:#000;font-weight:bold">**</span>kwargs)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">with</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>canvas<span style="color:#000;font-weight:bold">.</span>before:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color <span style="color:#000;font-weight:bold">=</span> Color(<span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>rect <span style="color:#000;font-weight:bold">=</span> Rectangle(size<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>size, pos<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pos)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>bind(size<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_update_rect, pos<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>_update_rect)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pomodoro_duration <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">25</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">update</span>(<span style="color:#999">self</span>, _):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>running:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>            remaining <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">int</span>(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max <span style="color:#000;font-weight:bold">-</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value)
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>countdown<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;</span><span style="color:#d14">{:02d}</span><span style="color:#d14">:</span><span style="color:#d14">{:02d}</span><span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">.</span>format(remaining <span style="color:#000;font-weight:bold">//</span> <span style="color:#099">60</span>, remaining <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">60</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value <span style="color:#000;font-weight:bold">==</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max:
</span></span><span style="display:flex;"><span>                <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>                <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;pomodoro&#34;</span>:
</span></span><span style="display:flex;"><span>                    requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/event/fire/pomodoro&#34;</span>, data<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;&#39;{&#34;message&#34;: &#34;done&#34;}&#39;&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">elif</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;break&#34;</span>:
</span></span><span style="display:flex;"><span>                    requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/event/fire/pomodoro&#34;</span>, data<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;&#39;{&#34;message&#34;: &#34;done_break&#34;}&#39;&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">elif</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">in</span> (<span style="color:#d14">&#34;interruption&#34;</span>, <span style="color:#d14">&#34;exterruption&#34;</span>):
</span></span><span style="display:flex;"><span>                    requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/event/fire/pomodoro&#34;</span>, data<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;&#39;{&#34;message&#34;: &#34;interruption_too_big&#34;}&#39;&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">elif</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;twominutes&#34;</span>:
</span></span><span style="display:flex;"><span>                    requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/event/fire/pomodoro&#34;</span>, data<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;&#39;{&#34;message&#34;: &#34;two_minutes_over&#34;}&#39;&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>                requests<span style="color:#000;font-weight:bold">.</span>delete(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/kv/pomodoro&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>reset()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            end <span style="color:#000;font-weight:bold">=</span> datetime<span style="color:#000;font-weight:bold">.</span>now() <span style="color:#000;font-weight:bold">+</span> timedelta(minutes<span style="color:#000;font-weight:bold">=</span><span style="color:#099">25</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>endtime<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> end<span style="color:#000;font-weight:bold">.</span>strftime(<span style="color:#d14">&#34;%H:%M&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>countdown<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">enter</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>reset()
</span></span><span style="display:flex;"><span>        resp <span style="color:#000;font-weight:bold">=</span> requests<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/kv/pomodoro&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> resp<span style="color:#000;font-weight:bold">.</span>status_code <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">200</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>start_state()
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># endtime = datetime.fromisoformat(base64.b64decode(resp.json()[0][&#34;Value&#34;]).decode())</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># compatibility python2</span>
</span></span><span style="display:flex;"><span>            endtime <span style="color:#000;font-weight:bold">=</span> datetime<span style="color:#000;font-weight:bold">.</span>strptime(base64<span style="color:#000;font-weight:bold">.</span>b64decode(resp<span style="color:#000;font-weight:bold">.</span>json()[<span style="color:#099">0</span>][<span style="color:#d14">&#34;Value&#34;</span>])<span style="color:#000;font-weight:bold">.</span>decode(), <span style="color:#d14">&#34;%Y-%m-</span><span style="color:#d14">%d</span><span style="color:#d14">T%H:%M:%S.</span><span style="color:#d14">%f</span><span style="color:#d14">&#34;</span>)
</span></span><span style="display:flex;"><span>            now <span style="color:#000;font-weight:bold">=</span> datetime<span style="color:#000;font-weight:bold">.</span>now()
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max <span style="color:#000;font-weight:bold">-</span> (endtime <span style="color:#000;font-weight:bold">-</span> now)<span style="color:#000;font-weight:bold">.</span>total_seconds()
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>endtime<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> endtime<span style="color:#000;font-weight:bold">.</span>strftime(<span style="color:#d14">&#34;%H:%M&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>clock <span style="color:#000;font-weight:bold">=</span> Clock<span style="color:#000;font-weight:bold">.</span>schedule_interval(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>update, <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>        wl<span style="color:#000;font-weight:bold">.</span>acquire()
</span></span><span style="display:flex;"><span>        to_service(<span style="color:#d14">&#34;pomodoro:entered&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">leave</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        Clock<span style="color:#000;font-weight:bold">.</span>unschedule(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>clock)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>clock <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        wl<span style="color:#000;font-weight:bold">.</span>release()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">reset</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;idle&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>running <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>rgb <span style="color:#000;font-weight:bold">=</span> grey[:<span style="color:#099">3</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">interruption</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;interruption&#34;</span>:
</span></span><span style="display:flex;"><span>            requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/event/fire/pomodoro&#34;</span>, data<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;&#39;{&#34;message&#34;: &#34;handled_interruption&#34;}&#39;&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time:
</span></span><span style="display:flex;"><span>                <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>start()
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>reset()
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/event/fire/pomodoro&#34;</span>, data<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;&#39;{&#34;message&#34;: &#34;interruption&#34;}&#39;&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;pomodoro&#34;</span> <span style="color:#000;font-weight:bold">and</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time <span style="color:#000;font-weight:bold">=</span> (<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>reset()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>running <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;interruption&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        duration <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max <span style="color:#000;font-weight:bold">=</span> duration <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">60</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>rgb <span style="color:#000;font-weight:bold">=</span> blue[:<span style="color:#099">3</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">exterruption</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;exterruption&#34;</span>:
</span></span><span style="display:flex;"><span>            requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/event/fire/pomodoro&#34;</span>, data<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;&#39;{&#34;message&#34;: &#34;handled_ext_interruption&#34;}&#39;&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time:
</span></span><span style="display:flex;"><span>                <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>start()
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>reset()
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/event/fire/pomodoro&#34;</span>, data<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;&#39;{&#34;message&#34;: &#34;external_interruption&#34;}&#39;&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;pomodoro&#34;</span> <span style="color:#000;font-weight:bold">and</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time <span style="color:#000;font-weight:bold">=</span> (<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>reset()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>running <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;exterruption&#34;</span>
</span></span><span style="display:flex;"><span>        duration <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max <span style="color:#000;font-weight:bold">=</span> duration <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">60</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>rgb <span style="color:#000;font-weight:bold">=</span> blue[:<span style="color:#099">3</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">twominutes</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;twominutes&#34;</span>:
</span></span><span style="display:flex;"><span>            requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/event/fire/pomodoro&#34;</span>, data<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;&#39;{&#34;message&#34;: &#34;two_minutes_done&#34;}&#39;&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time:
</span></span><span style="display:flex;"><span>                <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>start()
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>reset()
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/event/fire/pomodoro&#34;</span>, data<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;&#39;{&#34;message&#34;: &#34;two_minutes&#34;}&#39;&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;pomodoro&#34;</span> <span style="color:#000;font-weight:bold">and</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time <span style="color:#000;font-weight:bold">=</span> (<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>reset()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>running <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;twominutes&#34;</span>
</span></span><span style="display:flex;"><span>        duration <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max <span style="color:#000;font-weight:bold">=</span> duration <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">60</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>rgb <span style="color:#000;font-weight:bold">=</span> yellow[:<span style="color:#099">3</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">short_break</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/event/fire/pomodoro&#34;</span>, data<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;&#39;{&#34;message&#34;: &#34;start_break&#34;}&#39;&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>reset()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>running <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;break&#34;</span>
</span></span><span style="display:flex;"><span>        duration <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max <span style="color:#000;font-weight:bold">=</span> duration <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">60</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>rgb <span style="color:#000;font-weight:bold">=</span> green[:<span style="color:#099">3</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">long_break</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/event/fire/pomodoro&#34;</span>, data<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;&#39;{&#34;message&#34;: &#34;start_long_break&#34;}&#39;&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>reset()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>running <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;break&#34;</span>
</span></span><span style="display:flex;"><span>        duration <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">20</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max <span style="color:#000;font-weight:bold">=</span> duration <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">60</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>rgb <span style="color:#000;font-weight:bold">=</span> green[:<span style="color:#099">3</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">start_state</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>running <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;pomodoro&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>color<span style="color:#000;font-weight:bold">.</span>rgb <span style="color:#000;font-weight:bold">=</span> pink[:<span style="color:#099">3</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pomodoro_duration <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">60</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">start</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>running <span style="color:#000;font-weight:bold">and</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;pomodoro&#34;</span>:
</span></span><span style="display:flex;"><span>            logger<span style="color:#000;font-weight:bold">.</span>debug(<span style="color:#d14">&#34;Already in a pomodoro&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>start_state()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time:
</span></span><span style="display:flex;"><span>            (<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value, <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max) <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time
</span></span><span style="display:flex;"><span>            remaining_seconds <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>max <span style="color:#000;font-weight:bold">-</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>progress<span style="color:#000;font-weight:bold">.</span>value
</span></span><span style="display:flex;"><span>            end <span style="color:#000;font-weight:bold">=</span> datetime<span style="color:#000;font-weight:bold">.</span>now() <span style="color:#000;font-weight:bold">+</span> timedelta(seconds<span style="color:#000;font-weight:bold">=</span>remaining_seconds)
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>interrupted_time <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>            duration <span style="color:#000;font-weight:bold">=</span> remaining_seconds <span style="color:#000;font-weight:bold">//</span> <span style="color:#099">60</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            duration <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pomodoro_duration
</span></span><span style="display:flex;"><span>            end <span style="color:#000;font-weight:bold">=</span> datetime<span style="color:#000;font-weight:bold">.</span>now() <span style="color:#000;font-weight:bold">+</span> timedelta(minutes<span style="color:#000;font-weight:bold">=</span>duration)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>ids<span style="color:#000;font-weight:bold">.</span>endtime<span style="color:#000;font-weight:bold">.</span>text <span style="color:#000;font-weight:bold">=</span> end<span style="color:#000;font-weight:bold">.</span>strftime(<span style="color:#d14">&#34;%H:%M&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        session_id <span style="color:#000;font-weight:bold">=</span> requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/session/create&#34;</span>,
</span></span><span style="display:flex;"><span>                     json<span style="color:#000;font-weight:bold">=</span>{
</span></span><span style="display:flex;"><span>                         <span style="color:#d14">&#34;TTL&#34;</span>: <span style="color:#d14">&#34;</span><span style="color:#d14">{}</span><span style="color:#d14">m&#34;</span><span style="color:#000;font-weight:bold">.</span>format(duration),
</span></span><span style="display:flex;"><span>                         <span style="color:#d14">&#34;Behavior&#34;</span>: <span style="color:#d14">&#34;delete&#34;</span>,
</span></span><span style="display:flex;"><span>                         <span style="color:#d14">&#34;Name&#34;</span>: <span style="color:#d14">&#34;pomodoro&#34;</span>,
</span></span><span style="display:flex;"><span>                         <span style="color:#d14">&#34;Checks&#34;</span>: [],
</span></span><span style="display:flex;"><span>                     })<span style="color:#000;font-weight:bold">.</span>json()[<span style="color:#d14">&#34;ID&#34;</span>]
</span></span><span style="display:flex;"><span>        logger<span style="color:#000;font-weight:bold">.</span>debug(<span style="color:#d14">&#34;Registering pomodoro for session </span><span style="color:#d14">{}</span><span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">.</span>format(session_id))
</span></span><span style="display:flex;"><span>        requests<span style="color:#000;font-weight:bold">.</span>delete(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/kv/pomodoro&#34;</span>)
</span></span><span style="display:flex;"><span>        requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/kv/pomodoro?acquire=</span><span style="color:#d14">{}</span><span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">.</span>format(session_id),
</span></span><span style="display:flex;"><span>                     data<span style="color:#000;font-weight:bold">=</span>end<span style="color:#000;font-weight:bold">.</span>isoformat())
</span></span><span style="display:flex;"><span>        requests<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#34;http://192.168.1.244:8500/v1/event/fire/pomodoro&#34;</span>, data<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;{{&#34;message&#34;: &#34;start_pomodoro&#34;, &#34;end&#34;: &#34;</span><span style="color:#d14">{}</span><span style="color:#d14">&#34;}}&#39;</span><span style="color:#000;font-weight:bold">.</span>format(end<span style="color:#000;font-weight:bold">.</span>isoformat()))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PomodoroApp</span>(App):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">populate</span>(sm):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>            sm<span style="color:#000;font-weight:bold">.</span>get_screen(<span style="color:#d14">&#39;pomodorotimer&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">except</span> ScreenManagerException:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">pass</span> <span style="color:#998;font-style:italic"># not populated yet</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sm<span style="color:#000;font-weight:bold">.</span>add_widget(PomodoroScreen(name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;pomodorotimer&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">build</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        sm <span style="color:#000;font-weight:bold">=</span> ScreenManager()
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>populate(sm)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> sm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">run</span>():
</span></span><span style="display:flex;"><span>    PomodoroApp()<span style="color:#000;font-weight:bold">.</span>run()
</span></span></code></pre></div><!--more-->
<h2 id="notes-linking-here">Notes linking here</h2>
<ul>
<li><a href="https://konubinix.eu/blog/posts/use_the_camera_with_kivy_on_android/?title=use_the_camera_with_kivy_on_android#">use the camera with kivy on android</a> (blog)</li>
</ul>
<h2 id="permalink"><a href="https://konubinix.eu/braindump/aec7a5a4-ee92-407b-b39b-dc8baaa13ac0?title=pomodo_timer_on_kivy">Permalink</a></h2>
      </div>
	  <aside class="date"><time>Last updated: 04 Jun 2025</time></aside>
	  <aside class="date"><time>Published&nbsp;&nbsp;&nbsp;: 26 Nov 2024</time></aside>
    </div>
  </div>
</div>

<script src="/braindump/js/URI.js" type="text/javascript"></script>

<script src="/braindump/js/page.js" type="text/javascript"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
