<!DOCTYPE html>
<html><title>how to change the point in a buffer in another window in emacs?</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="bLmaFyyXugiCqSup-eIIIx0B4CngtdF_svyMMKQbS5E" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, minimum-scale=0.5, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src="https://hypothes.is/embed.js" async></script>


<link rel="stylesheet" href="/braindump/css/main.min.56b43bcbc759a196f9dd525bee62bdec45a29ba95902bbab74a4f7ad2ea3e8cb.css"/>

<link rel="stylesheet" href="/braindump/css/links.min.4bf1990b213fb76d2a66153dc6ef9a57d49f536c6baf6e7f19a7948470a38141.css"/>

<link rel="stylesheet" href="/braindump/css/konubinix.min.cf2d0f36945178c647979ee68f1830892e06aa3d481d8913728b5c7462b97f6e.css"/>

<link rel="stylesheet" href="/ipfs/QmQFVQS89fv1XUNFcjwCKDePzckuT9kpuAVNYUwNdEfYcv/css/all.css"/>
<link rel="shortcut icon" href="/ipfs/QmVFwYV7YRZLKU3ybN1hW4jqfyZGPLKJwd8toN2wHz5UAD?a.png" type="image/x-icon" />

<body><header>
  <div>
	<a href="/braindump//"><h5 class="site-title">Konubinix&#39; opinionated web of thoughts</h5></a>
  </div>
  <span>
	<a href="/blog/"><i class="icon fas fa-blog"></i></a>
	<a href="/braindump/posts/"><i class="icon fas fa-brain"></i></a>
    <a href="mailto:konubinixweb@gmail.com"><i class="icon fas fa-envelope-square"></i></a>
    <a href="https://github.com/konubinix"><i class="icon fab fa-github-square"></i></a>
    <a href="https://linkedin.com/in/samuel-loury-61259040"><i class="icon fab fa-linkedin"></i></a>
	<a href="/braindump/graph.html"><i class="icon fas fa-project-diagram"></i></a>
	<a href="/braindump/index.xml"><i class="icon fas fa-rss-square"></i></a>
	<a href="/braindump/tags/"><i class="icon fa fa-tag"></i></a>
	<a href="/braindump/braindump_search"><i class="icon fa fa-search"></i></a>
  </span>
</header>

<div class="grid-container">
  <div class="grid">
    <div class="page" data-level="1">
      <div class="content">
		<p class="lead">
        <h1>How to Change the Point in a Buffer in Another Window in Emacs?</h1>
		<span class="badge badge-pill badge-warning"><a href="/braindump/tags/fleeting/">Fleeting</a></span></p>
        <p>how to change the <a href="/braindump/posts/emacs_point/">point</a> in a buffer in another window in <a href="/braindump/posts/emacs/">emacs</a>?</p>
<p>Say I have a <a href="/braindump/posts/emacs_window/">window</a> somewhere.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">setq-local</span> <span style="color:#008080">mybuffer</span> (<span style="color:#900;font-weight:bold">get-buffer-create</span> <span style="color:#d14">&#34;somebuffer&#34;</span>))
</span></span></code></pre></div><p>If I want to put some content in it, I can just use with-current-buffer</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">with-current-buffer</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">insert</span> <span style="color:#d14">&#34;someline
</span></span></span><span style="display:flex;"><span><span style="color:#d14">someotherline
</span></span></span><span style="display:flex;"><span><span style="color:#d14">and some more&#34;</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><p>Now that I have this buffer, I would like to move its point.</p>
<p>Currently, the point is</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">with-current-buffer</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">point</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>37
</span></span></code></pre></div><p>I can simply run</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">with-current-buffer</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">goto-char</span> <span style="color:#099">10</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>10
</span></span></code></pre></div><p>And then check that the point is indeed 10</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">with-current-buffer</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">point</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>10
</span></span></code></pre></div><p>So far so good, now I would like to do the same while seeing the buffer.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">let</span> ((<span style="color:#008080">here</span> (<span style="color:#900;font-weight:bold">current-buffer</span>)))
</span></span><span style="display:flex;"><span>  (<span style="color:#008080">pop-to-buffer</span> <span style="color:#008080">mybuffer</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008080">pop-to-buffer</span> <span style="color:#008080">here</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><p>And now, I can try to do the same.</p>
<p>Moving to some char</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">with-current-buffer</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">goto-char</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>1
</span></span></code></pre></div><p>And realizing that&hellip;</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">with-current-buffer</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">point</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>10
</span></span></code></pre></div><p>Wait, what? It has not moved at all.</p>
<h2 id="first-idea">first idea</h2>
<p>It looks like it saves the window configuration. According to the documentation.</p>
<blockquote>
<p>current-window-configuration is a built-in function in ‘src/window.c’.</p>
<p>(current-window-configuration &amp;optional FRAME)</p>
<p>Probably introduced at or before Emacs version 18.</p>
<p>Return an object representing the current window configuration of FRAME.
If FRAME is nil or omitted, use the selected frame.
This describes the number of windows, their sizes and current buffers,
and for each displayed buffer, where display starts, and the position of
point.  An exception is made for point in the current buffer:
its value is -not- saved.
This also records the currently selected frame, and FRAME’s focus
redirection (see ‘redirect-frame-focus’).  The variable
‘window-persistent-parameters’ specifies which window parameters are
saved by this function.</p>
<p>[back]</p>
</blockquote>
<p>It sounds like using stuff that save the window configuration will only persist
the point of the current buffer.</p>
<p>Trying to debug this, I realize that there is also with-current-buffer-window that according to the documentation.</p>
<blockquote>
<p>with-current-buffer-window is a Lisp macro in ‘window.el’.</p>
<p>(with-current-buffer-window BUFFER-OR-NAME ACTION QUIT-FUNCTION &amp;rest BODY)</p>
<p>Evaluate BODY with a buffer BUFFER-OR-NAME current and show that buffer.
This construct is like ‘with-temp-buffer-window’ but unlike that,
makes the buffer specified by BUFFER-OR-NAME current for running
BODY.</p>
<p>[back]</p>
</blockquote>
<p>After trying it a bit, it seems like it is overly complicated and does not do
what I want.</p>
<p>I could try set-buffer, but without much success.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">progn</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">set-buffer</span> <span style="color:#008080">mybuffer</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">goto-char</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">with-current-buffer</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">point</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>37
</span></span></code></pre></div><p>It still did not move.</p>
<p>I can try to temporarily hide the buffer within a macro that would call with-current-buffer.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">defmacro</span> <span style="color:#008080">konix/with-current-buffer</span> (<span style="color:#008080">buffer</span> <span style="color:#008080">body</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">`</span>(<span style="color:#0086b3">let</span> ((<span style="color:#008080">window</span> (<span style="color:#900;font-weight:bold">get-buffer-window</span> <span style="color:#000;font-weight:bold">,</span><span style="color:#008080">buffer</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#008080">here</span> (<span style="color:#900;font-weight:bold">current-buffer</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#008080">some-temp-buffer</span> (<span style="color:#900;font-weight:bold">get-buffer-create</span> <span style="color:#d14">&#34;sometempbuffer&#34;</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#008080">res</span>)
</span></span><span style="display:flex;"><span>         )
</span></span><span style="display:flex;"><span>     (<span style="color:#0086b3">when</span> <span style="color:#008080">window</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#008080">pop-to-buffer</span> <span style="color:#000;font-weight:bold">,</span><span style="color:#008080">buffer</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008080">switch-to-buffer</span> <span style="color:#008080">some-temp-buffer</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008080">pop-to-buffer</span> <span style="color:#008080">here</span>)
</span></span><span style="display:flex;"><span>       )
</span></span><span style="display:flex;"><span>     (<span style="color:#0086b3">setq</span> <span style="color:#008080">res</span> (<span style="color:#0086b3">with-current-buffer</span> <span style="color:#000;font-weight:bold">,</span><span style="color:#008080">buffer</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#000;font-weight:bold">,</span><span style="color:#008080">body</span>
</span></span><span style="display:flex;"><span>                 ))
</span></span><span style="display:flex;"><span>     (<span style="color:#0086b3">when</span> <span style="color:#008080">window</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#008080">pop-to-buffer</span> <span style="color:#008080">some-temp-buffer</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008080">switch-to-buffer</span> <span style="color:#000;font-weight:bold">,</span><span style="color:#008080">buffer</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008080">pop-to-buffer</span> <span style="color:#008080">here</span>)
</span></span><span style="display:flex;"><span>       )
</span></span><span style="display:flex;"><span>     <span style="color:#008080">res</span>
</span></span><span style="display:flex;"><span>     )
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#008080">konix/with-current-buffer</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>                           (<span style="color:#900;font-weight:bold">goto-char</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>                           )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>1
</span></span></code></pre></div><p>It has several corner cases that tell me that this is not a good idea, nor I
want to dig into it.</p>
<p>I can more simply deal with the fact that the buffer may or may not be visible.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">defmacro</span> <span style="color:#008080">konix/with-current-buffer</span> (<span style="color:#008080">buffer</span> <span style="color:#008080">body</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">`</span>(<span style="color:#0086b3">let</span> ((<span style="color:#008080">window</span> (<span style="color:#900;font-weight:bold">get-buffer-window</span> <span style="color:#000;font-weight:bold">,</span><span style="color:#008080">buffer</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#008080">here</span> (<span style="color:#900;font-weight:bold">current-buffer</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#008080">res</span>)
</span></span><span style="display:flex;"><span>         )
</span></span><span style="display:flex;"><span>     (<span style="color:#0086b3">if</span> <span style="color:#008080">window</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#008080">pop-to-buffer</span> <span style="color:#000;font-weight:bold">,</span><span style="color:#008080">buffer</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008080">switch-to-buffer</span> <span style="color:#000;font-weight:bold">,</span><span style="color:#008080">buffer</span>)
</span></span><span style="display:flex;"><span>       )
</span></span><span style="display:flex;"><span>     (<span style="color:#0086b3">setq</span> <span style="color:#008080">res</span> (<span style="color:#0086b3">save-window-excursion</span> <span style="color:#000;font-weight:bold">,</span><span style="color:#008080">body</span>))
</span></span><span style="display:flex;"><span>     (<span style="color:#0086b3">if</span> <span style="color:#008080">window</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#008080">pop-to-buffer</span> <span style="color:#008080">here</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008080">switch-to-buffer</span> <span style="color:#008080">here</span>)
</span></span><span style="display:flex;"><span>       )
</span></span><span style="display:flex;"><span>     <span style="color:#008080">res</span>
</span></span><span style="display:flex;"><span>     )
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#008080">konix/with-current-buffer</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>                           (<span style="color:#900;font-weight:bold">goto-char</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>                           )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">with-current-buffer</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">point</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>1
</span></span></code></pre></div><p>This appears to do the trick, while not that elegant in my mind. It has also
corner cases, like when the minibuffer is active, it will raise an error linked
to the fact you cannot switch from the minibuffer to another window.</p>
<h2 id="a-story-of-points">a story of points</h2>
<p>Actually, there are two kinds of point</p>
<ol>
<li><a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Point.html">point</a>: the point of the buffer</li>
<li><a href="/braindump/posts/emacs_window_point/">window point</a>: the point associated to the buffer in each window</li>
</ol>
<p>This allows to have the same buffer displayed in several windows while being
showed with several different points.</p>
<p>The value of point is moved to the location of the last displayed window.</p>
<p>Also, windows keep an history of points for each buffer.</p>
<p>That means that:</p>
<ol>
<li>while I don&rsquo;t see the buffer in any window, point remains stable.</li>
<li>when I display the buffer for the first time, the <a href="/braindump/posts/emacs_window_point/">window point</a> is
initialized to the value of point, so far so good,</li>
<li>when I bury the buffer and change its point, it remains stable while I
don&rsquo;t show the buffer again,</li>
<li>if I show the buffer in another window and then bury it, the point remains
stable because the window point was initialized with the value of point,</li>
<li>if I delete the windows and recreate the same configuration and then show
the buffer, everything is ok</li>
<li>BUT, if I show the buffer in a window that previously showed it, its
historical value of window point will overwrite the value of point</li>
<li>ALSO, if a window is showing the buffer, any code moving the point will see
it keeping its value until returning. When the code return, the top-level
loop redisplays the window and then the buffer gets overwritten,</li>
</ol>
<h2 id="trying-updating-the-window-point-everywhere">trying updating the window point everywhere</h2>
<p>Then, why not moving across all the windows and setting the point accordingly.</p>
<p>I can list all the windows with window-list, using a value other than nil or t
for MINIBUFFER so that it leaves the minibuffer alone.</p>
<p>There set-window-point, but it only sets the point of the window according to
the currently displayed buffer.</p>
<p>There is also switch-to-buffer-preserve-window-point that allow using point
instead of the historical value of window-point, but it behaves globally and
thus does not fit this use case.</p>
<p>There is set-window-buffer-start-and-point that appears to help update this historical value.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">defun</span> <span style="color:#008080">konix/persist-point-all-windows-not-showing-buffer</span> (<span style="color:#000;font-weight:bold">&amp;optional</span> <span style="color:#008080">frame</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#0086b3">let</span> (
</span></span><span style="display:flex;"><span>        (<span style="color:#008080">buffer</span> (<span style="color:#900;font-weight:bold">current-buffer</span>))
</span></span><span style="display:flex;"><span>        (<span style="color:#900;font-weight:bold">point</span> (<span style="color:#900;font-weight:bold">point</span>))
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    (<span style="color:#0086b3">with-selected-frame</span> (<span style="color:#0086b3">or</span> <span style="color:#008080">frame</span> (<span style="color:#900;font-weight:bold">selected-frame</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#900;font-weight:bold">mapc</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#0086b3">lambda</span> (<span style="color:#008080">w</span>)
</span></span><span style="display:flex;"><span>         (<span style="color:#0086b3">let</span> (
</span></span><span style="display:flex;"><span>               (<span style="color:#008080">prev-buffers</span> (<span style="color:#900;font-weight:bold">window-prev-buffers</span> <span style="color:#008080">w</span>))
</span></span><span style="display:flex;"><span>               )
</span></span><span style="display:flex;"><span>           (<span style="color:#0086b3">save-window-excursion</span>
</span></span><span style="display:flex;"><span>             (<span style="color:#008080">set-window-buffer-start-and-point</span> <span style="color:#008080">w</span> <span style="color:#008080">buffer</span> <span style="color:#008080">nil</span> <span style="color:#900;font-weight:bold">point</span>)
</span></span><span style="display:flex;"><span>             )
</span></span><span style="display:flex;"><span>           (<span style="color:#900;font-weight:bold">set-window-prev-buffers</span> <span style="color:#008080">w</span> <span style="color:#008080">prev-buffers</span>)
</span></span><span style="display:flex;"><span>           )
</span></span><span style="display:flex;"><span>         )
</span></span><span style="display:flex;"><span>       (<span style="color:#900;font-weight:bold">window-list</span> <span style="color:#008080">nil</span> <span style="color:#099">-1</span>)
</span></span><span style="display:flex;"><span>       )
</span></span><span style="display:flex;"><span>      )
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><p>This appears to work for windows that don&rsquo;t currently show the buffer. Also I
need to save-window-excursion because it actually pop to the buffer.</p>
<p>Also, because save-window-excursion only applies to the selected frame, I need
to make sure the appropriate frame is selected before doing it.</p>
<p>I need to first save the buffer and the point, because
(current-buffer) and (point) depend on the selected frame.</p>
<p>Finally, I need to save and restore the prev buffers for each window or the
persisting buffer will always be moved as next buffer by
set-window-prev-buffers. This is not saved by save-window-excursion and needs
to be done manually.</p>
<p>To do the same with the windows that show the buffer, I can do this</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">defun</span> <span style="color:#008080">konix/persist-point-all-windows-showing-buffer</span> (<span style="color:#000;font-weight:bold">&amp;optional</span> <span style="color:#008080">frame</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">mapc</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#0086b3">lambda</span> (<span style="color:#008080">w</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#0086b3">when</span> (<span style="color:#900;font-weight:bold">equal</span> (<span style="color:#900;font-weight:bold">window-buffer</span> <span style="color:#008080">w</span>) (<span style="color:#900;font-weight:bold">current-buffer</span>))
</span></span><span style="display:flex;"><span>       (<span style="color:#900;font-weight:bold">set-window-point</span> <span style="color:#008080">w</span> (<span style="color:#900;font-weight:bold">point</span>))
</span></span><span style="display:flex;"><span>       )
</span></span><span style="display:flex;"><span>     )
</span></span><span style="display:flex;"><span>   (<span style="color:#900;font-weight:bold">window-list</span> <span style="color:#008080">frame</span> <span style="color:#099">-1</span>)
</span></span><span style="display:flex;"><span>   )
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">with-current-buffer</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">goto-char</span> <span style="color:#099">10</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008080">konix/persist-point-all-windows-showing-buffer</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008080">konix/persist-point-all-windows-not-showing-buffer</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><p>Now I need to do this on all frames. Because save-window-excursion does work
only in the selected frame, I also need to select the frame before running
those.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">defun</span> <span style="color:#008080">konix/persist-point-all-windows</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">mapc</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#0086b3">lambda</span> (<span style="color:#008080">f</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#008080">konix/persist-point-all-windows-showing-buffer</span> <span style="color:#008080">f</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#008080">konix/persist-point-all-windows-not-showing-buffer</span> <span style="color:#008080">f</span>)
</span></span><span style="display:flex;"><span>     )
</span></span><span style="display:flex;"><span>   (<span style="color:#900;font-weight:bold">frame-list</span>)
</span></span><span style="display:flex;"><span>   )
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">with-current-buffer</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">goto-char</span> <span style="color:#099">10</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#008080">konix/persist-point-all-windows</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><p>Now, whatever the window is showing the buffer or not, whatever it happens in
another frame or not, the point is correctly persisted everywhere.</p>
<p><a href="https://konubinix.eu/ipfs/bafybeifwcgholqwwxuz42bx4pnelvqargh3osy2esfb2r3m7mg3e5gh5d4?filename=webm.nil">https://konubinix.eu/ipfs/bafybeifwcgholqwwxuz42bx4pnelvqargh3osy2esfb2r3m7mg3e5gh5d4?filename=webm.nil</a></p>
<p>Now I can wrap this up in a simple macro that behaves like with-current-buffer</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">defmacro</span> <span style="color:#008080">konix/with-current-buffer-persisted-point</span> (<span style="color:#008080">buffer</span> <span style="color:#008080">body</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">`</span>(<span style="color:#0086b3">let</span> ((<span style="color:#008080">res</span>))
</span></span><span style="display:flex;"><span>     (<span style="color:#0086b3">with-current-buffer</span> <span style="color:#000;font-weight:bold">,</span><span style="color:#008080">buffer</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#0086b3">setq</span> <span style="color:#008080">res</span> <span style="color:#000;font-weight:bold">,</span><span style="color:#008080">body</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#008080">konix/persist-point-all-windows</span>)
</span></span><span style="display:flex;"><span>       )
</span></span><span style="display:flex;"><span>     <span style="color:#008080">res</span>
</span></span><span style="display:flex;"><span>     )
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><p>I now can simply run</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#008080">konix/with-current-buffer-persisted-point</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>                                           (<span style="color:#900;font-weight:bold">goto-char</span> <span style="color:#099">10</span>)
</span></span><span style="display:flex;"><span>                                           )
</span></span></code></pre></div><p>And realize that the point was actually persisted in all windows, even if the
buffer is shown or not, in another frame or not.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(<span style="color:#0086b3">with-current-buffer</span> <span style="color:#008080">mybuffer</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#900;font-weight:bold">point</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>10
</span></span></code></pre></div><!--more-->
<h2 id="notes-linking-here">Notes linking here</h2>
<ul>
<li><a href="/braindump/posts/emacs/">emacs</a></li>
</ul>
<h2 id="permalink"><a href="https://konubinix.eu/braindump/5a287757-aa5d-4917-af2c-febb49032dc7?title=how_to_change_the_point_in_a_buffer_in_another_window_in_emacs">Permalink</a></h2>
      </div>
	  <aside class="date"><time>Last updated: 26 Aug 2022</time></aside>
	  <aside class="date"><time>Published&nbsp;&nbsp;&nbsp;: 25 Aug 2022</time></aside>
    </div>
  </div>
</div>

<script src="/braindump/js/URI.js" type="text/javascript"></script>

<script src="/braindump/js/page.js" type="text/javascript"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
