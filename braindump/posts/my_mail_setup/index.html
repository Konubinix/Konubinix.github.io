<!DOCTYPE html>
<html><title>My mail setup</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="bLmaFyyXugiCqSup-eIIIx0B4CngtdF_svyMMKQbS5E" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, minimum-scale=0.5, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src="https://hypothes.is/embed.js" async></script>


<link rel="stylesheet" href="/braindump/css/main.min.56b43bcbc759a196f9dd525bee62bdec45a29ba95902bbab74a4f7ad2ea3e8cb.css"/>

<link rel="stylesheet" href="/braindump/css/links.min.4bf1990b213fb76d2a66153dc6ef9a57d49f536c6baf6e7f19a7948470a38141.css"/>

<link rel="stylesheet" href="/braindump/css/konubinix.min.cf2d0f36945178c647979ee68f1830892e06aa3d481d8913728b5c7462b97f6e.css"/>

<link rel="stylesheet" href="/ipfs/QmQFVQS89fv1XUNFcjwCKDePzckuT9kpuAVNYUwNdEfYcv/css/all.css"/>
<link rel="shortcut icon" href="/ipfs/QmVFwYV7YRZLKU3ybN1hW4jqfyZGPLKJwd8toN2wHz5UAD?a.png" type="image/x-icon" />

<body><header>
  <div>
	<a href="/braindump//"><h5 class="site-title">Konubinix&#39; opinionated web of thoughts</h5></a>
  </div>
  <span>
	<a href="/blog/"><i class="icon fas fa-blog"></i></a>
	<a href="/braindump/posts/"><i class="icon fas fa-brain"></i></a>
    <a href="mailto:konubinixweb@gmail.com"><i class="icon fas fa-envelope-square"></i></a>
    <a href="https://github.com/konubinix"><i class="icon fab fa-github-square"></i></a>
    <a href="https://linkedin.com/in/samuel-loury-61259040"><i class="icon fab fa-linkedin"></i></a>
	<a href="/braindump/graph.html"><i class="icon fas fa-project-diagram"></i></a>
	<a href="/braindump/index.xml"><i class="icon fas fa-rss-square"></i></a>
	<a href="/braindump/tags/"><i class="icon fa fa-tag"></i></a>
	<a href="/braindump/braindump_search"><i class="icon fa fa-search"></i></a>
  </span>
</header>

<div class="grid-container">
  <div class="grid">
    <div class="page" data-level="1">
      <div class="content">
		<p class="lead">
        <h1>My Mail Setup</h1>
		<span class="badge badge-pill badge-warning"><a href="/braindump/tags/fleeting/">Fleeting</a></span></p>
        <div class="ox-hugo-toc toc has-section-numbers">
<div class="heading">Table of Contents</div>
<ul>
<li><span class="section-num">1</span> <a href="#introduction">Introduction</a></li>
<li><span class="section-num">2</span> <a href="#a-picture-is-better-than-a-thousand-words">A picture is better than a thousand words</a></li>
<li><span class="section-num">3</span> <a href="#decomposition-of-emails-tools">Decomposition of emails tools</a></li>
<li><span class="section-num">4</span> <a href="#offlineimap">Offlineimap</a></li>
<li><span class="section-num">5</span> <a href="#notmuch">notmuch</a></li>
<li><span class="section-num">6</span> <a href="#msmtp">msmtp</a></li>
<li><span class="section-num">7</span> <a href="#permalink">Permalink</a></li>
</ul>
</div>
<!--endtoc-->
<h2 id="introduction"><span class="section-num">1</span> Introduction</h2>
<p>This document will try to show my current email setup. <br/></p>
<h2 id="a-picture-is-better-than-a-thousand-words"><span class="section-num">2</span> A picture is better than a thousand words</h2>
<p>Or something like that: <br/></p>
<p><figure><img src="https://konubinix.eu/ipfs/bafkreiar27o44xq6telg5fdb7ptedfilmykonjg2znrn4bb4vka6own6b4?filename=mail_setup.png">
</figure>
 <br/></p>
<p>(<a href="https://konubinix.eu/ipfs/bafkreia2bbkbhhtxf3g4qty5g7k6y6jwsrrjveezaq26hfxcwuyghaizuu?filename=mail_setup.dia">src</a>) <br/></p>
<h2 id="decomposition-of-emails-tools"><span class="section-num">3</span> Decomposition of emails tools</h2>
<p>On the contrary to &ldquo;all-in-one&rdquo; tools such as Thunderbird, I prefer to use one tool for each need. <br/></p>
<p>I know only two ways to tackles emails: connect to a server and deal with them through some kind of web interface or get a local copy of the emails to use your own tools. The later gives you more freedom on how to filter, and index the emails, the former solution is lighter to use. I use the local copy solution. <br/></p>
<p>Those are the tools I use for each use case associated to emails. <br/></p>
<ul>
<li>to synchronise the emails with a local maildir copy: offlineimap <br/></li>
<li>to index emails (so that they can be found later): notmuch <br/></li>
<li>to read emails: emacs + notmuch <br/></li>
<li>to compose emails: emacs + notmuch <br/></li>
<li>to send emails: msmtp <br/></li>
<li>to encrypt emails: emacs + message-mode <br/></li>
</ul>
<p>First, I will try to describe the installation and configuration of all those tools, then, I will describe how I use the tool to fulfil each use case. <br/></p>
<p>I won&rsquo;t dig into the detail of each tool since their documentation is quite well done. I will only provide the minimum information to make them work together. <br/></p>
<h2 id="offlineimap"><span class="section-num">4</span> Offlineimap</h2>
<p>The first tool of the chain, <a href="http://offlineimap.org/">offlineimap</a> allows you to keep synchronised a local Maildir folder with an IMAP account. <br/></p>
<p>The configuration of offlineimap is made of: <br/></p>
<ul>
<li>local repositories: local maildir folders <br/></li>
<li>remote repositories: remote IMAP accounts <br/></li>
<li>accounts: link between two repositories <br/></li>
</ul>
<p>I think that you could have in sync two local maildir folders or two IMAP repositories by linking them with an account, but I never tried this. <br/></p>
<p>You generally start by describing the general information <br/></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cfg" data-lang="cfg"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[general]</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># the name of the accounts</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">accounts</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">konubinix</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># a custom python file that links to functions you may use later</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">pythonfile</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">${KONIX_PERSO_DIR}/offlineimap.py</span>
</span></span></code></pre></div><p>Then you describe each account separately. In my case, it generally contains no more than the names of the two repositories to keep in sync: <br/></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cfg" data-lang="cfg"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[Account konubinix]</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">localrepository</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">LocalKonubinix</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">remoterepository</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">RemoteKonubinix</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># the default backend stores the sync information in a plain text file. It is much slower than the sqlite backend</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">status_backend</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">sqlite</span>
</span></span></code></pre></div><p>Of course, the next step is to describe the two repositories to sync. In my situation, I use a gmail account: <br/></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cfg" data-lang="cfg"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[Repository LocalKonubinix]</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">type</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">GmailMaildir</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">localfolders</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">~/Mail/mail.konubinix</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[Repository RemoteKonubinix]</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">type</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">Gmail</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">remoteusereval</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">get_username(&#34;konubinix@gmail.com&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">remotepasseval</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">get_password(&#34;konubinix@gmail.com&#34;)</span>
</span></span></code></pre></div><p>Note the use of custom made functions get_username and get_password to get the informationa oO <br/></p>
<h2 id="notmuch"><span class="section-num">5</span> notmuch</h2>
<p>Given the maildir folder synchronised by offlineimap, you&rsquo;ll want to index them. <br/></p>
<p>Fortunately, the notmuch software does not much more than that. <br/></p>
<p>You only need to follow the installation instructions available in their website. <br/></p>
<h2 id="msmtp"><span class="section-num">6</span> msmtp</h2>
<p>msmtp is a smtp client. Generally, people use local smtp server to send emails. It is cumbersome to use such a solution without using the port 25 of your machine and then without needing to be root to configure the software. I dislike the idea of being root to configure my emails and all email providers that I know of already provide a smtp server to be connected to. <br/></p>
<p>Once again, the documentation is quite clear and is quite server dependent. <br/></p>
<p>My konubinix account looks like that <br/></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>account        konu
</span></span><span style="display:flex;"><span>tls on
</span></span><span style="display:flex;"><span>tls_certcheck off
</span></span><span style="display:flex;"><span>auth on
</span></span><span style="display:flex;"><span>host           smtp.gmail.com
</span></span><span style="display:flex;"><span>port           587
</span></span><span style="display:flex;"><span>from           konubinix@gmail.com
</span></span><span style="display:flex;"><span>user           konubinix@gmail.com
</span></span><span style="display:flex;"><span>passwordeval assword_dump_clear_password.sh konubinix@gmail.com@google &amp;&amp; echo
</span></span></code></pre></div><p>Note the last line <br/></p>
<h2 id="permalink"><span class="section-num">7</span> <a href="https://konubinix.eu/braindump/d5bb3684-82fb-4fe9-a3f1-2f625b706335?title=my_mail_setup">Permalink</a></h2>
      </div>
	  <aside class="date"><time>Last updated: 23 Dec 2021</time></aside>
	  <aside class="date"><time>Published&nbsp;&nbsp;&nbsp;: 10 Mar 2015</time></aside>
    </div>
  </div>
</div>

<script src="/braindump/js/URI.js" type="text/javascript"></script>

<script src="/braindump/js/page.js" type="text/javascript"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
