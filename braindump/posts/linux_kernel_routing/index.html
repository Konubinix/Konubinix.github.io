<!DOCTYPE html>
<html><title>linux kernel routing</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="bLmaFyyXugiCqSup-eIIIx0B4CngtdF_svyMMKQbS5E" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, minimum-scale=0.5, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src="https://hypothes.is/embed.js" async></script>


<link rel="stylesheet" href="/braindump/css/main.min.56b43bcbc759a196f9dd525bee62bdec45a29ba95902bbab74a4f7ad2ea3e8cb.css"/>

<link rel="stylesheet" href="/braindump/css/links.min.4bf1990b213fb76d2a66153dc6ef9a57d49f536c6baf6e7f19a7948470a38141.css"/>

<link rel="stylesheet" href="/braindump/css/konubinix.min.cf2d0f36945178c647979ee68f1830892e06aa3d481d8913728b5c7462b97f6e.css"/>

<link rel="stylesheet" href="/ipfs/QmQFVQS89fv1XUNFcjwCKDePzckuT9kpuAVNYUwNdEfYcv/css/all.css"/>
<link rel="shortcut icon" href="/ipfs/QmVFwYV7YRZLKU3ybN1hW4jqfyZGPLKJwd8toN2wHz5UAD?a.png" type="image/x-icon" />

<body><header>
  <div>
	<a href="/braindump//"><h5 class="site-title">Konubinix&#39; opinionated web of thoughts</h5></a>
  </div>
  <span>
	<a href="/blog/"><i class="icon fas fa-blog"></i></a>
	<a href="/braindump/posts/"><i class="icon fas fa-brain"></i></a>
    <a href="mailto:konubinixweb@gmail.com"><i class="icon fas fa-envelope-square"></i></a>
    <a href="https://github.com/konubinix"><i class="icon fab fa-github-square"></i></a>
    <a href="https://linkedin.com/in/samuel-loury-61259040"><i class="icon fab fa-linkedin"></i></a>
	<a href="/braindump/graph.html"><i class="icon fas fa-project-diagram"></i></a>
	<a href="/braindump/index.xml"><i class="icon fas fa-rss-square"></i></a>
	<a href="/braindump/tags/"><i class="icon fa fa-tag"></i></a>
	<a href="/braindump/braindump_search"><i class="icon fa fa-search"></i></a>
  </span>
</header>

<div class="grid-container">
  <div class="grid">
    <div class="page" data-level="1">
      <div class="content">
		<p class="lead">
        <h1>Linux Kernel Routing</h1>
		<span class="badge badge-pill badge-warning"><a href="/braindump/tags/fleeting/">Fleeting</a></span></p>
        <p><a href="/braindump/posts/linux_kernel/">linux kernel</a> routing</p>
<h2 id="3b9f3eca-8868-4911-8f22-c83d82a1fa9f">routing tables</h2>
<ul>
<li>External reference: <a href="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</a></li>
</ul>
<blockquote>
<p>Linux kernel 2.2 and 2.4 support multiple routing tables</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>multiple routing table system provides a flexible infrastructure on
top of which to implement policy routing</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Each routing table still operates in the traditional and expected
fashion</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>The <a href="#c104bce3-e0e6-4552-9a50-0394b0759e57">two routing tables normally employed</a> are table 255, the local routing
table, and table 254, the main routing table.</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>The ip route and <a href="#9ab1248e-681a-4d8b-aeae-d3b764e84b59">ip rule</a> commands have built in support for the special tables
main and local.  Any other routing tables can be referred to by number or an
administratively maintained mapping file, /etc/iproute2/rt_tables.</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Aside from the local routing table, which is maintained by the kernel, and the
main routing table which is partially maintained by the kernel, all routing
tables are controlled by the administrator or routing software.  All routes on
a machine can be changed or removed.</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</a></p>
</blockquote>
<h3 id="c104bce3-e0e6-4552-9a50-0394b0759e57">two auto managed default tables, main and local</h3>
<blockquote>
<p>two commonly used routing tables (the local and main routing tables), the
kernel supports up to 252 additional routing tables</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</a></p>
</blockquote>
<h4 id="f98e0cf9-4bee-4a77-b92a-30c33a517025">local table shows broadcast addresses and locally hosted IP</h4>
<blockquote>
<p>Normally, the local routing table should not be manipulated, but it is
available for viewing</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>The first common use is the specification of broadcast address, necessary only
for link layers which support broadcast addressing.  The second common type of
entry in a local routing table is a route to a locally hosted IP.</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</a></p>
</blockquote>
<h4 id="823c9c8e-e5fe-4785-b6c5-478ba84a4cab">main table to deal with new interfaces</h4>
<blockquote>
<p>The main routing table is the routing table most people think of when
considering a linux routing table.</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Similarly to the local table, the main table is populated
automatically by the kernel when new interfaces are brought up
with IP addresses.</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</a></p>
</blockquote>
<h2 id="74ca947e-c1ed-4d6d-a490-c9e54c270069">route selection</h2>
<ul>
<li>
<p>External reference: <a href="http://linux-ip.net/html/routing-selection.html">http://linux-ip.net/html/routing-selection.html</a></p>
<blockquote>
<p>Example 4.5. Listing the Routing Policy Database (RPDB)[root@isolde]# ip rule show</p>
<ul>
<li>0:      from all lookup local</li>
<li>32766:  from all lookup main</li>
<li>32767:  from all lookup 253</li>
</ul>
<p>&mdash; <a href="http://linux-ip.net/html/routing-selection.html">http://linux-ip.net/html/routing-selection.html</a></p>
</blockquote>
</li>
</ul>
<h3 id="37178ac9-94ab-4df4-bc34-55a78be8861d">pseudo code</h3>
<blockquote>
<p>Example 4.4. Routing Selection Algorithm in Pseudo-codeif packet.routeCacheLookupKey in routeCache :
route = routeCache[ packet.routeCacheLookupKey ]
else
for rule in <a href="#9ab1248e-681a-4d8b-aeae-d3b764e84b59">rpdb</a> :
if packet.rpdbLookupKey in rule :
routeTable = rule[ lookupTable ]
if packet.routeLookupKey in routeTable :
route = route_table[ packet.routeLookup_key ]</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-selection.html">http://linux-ip.net/html/routing-selection.html</a></p>
</blockquote>
<h2 id="9ab1248e-681a-4d8b-aeae-d3b764e84b59">routing policy database</h2>
<ul>
<li>External reference: <a href="http://linux-ip.net/html/routing-rpdb.html">http://linux-ip.net/html/routing-rpdb.html</a></li>
</ul>
<blockquote>
<p>routing policy database (RPDB) controls the order in which the
kernel searches through the <a href="#3b9f3eca-8868-4911-8f22-c83d82a1fa9f">routing tables</a></p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-rpdb.html">http://linux-ip.net/html/routing-rpdb.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>kernel iterates over each rule in turn until the
packet to be routed matches a rule.  When this happens the kernel
follows the instructions in that rule</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-rpdb.html">http://linux-ip.net/html/routing-rpdb.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Typically, this causes the
kernel to perform a route lookup in a specified routing table.</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-rpdb.html">http://linux-ip.net/html/routing-rpdb.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>If a
matching route is found in the routing table, the kernel uses that
route.  If no such route is found, the kernel returns to traverse the
RPDB again, until every option has been exhausted</p>
<p>&mdash; <a href="http://linux-ip.net/html/routing-rpdb.html">http://linux-ip.net/html/routing-rpdb.html</a></p>
</blockquote>
<!--more-->
<h2 id="notes-linking-here">Notes linking here</h2>
<ul>
<li><a href="/braindump/posts/android_ignores_routing_table_uses_phone_data_interface_for_everything/">android ignores routing table, uses Phone Data interface for everything?</a></li>
</ul>
<h2 id="permalink"><a href="https://konubinix.eu/braindump/fdd14e9d-ddb0-4f56-97cc-1a9fc42440ec?title=linux_kernel_routing">Permalink</a></h2>
      </div>
	  <aside class="date"><time>Last updated: 10 Jan 2024</time></aside>
	  <aside class="date"><time>Published&nbsp;&nbsp;&nbsp;: 10 Jan 2024</time></aside>
    </div>
  </div>
</div>

<script src="/braindump/js/URI.js" type="text/javascript"></script>

<script src="/braindump/js/page.js" type="text/javascript"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
