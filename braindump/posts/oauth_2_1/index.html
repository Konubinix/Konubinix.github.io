<!DOCTYPE html>
<html><title>OAuth 2.1</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="bLmaFyyXugiCqSup-eIIIx0B4CngtdF_svyMMKQbS5E" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, minimum-scale=0.5, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src="https://hypothes.is/embed.js" async></script>


<link rel="stylesheet" href="/braindump/css/main.min.56b43bcbc759a196f9dd525bee62bdec45a29ba95902bbab74a4f7ad2ea3e8cb.css"/>

<link rel="stylesheet" href="/braindump/css/links.min.4bf1990b213fb76d2a66153dc6ef9a57d49f536c6baf6e7f19a7948470a38141.css"/>

<link rel="stylesheet" href="/braindump/css/konubinix.min.cf2d0f36945178c647979ee68f1830892e06aa3d481d8913728b5c7462b97f6e.css"/>

<link rel="stylesheet" href="/ipfs/QmQFVQS89fv1XUNFcjwCKDePzckuT9kpuAVNYUwNdEfYcv/css/all.css"/>
<link rel="shortcut icon" href="/ipfs/QmVFwYV7YRZLKU3ybN1hW4jqfyZGPLKJwd8toN2wHz5UAD?a.png" type="image/x-icon" />

<body><header>
  <div>
	<a href="/braindump//"><h5 class="site-title">Konubinix&#39; opinionated web of thoughts</h5></a>
  </div>
  <span>
	<a href="/blog/"><i class="icon fas fa-blog"></i></a>
	<a href="/braindump/posts/"><i class="icon fas fa-brain"></i></a>
    <a href="mailto:konubinixweb@gmail.com"><i class="icon fas fa-envelope-square"></i></a>
    <a href="https://github.com/konubinix"><i class="icon fab fa-github-square"></i></a>
    <a href="https://linkedin.com/in/samuel-loury-61259040"><i class="icon fab fa-linkedin"></i></a>
	<a href="/braindump/graph.html"><i class="icon fas fa-project-diagram"></i></a>
	<a href="/braindump/index.xml"><i class="icon fas fa-rss-square"></i></a>
	<a href="/braindump/tags/"><i class="icon fa fa-tag"></i></a>
	<a href="/braindump/braindump_search"><i class="icon fa fa-search"></i></a>
  </span>
</header>

<div class="grid-container">
  <div class="grid">
    <div class="page" data-level="1">
      <div class="content">
		<p class="lead">
        <h1>OAuth 2.1</h1>
		<span class="badge badge-pill badge-warning"><a href="/braindump/tags/fleeting/">Fleeting</a></span></p>
        <ul>
<li>External reference: <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08</a></li>
<li>External reference: <a href="https://auth0.com/docs/get-started/authentication-and-authorization-flow/authorization-code-flow-with-proof-key-for-code-exchange-pkce">https://auth0.com/docs/get-started/authentication-and-authorization-flow/authorization-code-flow-with-proof-key-for-code-exchange-pkce</a></li>
</ul>
<p>A compilation of the main RFCs around <a href="/braindump/posts/oauth_2_0/">OAuth 2.0</a> along with <a href="/braindump/posts/best_practices/">best practices</a>.</p>
<p>Like for example</p>
<blockquote>
<p>Native applications are clients installed and executed on the device used by the
resource owner (i.e., desktop application, native mobile application). Native
applications require special consideration related to security, platform
capabilities, and overall end-user experience</p>
<p>&mdash; <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>The best current practice is to perform the OAuth authorization request in an external user agent (typically the browser) rather than an embedded user agent (such as one implemented with web-views)</p>
<p>&mdash; <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Before initiating the protocol, the client must establish its registration with the
authorization server. The means through which the client registers
with the authorization server are beyond the scope of this
specification but typically involve the client developer manually registering
the client at the authorization server&rsquo;s website after creating an account and agreeing
to the service&rsquo;s Terms of Service, or by using Dynamic Client Registration ([RFC7591]).¶</p>
<p>&mdash; <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Client authentication allows an Authorization Server to ensure it is interacting with a certain client
(identified by its client_id) in an OAuth flow.</p>
<p>&mdash; <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Authorization Server might make policy decisions
about things such as whether to prompt the user for consent on every authorization or only the first
based on the confidence that the Authorization Server is actually communicating with the legitimate client.¶</p>
<p>&mdash; <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>single client_id SHOULD NOT be treated as more than one type of client.¶</p>
<p>&mdash; <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>a client secret, sometimes known as a client password</p>
<p>&mdash; <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Access tokens generally fall into two categories: reference tokens or self-encoded tokens.</p>
<p>&mdash; <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Reference tokens can be validated by querying the authorization server or
looking up the token in a token database, whereas self-encoded tokens
contain the authorization information in an encrypted and/or signed string
which can be extracted by the resource server.¶</p>
<p>&mdash; <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>. Don&rsquo;t store bearer tokens in HTTP cookies</p>
<p>Implementations MUST NOT store
bearer tokens within cookies that can be sent in the clear (which
is the default transmission mode for cookies).  Implementations
that do store bearer tokens in cookies MUST take precautions
against cross-site request forgery</p>
<p>&mdash; <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>authorization
server SHOULD NOT process authorization requests automatically
without user consent or interaction, except when the identity of the
client can be assured.  This includes the case where the user has
previously approved an authorization request for a given client ID &ndash;
unless the identity of the client can be proven, the request SHOULD
be processed as if no previous request had been approved.¶
Measures such as claimed https scheme redirects MAY be accepted by
authorization servers as identity proof.  Some operating systems may
offer alternative platform-specific identity features that MAY be
accepted, as appropriate.¶</p>
<p>&mdash; <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Wide deployment of this and similar protocols may cause end-users to
become inured to the practice of being redirected to websites where
they are asked to enter their passwords.  If end-users are not
careful to verify the authenticity of these websites before entering
their credentials, it will be possible for attackers to exploit this
practice to steal resource owners&rsquo; passwords.¶</p>
<p>&mdash; <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-v2-1-08</a></p>
</blockquote>
<h2 id="b1648b84-77ee-4430-8767-1cec20e9a94c">What&rsquo;s new with OAuth2.1 with Aaron Parecki</h2>
<ul>
<li>
<p>External reference: <a href="https://identityunlocked.auth0.com/public/49/Identity%2C-Unlocked.--bed7fada/c71b9fbd">https://identityunlocked.auth0.com/public/49/Identity%2C-Unlocked.--bed7fada/c71b9fbd</a></p>
<p><a href="/braindump/posts/aaron_parecki/">Aaron Parecki</a>, <a href="/braindump/posts/oauth_2_1/">OAuth 2.1</a></p>
<p><a href="/braindump/posts/oauth_2_0/#b0c592a9-32eb-468c-b342-962e6ab44d48">the purpose of OAuth 2.0 was to avoid that the client oauth 2.0 sees the resource owner&rsquo;s password</a></p>
<p><a href="/braindump/posts/oauth_2_0/#7b976efb-d964-4d48-acb7-1974de405bcc">what is not OAuth 2.0 is not useless or a bad idea</a></p>
</li>
</ul>
<h2 id="1ea6bc5b-42cc-4f26-b8ff-199269676e6f">from <a href="/braindump/posts/oauth_2_0/#1c5ce2b0-1b28-4f35-8978-3ba8acd027b0">5 grant</a> flow to 2</h2>
<h3 id="b8a57c75-44c9-4f89-a88e-635bcb618246"><a href="/braindump/posts/oauth_2_0/#def201dd-26c7-44f9-8456-ad5d3c631731">authorization code grant</a> with PKCE</h3>
<p>The new way of getting the <a href="/braindump/posts/oauth_2_0/#26052c2d-ac4a-4637-9122-704d51585dc8">access token</a> compatible with <a href="/braindump/posts/oauth_web_client/">web client</a>s.</p>
<p>Using a random value as a commitment that is eventually checked by the
<a href="/braindump/posts/oauth_2_0/#ead7dfac-e39a-4262-8066-a9e594d1b8a3">authorization server</a> when sharing the <a href="/braindump/posts/oauth_2_0/#26052c2d-ac4a-4637-9122-704d51585dc8">access token</a>.</p>
<p>Because it is hashed when first submitted, sharing its raw value in the end
provides the proof that the client is still the same, even though the
<a href="/braindump/posts/oauth_2_0/#65dc3014-485c-499c-937b-33cf88330b2f">authorization code</a> was given over a <a href="/braindump/posts/oauth_2_0/#29459edd-a5f0-407f-9457-54e30455bac7">front channel</a>.</p>
<p>Hence, it is like the <a href="/braindump/posts/oauth_2_0/#def201dd-26c7-44f9-8456-ad5d3c631731">authorization code flow</a>, but with a <a href="/braindump/posts/oauth_2_0/#6f4dbac8-544f-4be9-b9ee-8a42353caa90">client secret</a>
generated on the fly.</p>
<p>On the other hand, you still cannot hide the client_id and stuff like API
that behave differently depending on the client cannot be sure the client_id
was not stolen. You still need <a href="/braindump/posts/backend_for_frontend/">BFF</a> for those kind of things.</p>
<blockquote>
<p>Use this grant type for applications that cannot store a client secret, such as native or single-page apps</p>
<p>&mdash; <a href="https://auth0.com/docs/get-started/authentication-and-authorization-flow/authorization-code-flow-with-proof-key-for-code-exchange-pkce">https://auth0.com/docs/get-started/authentication-and-authorization-flow/authorization-code-flow-with-proof-key-for-code-exchange-pkce</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Single-page appsCannot securely store a Client Secret because their entire source is available to the browser.</p>
<p>&mdash; <a href="https://auth0.com/docs/get-started/authentication-and-authorization-flow/authorization-code-flow-with-proof-key-for-code-exchange-pkce">https://auth0.com/docs/get-started/authentication-and-authorization-flow/authorization-code-flow-with-proof-key-for-code-exchange-pkce</a></p>
</blockquote>
<h2 id="0b8f5d30-d663-48fe-8434-cbd6ec38b583">A lot of flow in oauth 2.0 where defined, but eventually only two are left</h2>
<ol>
<li><a href="/braindump/posts/oauth_2_0/#e0103c93-f693-4883-b331-b1ecb8ef88a0">password grant</a> for service to service non interactive communication</li>
<li><a href="#b8a57c75-44c9-4f89-a88e-635bcb618246">authorization code grant with PKCE</a> for interactive communication</li>
</ol>
<h2 id="4bf2ddcd-6456-47d3-b764-b001ac065c59"><a href="#b8a57c75-44c9-4f89-a88e-635bcb618246">pkce</a> replaces the state</h2>
<p>They were meant to do two different things.</p>
<ol>
<li>the state hold state data along the flow,</li>
<li>pkce ensure the client that initiated the flow is the one that closes the flow,</li>
</ol>
<p>Yet, to do pkce, you have to setup some session storage to provide the secret at
the end of the flow. Therefore, doing pkce makes using the state useless.</p>
<h2 id="83c996d7-7257-44ab-bcdf-e2f7a8015771">it discourage to run a full <a href="/braindump/posts/oauth_web_client/">web client</a></h2>
<p>Instead, one should use a <a href="/braindump/posts/backend_for_frontend/">backend for frontend</a>, because with <a href="/braindump/posts/cross_site_scripting/">XSS</a>, there is no
certainty that the code is secure. And all efforts to reduce the attack impact should be used.</p>
<h2 id="32f9730f-49e2-4b53-8cf6-fb75d0bce573">it mostly removed stuffs from <a href="/braindump/posts/oauth_2_0/">OAuth 2.0</a></h2>
<h2 id="a5e442f5-162b-4d81-a933-a7d999f11681">use an exhaustive list of redirect uri in exact match</h2>
<p>So that there is no way to use a <a href="/braindump/posts/oauth_2_0/#d961c0b3-9f25-4ba7-91cc-bae3f100d997">client id</a> and get an <a href="/braindump/posts/oauth_2_0/#26052c2d-ac4a-4637-9122-704d51585dc8">access token</a> without
having access to the redirect uri.</p>
<h2 id="942355c0-7959-4944-851c-2cedc319608e">OAUTH 2.1 expliqué simplement (même si tu n&rsquo;es pas dev)</h2>
<ul>
<li>External reference: <div class="iframe-container ratio169"><iframe src="https://www.youtube-nocookie.com/embed/YdShQveywpo" allowfullscreen title="YouTube Video"></iframe></div>
<ul>
<li>see,
<ul>
<li><a href="/braindump/posts/julien_topcu/">Julien Topçu</a>,</li>
<li><a href="/braindump/posts/oauth_2_1/">OAuth 2.1</a>,</li>
<li><a href="#a5e442f5-162b-4d81-a933-a7d999f11681">use an exhaustive list of redirect uri in exact match</a>,</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Uses the <a href="/braindump/posts/metaphor_of_the_hotel/">metaphor of the hotel</a>.</p>
<h2 id="2bd9112e-b6f2-450a-a68d-5d3ea5ce41f6">using <a href="#b8a57c75-44c9-4f89-a88e-635bcb618246">pkce</a> does not prevent from using the <a href="/braindump/posts/oauth_2_0/#6f4dbac8-544f-4be9-b9ee-8a42353caa90">client secret</a></h2>
<p>Both where developed while thinking about different issues, they end up
overlapping a lot, bot not totally.</p>
<p>The client secret proves the identity of the client. But application that
cannot protect a secret, like the <a href="/braindump/posts/single_page_application/">single page application</a>s, should not
use it.</p>
<!--more-->
<h2 id="notes-linking-here">Notes linking here</h2>
<ul>
<li><a href="/braindump/posts/oauth_2_0/#1c5ce2b0-1b28-4f35-8978-3ba8acd027b0">5 types of grant -&gt; now only 2</a></li>
<li><a href="/braindump/posts/aaron_parecki/">Aaron Parecki</a></li>
<li><a href="/braindump/posts/oauth_2_0/#6f4dbac8-544f-4be9-b9ee-8a42353caa90">client secret</a></li>
<li><a href="/braindump/posts/forget_about_oauth_2_0_here_comes_oauth_2_1_philippe_de_ryck_ndc_oslo_2022/">Forget about OAuth 2.0. Here comes OAuth 2.1 - Philippe De Ryck - NDC Oslo 2022</a></li>
<li><a href="/braindump/posts/oauth_2_0/#29459edd-a5f0-407f-9457-54e30455bac7">front channel</a></li>
<li><a href="/braindump/posts/how_to_hack_oauth/">How to Hack OAuth</a></li>
<li><a href="/braindump/posts/ory/#hydra-the-id-c177c189-8e25-4b44-abd0-e26e6847326d-oidc-layer">hydra: the OIDC layer</a></li>
<li><a href="/braindump/posts/introduction_to_oauth_and_openid_connect/">Introduction to OAuth and OpenID Connect</a></li>
<li><a href="/braindump/posts/julien_topcu/">Julien Topçu</a></li>
<li><a href="/braindump/posts/oauth_2/">OAuth 2</a></li>
<li><a href="/braindump/posts/oauth_2_with_single_page_apps/">OAuth 2 with Single-Page Apps</a></li>
<li><a href="/braindump/posts/oauth_2_0_for_browser_based_apps/">OAuth 2.0 for Browser-Based Apps</a></li>
<li><a href="/braindump/posts/oauth_2_0_playground/">OAuth 2.0 Playground</a></li>
<li><a href="/braindump/posts/oauth_2_0_threat_model_and_security_considerations/">OAuth 2.0 Threat Model and Security Considerations</a></li>
<li><a href="/braindump/posts/oauth_it_s_complicated/">OAuth It s complicated</a></li>
<li><a href="/braindump/posts/oauth_sketch_notes_q_a_pkce_scopes_security_passwordless/">OAuth Sketch Notes Q&amp;A - PKCE, Scopes, Security, Passwordless</a></li>
<li><a href="/braindump/posts/oauth_the_good_parts_dominick_baier/">OAuth the good Parts Dominick Baier</a></li>
<li><a href="/braindump/posts/ory/">ory</a></li>
<li><a href="/braindump/posts/owasp_api_security_top_10_course_secure_your_web_apps/">OWASP API Security Top 10 Course – Secure Your Web Apps</a></li>
<li><a href="/braindump/posts/protect_your_apis_with_oauth/">Protect Your APIs with OAuth</a></li>
<li><a href="/braindump/posts/oauth_2_0/#118410f7-3339-4794-8107-b03880897104">public client</a></li>
<li><a href="/braindump/posts/which_oauth_2_0_flow_should_i_use/">Which OAuth 2.0 Flow Should I Use?</a></li>
</ul>
<h2 id="permalink"><a href="https://konubinix.eu/braindump/3b845db6-e79b-4403-8cda-cf4c3632489a?title=oauth_2_1">Permalink</a></h2>
      </div>
	  <aside class="date"><time>Last updated: 03 Oct 2024</time></aside>
	  <aside class="date"><time>Published&nbsp;&nbsp;&nbsp;: 04 Mar 2023</time></aside>
    </div>
  </div>
</div>

<script src="/braindump/js/URI.js" type="text/javascript"></script>

<script src="/braindump/js/page.js" type="text/javascript"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
