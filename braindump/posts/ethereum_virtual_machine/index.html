<!DOCTYPE html>
<html><title>Ethereum Virtual Machine</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="bLmaFyyXugiCqSup-eIIIx0B4CngtdF_svyMMKQbS5E" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, minimum-scale=0.5, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src="https://hypothes.is/embed.js" async></script>


<link rel="stylesheet" href="/braindump/css/main.min.56b43bcbc759a196f9dd525bee62bdec45a29ba95902bbab74a4f7ad2ea3e8cb.css"/>

<link rel="stylesheet" href="/braindump/css/links.min.4bf1990b213fb76d2a66153dc6ef9a57d49f536c6baf6e7f19a7948470a38141.css"/>

<link rel="stylesheet" href="/braindump/css/konubinix.min.cf2d0f36945178c647979ee68f1830892e06aa3d481d8913728b5c7462b97f6e.css"/>

<link rel="stylesheet" href="/ipfs/QmQFVQS89fv1XUNFcjwCKDePzckuT9kpuAVNYUwNdEfYcv/css/all.css"/>
<link rel="shortcut icon" href="/ipfs/QmVFwYV7YRZLKU3ybN1hW4jqfyZGPLKJwd8toN2wHz5UAD?a.png" type="image/x-icon" />

<body><header>
  <div>
	<a href="/braindump//"><h5 class="site-title">Konubinix&#39; opinionated web of thoughts</h5></a>
  </div>
  <span>
	<a href="/blog/"><i class="icon fas fa-blog"></i></a>
	<a href="/braindump/posts/"><i class="icon fas fa-brain"></i></a>
    <a href="mailto:konubinixweb@gmail.com"><i class="icon fas fa-envelope-square"></i></a>
    <a href="https://github.com/konubinix"><i class="icon fab fa-github-square"></i></a>
    <a href="https://linkedin.com/in/samuel-loury-61259040"><i class="icon fab fa-linkedin"></i></a>
	<a href="/braindump/graph.html"><i class="icon fas fa-project-diagram"></i></a>
	<a href="/braindump/index.xml"><i class="icon fas fa-rss-square"></i></a>
	<a href="/braindump/tags/"><i class="icon fa fa-tag"></i></a>
	<a href="/braindump/braindump_search"><i class="icon fa fa-search"></i></a>
  </span>
</header>

<div class="grid-container">
  <div class="grid">
    <div class="page" data-level="1">
      <div class="content">
		<p class="lead">
        <h1>Ethereum Virtual Machine</h1>
		<span class="badge badge-pill badge-warning"><a href="/braindump/tags/fleeting/">Fleeting</a></span></p>
        <ul>
<li>Référence externe : <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></li>
<li>Référence externe : <a href="https://coinsbench.com/solidity-9-memory-storage-and-calldata-9abc86f0b4e">https://coinsbench.com/solidity-9-memory-storage-and-calldata-9abc86f0b4e</a></li>
<li>Référence externe : <a href="https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7">https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7</a></li>
<li>Référence externe : <a href="https://docs.alchemy.com/docs/when-to-use-storage-vs-memory-vs-calldata-in-solidity">https://docs.alchemy.com/docs/when-to-use-storage-vs-memory-vs-calldata-in-solidity</a></li>
</ul>
<p>Ethereum Virtual Machine</p>
<h2 id="smart-contract--smart-contract-dot-md"><a href="/braindump/posts/smart_contract/">smart-contract</a></h2>
<blockquote>
<p>address of a contract is
determined at the time the contract is created
(it is derived from the creator address and the number
of transactions sent from that address, the so-called “nonce”).</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Every account has a persistent key-value store mapping 256-bit words to 256-bit
words called storage.</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>transaction is a message that is sent from one account to another
account (which might be the same or empty, see below).
It can include binary data (which is called “payload”) and Ether.</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>If the target account is not set (the transaction does not have
a recipient or the recipient is set to null), the transaction
creates a new contract.
As already mentioned, the address of that contract is not
the zero address but an address derived from the sender and
its number of transactions sent (the “nonce”).</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>payload
of such a contract creation transaction is taken to be
EVM bytecode and executed. The output data of this execution is
permanently stored as the code of the contract.</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>in order to create a contract, you do not
send the actual code of the contract, but in fact code that
returns that code when executed.</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Upon creation, each transaction is charged with a certain amount of gas
that has to be paid for by the originator of the transaction (tx.origin).
While the EVM executes the
transaction, the gas is gradually depleted according to specific rules.
If the gas is used up at any point (i.e. it would be negative),
an out-of-gas exception is triggered, which ends execution and reverts all modifications
made to the state in the current call frame.</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Ethereum Virtual Machine has three areas where it can store data:
storage, memory and the stack.</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Each account has a data area called storage, which is persistent between function calls
and transactions</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>not possible to enumerate storage from within a contract, it is
comparatively costly to read, and even more to initialise and modify storage</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>second data area is called memory, of which a contract obtains
a freshly cleared instance for each message call.</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Memory is linear and can be
addressed at byte level, but reads are limited to a width of 256 bits, while writes
can be either 8 bits or 256 bits wide</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>At the time of expansion, the cost in gas must be paid. Memory is more
costly the larger it grows (it scales quadratically)</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>EVM is not a register machine but a stack machine, so all
computations are performed on a data area called the stack. It has a maximum size of
1024 elements and contains words of 256 bits</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Access to the stack is
limited to the top end in the following way:
It is possible to copy one of
the topmost 16 elements to the top of the stack or swap the
topmost element with one of the 16 elements below it</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>possible to move stack elements to storage or memory
in order to get deeper access to the stack,
but it is not possible to just access arbitrary elements deeper in the stack
without first removing the top of the stack.</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>called contract (which can be the same as the caller)
will receive a freshly cleared instance of memory and has access to the
call payload - which will be provided in a separate area called the calldata</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>can return data which will be stored at
a location in the caller’s memory preallocated by the caller.
All such calls are fully synchronous.</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Calls are limited to a depth of 1024, which means that for more complex
operations, loops should be preferred over recursive calls.</p>
<p>&mdash; <a href="https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.21/introduction-to-smart-contracts.html</a></p>
</blockquote>
<h2 id="memory-model">memory model</h2>
<blockquote>
<p>Memory is used for variables that are only needed temporarily, such as function arguments, local variables, or arrays that are created dynamically during the execution of a function. Once the function execution is complete, the memory space is freed up.</p>
<p>&mdash; <a href="https://docs.alchemy.com/docs/when-to-use-storage-vs-memory-vs-calldata-in-solidity">https://docs.alchemy.com/docs/when-to-use-storage-vs-memory-vs-calldata-in-solidity</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Calldata is used for function arguments that are passed in from an external caller, such as a user or another smart contract. Calldata is read-only, meaning that it cannot be modified by the function</p>
<p>&mdash; <a href="https://docs.alchemy.com/docs/when-to-use-storage-vs-memory-vs-calldata-in-solidity">https://docs.alchemy.com/docs/when-to-use-storage-vs-memory-vs-calldata-in-solidity</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>The key difference between memory and calldata is that memory is a temporary data storage location that can be modified by a function, while calldata is a read-only temporary data storage location used to hold function arguments passed in from an external caller</p>
<p>&mdash; <a href="https://docs.alchemy.com/docs/when-to-use-storage-vs-memory-vs-calldata-in-solidity">https://docs.alchemy.com/docs/when-to-use-storage-vs-memory-vs-calldata-in-solidity</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>storage — this belongs to the contract and persists between function calls. It is where you store a contract’s state variables. If you allocate something to storage, it persists. A contract can only see its own storage</p>
<p>&mdash; <a href="https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7">https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>memory — this is volatile. The EVM hands over a clean slate of memory for each message call. It can be expanded at runtime, but it gets quadratically more expensive the more you ask for. Once the message has been processed it all gets junked.</p>
<p>&mdash; <a href="https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7">https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>calldata — this too is memory. It is volatile and a cleared space is allocated by the EVM when a message is being processed. It contains the value of function parameters within the context of a function call. Handy if you ever recursed.</p>
<p>&mdash; <a href="https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7">https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>EVM is a stack machine. The computers we normally program are register machine</p>
<p>&mdash; <a href="https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7">https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>This difference accounts for much of why the EVM seems weird and Solidity seems to have such obvious limitations</p>
<p>&mdash; <a href="https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7">https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Watch out for allocating huge amounts or memory during your function calls as the gas price of your message will skyrocket.</p>
<p>&mdash; <a href="https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7">https://medium.com/@simon.palmer_42769/solidity-gotchas-part-2-storage-memory-and-calldata-ca697e49d2a7</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>foo is defined inside the function, so by default it is stored in memory</p>
<p>&mdash; <a href="https://coinsbench.com/solidity-9-memory-storage-and-calldata-9abc86f0b4e">https://coinsbench.com/solidity-9-memory-storage-and-calldata-9abc86f0b4e</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>When the function bar is invoked, a space in memory will be allocated to store the value of the variable foo.</p>
<p>&mdash; <a href="https://coinsbench.com/solidity-9-memory-storage-and-calldata-9abc86f0b4e">https://coinsbench.com/solidity-9-memory-storage-and-calldata-9abc86f0b4e</a></p>
</blockquote>
<!--more-->
<h2 id="notes-pointant-ici">Notes pointant ici</h2>
<ul>
<li><a href="/braindump/posts/brownie/">brownie</a></li>
</ul>
<h2 id="permalink"><a href="https://konubinix.eu/braindump/d8ee2883-4226-471e-83c3-9852375d63b9?title=ethereum_virtual_machine">Permalink</a></h2>
      </div>
	  <aside class="date"><time>Last updated: 06 Oct 2023</time></aside>
	  <aside class="date"><time>Published&nbsp;&nbsp;&nbsp;: 03 Jan 2022</time></aside>
    </div>
  </div>
</div>

<script src="/braindump/js/URI.js" type="text/javascript"></script>

<script src="/braindump/js/page.js" type="text/javascript"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
