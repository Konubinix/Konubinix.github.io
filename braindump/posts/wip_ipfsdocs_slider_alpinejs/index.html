<!DOCTYPE html>
<html><title>wip ipfsdocs slider alpinejs</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="bLmaFyyXugiCqSup-eIIIx0B4CngtdF_svyMMKQbS5E" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, minimum-scale=0.5, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src="https://hypothes.is/embed.js" async></script>


<link rel="stylesheet" href="/braindump/css/main.min.56b43bcbc759a196f9dd525bee62bdec45a29ba95902bbab74a4f7ad2ea3e8cb.css"/>

<link rel="stylesheet" href="/braindump/css/links.min.4bf1990b213fb76d2a66153dc6ef9a57d49f536c6baf6e7f19a7948470a38141.css"/>

<link rel="stylesheet" href="/braindump/css/konubinix.min.cf2d0f36945178c647979ee68f1830892e06aa3d481d8913728b5c7462b97f6e.css"/>

<link rel="stylesheet" href="/ipfs/QmQFVQS89fv1XUNFcjwCKDePzckuT9kpuAVNYUwNdEfYcv/css/all.css"/>
<link rel="shortcut icon" href="/ipfs/QmVFwYV7YRZLKU3ybN1hW4jqfyZGPLKJwd8toN2wHz5UAD?a.png" type="image/x-icon" />

<body><header>
  <div>
	<a href="/braindump//"><h5 class="site-title">Konubinix&#39; opinionated web of thoughts</h5></a>
  </div>
  <span>
	<a href="/blog/"><i class="icon fas fa-blog"></i></a>
	<a href="/braindump/posts/"><i class="icon fas fa-brain"></i></a>
    <a href="mailto:konubinixweb@gmail.com"><i class="icon fas fa-envelope-square"></i></a>
    <a href="https://github.com/konubinix"><i class="icon fab fa-github-square"></i></a>
    <a href="https://linkedin.com/in/samuel-loury-61259040"><i class="icon fab fa-linkedin"></i></a>
	<a href="/braindump/graph.html"><i class="icon fas fa-project-diagram"></i></a>
	<a href="/braindump/index.xml"><i class="icon fas fa-rss-square"></i></a>
	<a href="/braindump/tags/"><i class="icon fa fa-tag"></i></a>
	<a href="/braindump/braindump_search"><i class="icon fa fa-search"></i></a>
  </span>
</header>

<div class="grid-container">
  <div class="grid">
    <div class="page" data-level="1">
      <div class="content">
		<p class="lead">
        <h1>Wip Ipfsdocs Slider Alpinejs</h1>
		<span class="badge badge-pill badge-warning"><a href="/braindump/tags/fleeting/">Fleeting</a></span></p>
        <p>wip <a href="/braindump/posts/ipfsdocs/">ipfsdocs</a>, <a href="/braindump/posts/alpine_js/">alpine.js</a></p>
<h2 id="6c0b84be-44da-4c6c-a763-989e6f0213d4">root level</h2>
<p><a id="code-snippet--root"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mhtml" data-lang="mhtml"><span style="display:flex;"><span>&lt;<span style="color:#000080">html</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">meta</span> <span style="color:#008080">charset</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;UTF-8&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!-- &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34; /&gt; --&gt;</span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">meta</span> <span style="color:#008080">name</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;viewport&#34;</span> <span style="color:#008080">content</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">link</span> <span style="color:#008080">rel</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;manifest&#34;</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;./manifest.json&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">link</span> <span style="color:#008080">rel</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;icon&#34;</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;./icons/icon-512x512.png&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;image/x-icon&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">link</span> <span style="color:#008080">rel</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;shortcut icon&#34;</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;./icons/icon-512x512.png&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;image/x-icon&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span> <span style="color:#008080">defer</span> <span style="color:#008080">src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/ipfs/bafkreib3gcvqpp3fox36m7sn4d6qfcru7n62svzclt5w7lf6j43pkyla4q?orig=https://cdn.jsdelivr.net/npm/@alpinejs/intersect@3.x.x/dist/cdn.js&#34;</span>&gt;&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span> <span style="color:#008080">defer</span> <span style="color:#008080">src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/ipfs/bafkreihw6a7byfwe4mtoda5ivd6wkdmclapfij6jul5vdb2on5qmori7fe?orig=https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.js&#34;</span>&gt;&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span> <span style="color:#008080">defer</span> <span style="color:#008080">src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/ipfs/bafkreid7munpltjkx2hi3btduhizhajxun6wonz4pkjaemcc2ovl7itw2q?orig=https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.js&#34;</span>&gt;&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span> <span style="color:#008080">src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/ipfs/bafybeihp5kzlgqt56dmy5l4z7kpymfc4kn3fnehrrtr7cid7cn7ra36yha?orig=https://cdn.tailwindcss.com/3.4.3&#34;</span>&gt;&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span> <span style="color:#008080">src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/ipfs/bafkreidbmnazlpto4hcnpdbyicqa3yh3x73e7sknzawgykpzie26zd3hb4?orig=https://cdn.jsdelivr.net/npm/gun/gun.js&#34;</span>&gt;&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    [[toast-code]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>      [[wip_ipfsdocs_with_alpine.org<span style="color:#000;font-weight:bold">:</span>helpers<span style="color:#000;font-weight:bold">-</span>ex()]]
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#0086b3">document</span>.addEventListener(<span style="color:#d14">&#39;alpine:init&#39;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>          Alpine.data(<span style="color:#d14">&#39;app&#39;</span>, () =&gt; (
</span></span><span style="display:flex;"><span>              [[app<span style="color:#000;font-weight:bold">-</span>code]]
</span></span><span style="display:flex;"><span>          ));
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">style</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">/* make sure the scrollbar won&#39;t anoy me */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">*</span> {
</span></span><span style="display:flex;"><span>      scrollbar-width: <span style="color:#000;font-weight:bold">none</span>; <span style="color:#998;font-style:italic">/* Firefox */</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">-ms-</span><span style="color:#000;font-weight:bold">overflow-style</span>: <span style="color:#000;font-weight:bold">none</span>;  <span style="color:#998;font-style:italic">/* IE 10+ */</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">*</span>::<span style="color:#3c5d5d;font-weight:bold">-webkit-scrollbar</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">display</span>: <span style="color:#000;font-weight:bold">none</span>;  <span style="color:#998;font-style:italic">/* Chrome, Safari, Opera */</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">style</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">body</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;app&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;overflow-auto bg-black text-slate-700&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-init</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">controller-tools</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;effect([&#39;autoplay&#39;, &#39;smooth_scroll&#39;, &#39;gun.objects.controller&#39;], () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             if(gun.objects.controller) {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             gun.objects.controller.put({smooth_scroll: smooth_scroll})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             gun.objects.controller.put({autoplay: autoplay})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             })
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">avoid-trying-gun-connection-on-night</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;gun.try_connection = ! night&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-init</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">controlled-tools</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;effect(&#39;controlled&#39;, () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             if(controlled != &#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             var rec_channel = channel
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             var rec_controlled = controlled
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             let table = gun.root.get(&#39;ipfsdocs&#39;).get(channel).get(&#39;control&#39;).get(controlled)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             // when starting to follow, I want to start with the last point. Otherwise, I want to clean it
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             if(! get_param(&#39;follow_controlled&#39;))
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             table.put({smooth_scroll: null, autoplay: null}) // clean the data to avoid being dragged by old interactions
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             table.map().on((value, name, msg, ev) =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             if(rec_channel !== channel || rec_controlled !== controlled){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             ev.off()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             return
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             if(value !== null)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             // debug(`setting ${name}: ${value}`)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             if(name === &#39;smooth_scroll&#39;){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             smooth_scroll = value
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             if(name === &#39;autoplay&#39;){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             autoplay = value
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             })
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             })
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                             &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-init</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">subscribe-to-tools</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;effect(&#39;channel&#39;, () =&gt; {if(channel !== &#39;&#39;){gun.objects.tools = gun.root.get(&#39;ipfsdocs&#39;).get(channel).get(&#39;tools&#39;)}})&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-init</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">update-tools</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;effect([&#39;gun.objects.tools&#39;], () =&gt; {var recorded_channel = channel; gun.objects.tools.map().on((value, name, msg, ev) =&gt; {if(recorded_channel !== channel){ev.off();return} ;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                                                                                                           //info(`${name}: ${value}`);
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                                                                                                           data_to_fetch[name] = value})})&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-init</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">subscribe-to-docs</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;effect(&#39;channel&#39;, () =&gt; {if(channel !== &#39;&#39;){alldocs=[];gun.objects.docs = gun.root.get(&#39;ipfsdocs&#39;).get(channel).get(&#39;docs&#39;)}})&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-init</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">update-docs</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;effect(
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        [&#39;gun.objects.docs&#39;],
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        var rec_channel = channel
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        gun.objects.docs.map().on(
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        (data, name, msg, ev) =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        if(rec_channel !== channel){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        ev.off();return
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        if(name !== &#39;docs&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        return
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        try {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        var newData = JSON.parse(data)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        info(&#39;got new data&#39;);
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        // console.log(`new data -&gt;`)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        // console.log(newData)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        alldocs = newData
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        for(hook of docs_update_hooks){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        hook()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        } catch (err)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        error(`error parsing: ${data}`)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        console.log(`error parsing: ${data}`)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        throw err
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        })
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        gun.objects.docs.get(&#39;splitdocs&#39;).map().on(
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        (data, name, msg, ev) =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        if(rec_channel !== channel){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        ev.off();return
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        console.log(`got data for ${name}`)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        })
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        )&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">scrolltodoc</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  $el.scroll({top: 0, behavior: smooth_scroll &amp;&amp; ! $event.detail.immediate ? &#39;smooth&#39; : &#39;instant&#39;})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  &#34;</span>
</span></span><span style="display:flex;"><span>    &gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;message&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    [[slider]]
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;true&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">img</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;nightimage&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;night&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">x-effect</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                     if(night_timer){clearTimeout(night_timer)}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                     if(night_mode){trigger_next_night_time()}else{night = false}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                     &#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   candidates: [
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   &#39;https://i.ytimg.com/vi/_cJbK9_JVK0/maxresdefault.jpg&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   &#39;https://ici.exploratv.ca/upload/cms/IMAGES_2021/10-photos-espace-hiver-cosmique.jpg&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   &#39;https://img.huffingtonpost.com/asset/5c933c122300004b00ae3b0c.jpeg&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   &#39;https://wallpapercave.com/wp/wp3474282.jpg&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   &#39;http://www.joliefreebox.com/wp-content/uploads/2013/05/univers-1024x576.jpg&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   ],
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   getone(){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   return this.candidates[Math.floor(Math.random() * this.candidates.length)];
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                   }}&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-full object-contain min-h-screen&#34;</span> <span style="color:#008080">:src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;getone&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{message: &#39;&#39;}&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;alldocs.length === 0 &amp;&amp; ! night&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">x-effect</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;message = gun.connected ? &#39;scroll down to configure&#39; : &#39;initializing&#39;&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;flex items-center min-w-full h-screen&#34;</span>
</span></span><span style="display:flex;"><span>         &gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text-white text-3xl text-center w-full&#34;</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;message&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    [[tools]]
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">html</span>&gt;
</span></span></code></pre></div><p><a id="code-snippet--app-code"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    [[gun<span style="color:#000;font-weight:bold">-</span>js<span style="color:#000;font-weight:bold">-</span>code]]
</span></span><span style="display:flex;"><span>    [[effect]]
</span></span><span style="display:flex;"><span>    docs_update_hooks<span style="color:#000;font-weight:bold">:</span> [],
</span></span><span style="display:flex;"><span>    autoplay<span style="color:#000;font-weight:bold">:</span> Alpine.$persist(<span style="color:#000;font-weight:bold">false</span>).as(<span style="color:#d14">&#34;autoplay&#34;</span>),
</span></span><span style="display:flex;"><span>    night_mode<span style="color:#000;font-weight:bold">:</span> Alpine.$persist(<span style="color:#000;font-weight:bold">false</span>).as(<span style="color:#d14">&#34;night_mode&#34;</span>),
</span></span><span style="display:flex;"><span>    night<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>    transition<span style="color:#000;font-weight:bold">:</span> Alpine.$persist(<span style="color:#d14">&#34;swipe&#34;</span>).as(<span style="color:#d14">&#34;transition&#34;</span>),
</span></span><span style="display:flex;"><span>    quality<span style="color:#000;font-weight:bold">:</span> Alpine.$persist(<span style="color:#d14">&#34;thumbtoweb&#34;</span>).as(<span style="color:#d14">&#34;quality&#34;</span>),
</span></span><span style="display:flex;"><span>    night_timer<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    trigger_next_night_time() {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">const</span> lasthourofday<span style="color:#000;font-weight:bold">=</span><span style="color:#099">22</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">const</span> lastminuteofday<span style="color:#000;font-weight:bold">=</span><span style="color:#099">59</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">const</span> firsthourofday<span style="color:#000;font-weight:bold">=</span><span style="color:#099">6</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">const</span> firstminuteofday<span style="color:#000;font-weight:bold">=</span><span style="color:#099">30</span>
</span></span><span style="display:flex;"><span>        now <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> <span style="color:#0086b3">Date</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(
</span></span><span style="display:flex;"><span>            (now.getHours() <span style="color:#000;font-weight:bold">===</span> lasthourofday <span style="color:#000;font-weight:bold">&amp;&amp;</span> now.getMinutes() <span style="color:#000;font-weight:bold">&gt;=</span> lastminuteofday)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">||</span>
</span></span><span style="display:flex;"><span>                now.getHours() <span style="color:#000;font-weight:bold">&gt;</span> lasthourofday
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">||</span>
</span></span><span style="display:flex;"><span>                now.getHours() <span style="color:#000;font-weight:bold">&lt;</span> firsthourofday
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">||</span>
</span></span><span style="display:flex;"><span>                (now.getHours() <span style="color:#000;font-weight:bold">==</span> firsthourofday <span style="color:#000;font-weight:bold">&amp;&amp;</span> now.getMinutes() <span style="color:#000;font-weight:bold">&lt;</span> firstminuteofday)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.night <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span>(now.getHours() <span style="color:#000;font-weight:bold">&lt;=</span> firsthourofday)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                milli_until_tomorrow <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> <span style="color:#0086b3">Date</span>(now.getFullYear(), now.getMonth(), now.getDate(), firsthourofday, firstminuteofday, <span style="color:#099">0</span>, <span style="color:#099">0</span>) <span style="color:#000;font-weight:bold">-</span> now
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                milli_until_tomorrow <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> <span style="color:#0086b3">Date</span>(now.getFullYear(), now.getMonth(), now.getDate() <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>, firsthourofday, firstminuteofday, <span style="color:#099">0</span>, <span style="color:#099">0</span>) <span style="color:#000;font-weight:bold">-</span> now
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            console.log(<span style="color:#d14">`day in </span><span style="color:#d14">${</span>milli_until_tomorrow<span style="color:#d14">}</span><span style="color:#d14"> ms`</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.night_timer <span style="color:#000;font-weight:bold">=</span> setTimeout(() =&gt; {<span style="color:#000;font-weight:bold">this</span>.trigger_next_night_time()}, milli_until_tomorrow)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.night <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">const</span> milli_until_tonight <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> <span style="color:#0086b3">Date</span>(now.getFullYear(), now.getMonth(), now.getDate(), lasthourofday, lastminuteofday, <span style="color:#099">0</span>, <span style="color:#099">0</span>) <span style="color:#000;font-weight:bold">-</span> now
</span></span><span style="display:flex;"><span>            console.log(<span style="color:#d14">`night in </span><span style="color:#d14">${</span>milli_until_tonight<span style="color:#d14">}</span><span style="color:#d14"> ms`</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.night_timer <span style="color:#000;font-weight:bold">=</span> setTimeout(() =&gt; {<span style="color:#000;font-weight:bold">this</span>.trigger_next_night_time()}, milli_until_tonight)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    autoplay_time<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">60</span><span style="color:#000;font-weight:bold">*</span><span style="color:#099">1000</span>,
</span></span><span style="display:flex;"><span>    smooth_scroll<span style="color:#000;font-weight:bold">:</span> Alpine.$persist(<span style="color:#000;font-weight:bold">false</span>).as(<span style="color:#d14">&#34;smooth_scroll&#34;</span>),
</span></span><span style="display:flex;"><span>    controller<span style="color:#000;font-weight:bold">:</span> Alpine.$persist(<span style="color:#d14">&#39;&#39;</span>).as(<span style="color:#d14">&#34;controller&#34;</span>),
</span></span><span style="display:flex;"><span>    controlled<span style="color:#000;font-weight:bold">:</span> get_param(<span style="color:#d14">&#39;follow_controlled&#39;</span>) <span style="color:#000;font-weight:bold">||</span> Alpine.$persist(<span style="color:#d14">&#39;&#39;</span>).as(<span style="color:#d14">&#34;controlled&#34;</span>),
</span></span><span style="display:flex;"><span>    doc(index) {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span>.alldocs[((index <span style="color:#000;font-weight:bold">%</span> <span style="color:#000;font-weight:bold">this</span>.alldocs.length) <span style="color:#000;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">this</span>.alldocs.length) <span style="color:#000;font-weight:bold">%</span> <span style="color:#000;font-weight:bold">this</span>.alldocs.length]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> init () {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.gun.init()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.get_tags()
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="f25924bd-a64e-4599-9622-0ffdb67adfa9">effect</h2>
<p><a id="code-snippet--effect-ex"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-org" data-lang="org"><span style="display:flex;"><span>[[<span style="color:#008080">effect</span>]]
</span></span></code></pre></div><p><a id="code-snippet--effect"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>effect(attr, f) {
</span></span><span style="display:flex;"><span>    f()
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> (<span style="color:#0086b3">Array</span>.isArray(attr)) {
</span></span><span style="display:flex;"><span>        attr.forEach((element) =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.$watch(element, f);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    } <span style="color:#000;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.$watch(attr, f);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>},
</span></span></code></pre></div><h2 id="1fba65f5-9902-4cee-9864-e2217e07f62e">toasts</h2>
<p><a id="code-snippet--toast-code-ex"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-org" data-lang="org"><span style="display:flex;"><span>[[<span style="color:#008080">toast-code</span>]]
</span></span></code></pre></div><p><a id="code-snippet--toast-code"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mhtml" data-lang="mhtml"><span style="display:flex;"><span>&lt;<span style="color:#000080">link</span> <span style="color:#008080">rel</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;stylesheet&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text/css&#34;</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;http://192.168.2.14:9999/ipfs/bafybeienb3tpzdewluwh5i5mzrc7wq3vibqqsp52gf6z4j26winzlsbqlm/toastify.min.css?orig=https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">script</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text/javascript&#34;</span> <span style="color:#008080">src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;http://192.168.2.14:9999/ipfs/bafybeienb3tpzdewluwh5i5mzrc7wq3vibqqsp52gf6z4j26winzlsbqlm/toastify-js?orig=https://cdn.jsdelivr.net/npm/toastify-js&#34;</span>&gt;&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">function</span> debug(msg) {
</span></span><span style="display:flex;"><span>      info(msg, <span style="color:#099">10000</span>)
</span></span><span style="display:flex;"><span>      console.log(msg)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">function</span> info(msg, time) {
</span></span><span style="display:flex;"><span>  Toastify({
</span></span><span style="display:flex;"><span>  text<span style="color:#000;font-weight:bold">:</span> JSON.stringify(msg),
</span></span><span style="display:flex;"><span>  duration<span style="color:#000;font-weight:bold">:</span> time <span style="color:#000;font-weight:bold">||</span> <span style="color:#099">3000</span>,
</span></span><span style="display:flex;"><span>  newWindow<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  close<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>  gravity<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;top&#34;</span>, <span style="color:#998;font-style:italic">// `top` or `bottom`
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  position<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;right&#34;</span>, <span style="color:#998;font-style:italic">// `left`, `center` or `right`
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  stopOnFocus<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">true</span>, <span style="color:#998;font-style:italic">// Prevents dismissing of toast on hover
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  style<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>  background<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;linear-gradient(to right, #00b09b, #96c93d)&#34;</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  }).showToast();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">function</span> error(msg) {
</span></span><span style="display:flex;"><span>  Toastify({
</span></span><span style="display:flex;"><span>  text<span style="color:#000;font-weight:bold">:</span> msg,
</span></span><span style="display:flex;"><span>  duration<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>,
</span></span><span style="display:flex;"><span>  newWindow<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>  close<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>  gravity<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;top&#34;</span>, <span style="color:#998;font-style:italic">// `top` or `bottom`
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  position<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;right&#34;</span>, <span style="color:#998;font-style:italic">// `left`, `center` or `right`
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  stopOnFocus<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">true</span>, <span style="color:#998;font-style:italic">// Prevents dismissing of toast on hover
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  style<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>  background<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;linear-gradient(to right, orange, red)&#34;</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  }).showToast();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">script</span>&gt;
</span></span></code></pre></div><h2 id="59b199c3-9c08-415b-9c1d-73d4ca246178">gun/postgrest and docs</h2>
<p><a id="code-snippet--gun-js-code"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>fetch_from_min<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;2007-01-01&#39;</span>,
</span></span><span style="display:flex;"><span>filter_in<span style="color:#000;font-weight:bold">:</span> [],
</span></span><span style="display:flex;"><span>data_to_fetch<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>    table<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;photovideo&#39;</span>,
</span></span><span style="display:flex;"><span>    shuffle<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>    filter_in_raw<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;[]&#39;</span>,
</span></span><span style="display:flex;"><span>    fromdate<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>    only_like<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>    to<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>    limit<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">500</span>,
</span></span><span style="display:flex;"><span>    state<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;done&#34;</span>,
</span></span><span style="display:flex;"><span>    owner<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;aylapomme&#39;</span>,
</span></span><span style="display:flex;"><span>    type<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>},
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">async</span> fetch_docs(_shuffle) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span>{
</span></span><span style="display:flex;"><span>        url <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">`</span><span style="color:#d14">${</span>server<span style="color:#d14">}</span><span style="color:#d14">/postgrest/ipfsdocs_photovideo_view?owner=eq.</span><span style="color:#d14">${</span><span style="color:#000;font-weight:bold">this</span>.data_to_fetch.owner<span style="color:#d14">}</span><span style="color:#d14">&amp;state=eq.</span><span style="color:#d14">${</span><span style="color:#000;font-weight:bold">this</span>.data_to_fetch.state<span style="color:#d14">}</span><span style="color:#d14">&amp;select=cid,thumbnail_cid,web_cid,class,date,metadata,hash&amp;limit=</span><span style="color:#d14">${</span><span style="color:#000;font-weight:bold">this</span>.data_to_fetch.limit<span style="color:#d14">}</span><span style="color:#d14">`</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.filter_in.length <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0</span>){
</span></span><span style="display:flex;"><span>            value <span style="color:#000;font-weight:bold">=</span> JSON.stringify(<span style="color:#000;font-weight:bold">this</span>.filter_in)
</span></span><span style="display:flex;"><span>            url <span style="color:#000;font-weight:bold">+=</span> <span style="color:#d14">`&amp;metadata=cs.</span><span style="color:#d14">${</span>value<span style="color:#d14">}</span><span style="color:#d14">`</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.data_to_fetch.only_like){
</span></span><span style="display:flex;"><span>            url <span style="color:#000;font-weight:bold">+=</span> <span style="color:#d14">`&amp;metadata=cs.[{&#34;key&#34;: &#34;tag&#34;, &#34;value&#34;: &#34;like&#34;}]`</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.data_to_fetch.type <span style="color:#000;font-weight:bold">!=</span> <span style="color:#d14">&#34;&#34;</span>){
</span></span><span style="display:flex;"><span>            url <span style="color:#000;font-weight:bold">+=</span> <span style="color:#d14">`&amp;mimetype=ilike.</span><span style="color:#d14">${</span><span style="color:#000;font-weight:bold">this</span>.data_to_fetch.type<span style="color:#d14">}</span><span style="color:#d14">*`</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.data_to_fetch.fromdate)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            url <span style="color:#000;font-weight:bold">+=</span> <span style="color:#d14">`&amp;date=gte.</span><span style="color:#d14">${</span><span style="color:#000;font-weight:bold">this</span>.data_to_fetch.fromdate<span style="color:#d14">}</span><span style="color:#d14">`</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.data_to_fetch.table <span style="color:#000;font-weight:bold">!==</span> <span style="color:#d14">&#39;photovideo&#39;</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            url <span style="color:#000;font-weight:bold">+=</span> <span style="color:#d14">`&amp;class=eq.</span><span style="color:#d14">${</span><span style="color:#000;font-weight:bold">this</span>.data_to_fetch.table<span style="color:#d14">}</span><span style="color:#d14">`</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.data_to_fetch.to)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            url <span style="color:#000;font-weight:bold">+=</span> <span style="color:#d14">`&amp;date=lte.</span><span style="color:#d14">${</span><span style="color:#000;font-weight:bold">this</span>.data_to_fetch.to<span style="color:#d14">}</span><span style="color:#d14">`</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(_shuffle <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">true</span> <span style="color:#000;font-weight:bold">||</span> (_shuffle <span style="color:#000;font-weight:bold">!==</span> <span style="color:#000;font-weight:bold">false</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> <span style="color:#000;font-weight:bold">this</span>.data_to_fetch.shuffle))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            url <span style="color:#000;font-weight:bold">+=</span> <span style="color:#d14">&#34;&amp;order=myrandom&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            url <span style="color:#000;font-weight:bold">+=</span> <span style="color:#d14">&#34;&amp;order=date.asc,web_cid.asc&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        res <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> fetch(url)
</span></span><span style="display:flex;"><span>        _docs <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> res.json()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span>(<span style="color:#000;font-weight:bold">var</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; i <span style="color:#000;font-weight:bold">&lt;</span> _docs.length <span style="color:#000;font-weight:bold">/</span> <span style="color:#000;font-weight:bold">this</span>.splitsize; i<span style="color:#000;font-weight:bold">++</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">let</span> doc <span style="color:#000;font-weight:bold">=</span> {}
</span></span><span style="display:flex;"><span>            doc[i] <span style="color:#000;font-weight:bold">=</span> JSON.stringify(_docs.slice(i<span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">this</span>.splitsize, (i<span style="color:#000;font-weight:bold">+</span><span style="color:#099">1</span>)<span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">this</span>.splitsize))
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.gun.objects.docs.put({<span style="color:#d14">&#34;splitdocs&#34;</span><span style="color:#000;font-weight:bold">:</span> doc})
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.gun.objects.docs.put({<span style="color:#d14">&#34;docs&#34;</span><span style="color:#000;font-weight:bold">:</span> JSON.stringify(_docs)})
</span></span><span style="display:flex;"><span>        l <span style="color:#000;font-weight:bold">=</span> _docs.length
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// info(`fetched from server -&gt; ${l}`)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">this</span>.$dispatch(<span style="color:#d14">&#39;fetched&#39;</span>)
</span></span><span style="display:flex;"><span>    } <span style="color:#000;font-weight:bold">catch</span> (err)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        error(err)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">throw</span> err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>},
</span></span><span style="display:flex;"><span>gun<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>    init () {
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// clean the localstorage to avoid old data to come back
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        localStorage.removeItem(<span style="color:#d14">&#34;gun/&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.root <span style="color:#000;font-weight:bold">=</span> Gun(<span style="color:#000;font-weight:bold">this</span>.server)
</span></span><span style="display:flex;"><span>        setInterval(() =&gt; {<span style="color:#000;font-weight:bold">this</span>.check_connection()}, <span style="color:#099">5000</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    check_connection() {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">this</span>.try_connection)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">const</span> peer <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.root.back(<span style="color:#d14">&#39;opt.peers&#39;</span>)[<span style="color:#000;font-weight:bold">this</span>.server]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(peer <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">undefined</span> <span style="color:#000;font-weight:bold">||</span> peer.wire <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">undefined</span> <span style="color:#000;font-weight:bold">||</span> <span style="color:#000;font-weight:bold">!</span> peer.wire.readyState)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.connected <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>            info(<span style="color:#d14">&#34;connection lost, reconnecting&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.root.opt({peers<span style="color:#000;font-weight:bold">:</span> [<span style="color:#000;font-weight:bold">this</span>.server]})
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.root.on(<span style="color:#d14">&#39;out&#39;</span>, { get<span style="color:#000;font-weight:bold">:</span> { <span style="color:#d14">&#39;#&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">this</span>.server } }); <span style="color:#998;font-style:italic">// Trigger a get to reconnect
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.connected <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">false</span>){
</span></span><span style="display:flex;"><span>                info(<span style="color:#d14">&#34;connected&#34;</span>)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.connected <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    server<span style="color:#000;font-weight:bold">:</span> gunserver,
</span></span><span style="display:flex;"><span>    root<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    try_connection<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">true</span>,
</span></span><span style="display:flex;"><span>    connected<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>    objects<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>        docs<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>        tools<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>        controller<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>},
</span></span><span style="display:flex;"><span>channel<span style="color:#000;font-weight:bold">:</span> get_param(<span style="color:#d14">&#39;follow_channel&#39;</span>) <span style="color:#000;font-weight:bold">||</span> Alpine.$persist(<span style="color:#d14">&#34;a&#34;</span>).as(<span style="color:#d14">&#34;channel&#34;</span>),
</span></span><span style="display:flex;"><span>alldocs<span style="color:#000;font-weight:bold">:</span> [],
</span></span><span style="display:flex;"><span>splitsize<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">30</span>,
</span></span><span style="display:flex;"><span>splitdocs<span style="color:#000;font-weight:bold">:</span> {},
</span></span><span style="display:flex;"><span>message<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>metadata<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">async</span> get_tags() {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span>{
</span></span><span style="display:flex;"><span>        res <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> fetch(<span style="color:#d14">`</span><span style="color:#d14">${</span>server<span style="color:#d14">}</span><span style="color:#d14">/postgrest/ipfsdocs_tag_view`</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.metadata <span style="color:#000;font-weight:bold">=</span> (<span style="color:#000;font-weight:bold">await</span> res.json())[<span style="color:#099">0</span>][<span style="color:#d14">&#34;values&#34;</span>]
</span></span><span style="display:flex;"><span>        list_keys <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">Object</span>.keys(<span style="color:#000;font-weight:bold">this</span>.metadata)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">!</span> list_keys.includes(<span style="color:#000;font-weight:bold">this</span>.cur_tag.key)){
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.cur_tag.key <span style="color:#000;font-weight:bold">=</span> list_keys[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        list_values <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.metadata[<span style="color:#000;font-weight:bold">this</span>.cur_tag.key]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">!</span> list_values.includes(<span style="color:#000;font-weight:bold">this</span>.cur_tag.value)){
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.cur_tag.value <span style="color:#000;font-weight:bold">=</span> [...list_values].sort()[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#000;font-weight:bold">catch</span> (err)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        error(err)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">throw</span> err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>},
</span></span><span style="display:flex;"><span>cur_tag<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>    key<span style="color:#000;font-weight:bold">:</span> Alpine.$persist([]).as(<span style="color:#d14">&#34;cur_tag_key&#34;</span>),
</span></span><span style="display:flex;"><span>    value<span style="color:#000;font-weight:bold">:</span> Alpine.$persist([]).as(<span style="color:#d14">&#34;cur_tag_value&#34;</span>),
</span></span><span style="display:flex;"><span>},
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">async</span> get_tag_id(key, value){
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span>{
</span></span><span style="display:flex;"><span>        keyEncoded <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">encodeURIComponent</span>(key)
</span></span><span style="display:flex;"><span>        valueEncoded <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">encodeURIComponent</span>(value)
</span></span><span style="display:flex;"><span>        url <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">`</span><span style="color:#d14">${</span>server<span style="color:#d14">}</span><span style="color:#d14">/postgrest/tag?select=tag_id&amp;value-&gt;&gt;key=eq.</span><span style="color:#d14">${</span>keyEncoded<span style="color:#d14">}</span><span style="color:#d14">&amp;value-&gt;&gt;value=eq.</span><span style="color:#d14">${</span>valueEncoded<span style="color:#d14">}</span><span style="color:#d14">&amp;tag_owner=eq.aylapomme`</span>
</span></span><span style="display:flex;"><span>        res <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> fetch(url)
</span></span><span style="display:flex;"><span>        res <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> res.json()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(res.length <span style="color:#000;font-weight:bold">===</span> <span style="color:#099">0</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> <span style="color:#0086b3">Error</span>(<span style="color:#d14">`No tag matching </span><span style="color:#d14">${</span>key<span style="color:#d14">}</span><span style="color:#d14">: </span><span style="color:#d14">${</span>value<span style="color:#d14">}</span><span style="color:#d14">, url: </span><span style="color:#d14">${</span>url<span style="color:#d14">}</span><span style="color:#d14">`</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        tag_id <span style="color:#000;font-weight:bold">=</span> res[<span style="color:#099">0</span>][<span style="color:#d14">&#34;tag_id&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> tag_id
</span></span><span style="display:flex;"><span>    } <span style="color:#000;font-weight:bold">catch</span> (err)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        error(err)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">throw</span> err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>},
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">async</span> apply_tag(cids, key, value) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span>{
</span></span><span style="display:flex;"><span>        tag_id <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.get_tag_id(key, value)
</span></span><span style="display:flex;"><span>        data <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span>(cid <span style="color:#000;font-weight:bold">of</span> cids)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            data.push({cid<span style="color:#000;font-weight:bold">:</span> cid, tag_id<span style="color:#000;font-weight:bold">:</span> tag_id})
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// first, remove, to avoid issues with conflicts
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.remove_tag(cids, key, value)
</span></span><span style="display:flex;"><span>        res <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> fetch(
</span></span><span style="display:flex;"><span>            <span style="color:#d14">`</span><span style="color:#d14">${</span>server<span style="color:#d14">}</span><span style="color:#d14">/postgrest/tagmap`</span>,
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                headers<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;Content-Type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;application/json&#34;</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;method&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;POST&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;body&#34;</span><span style="color:#000;font-weight:bold">:</span> JSON.stringify(data)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    } <span style="color:#000;font-weight:bold">catch</span> (err)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        error(err)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">throw</span> err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>},
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">async</span> remove_tag(cids, key, value) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span>{
</span></span><span style="display:flex;"><span>        tag_id <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.get_tag_id(key, value)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">const</span> selection_list <span style="color:#000;font-weight:bold">=</span> cids.join(<span style="color:#d14">&#34;,&#34;</span>)
</span></span><span style="display:flex;"><span>        url <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">`</span><span style="color:#d14">${</span>server<span style="color:#d14">}</span><span style="color:#d14">/postgrest/tagmap?cid=in.(</span><span style="color:#d14">${</span>selection_list<span style="color:#d14">}</span><span style="color:#d14">)&amp;tag_id=eq.</span><span style="color:#d14">${</span>tag_id<span style="color:#d14">}</span><span style="color:#d14">`</span>
</span></span><span style="display:flex;"><span>        res <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> fetch(url,
</span></span><span style="display:flex;"><span>                          {
</span></span><span style="display:flex;"><span>                              <span style="color:#d14">&#34;method&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;DELETE&#34;</span>,
</span></span><span style="display:flex;"><span>                          }
</span></span><span style="display:flex;"><span>                         )
</span></span><span style="display:flex;"><span>    } <span style="color:#000;font-weight:bold">catch</span> (err)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        error(err)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">throw</span> err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>},
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">async</span> move_to_state(cids, state) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">const</span> cid_list <span style="color:#000;font-weight:bold">=</span> cids.join(<span style="color:#d14">&#34;,&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">const</span> url <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">`</span><span style="color:#d14">${</span>server<span style="color:#d14">}</span><span style="color:#d14">/postgrest/photovideo?cid=in.(</span><span style="color:#d14">${</span>cid_list<span style="color:#d14">}</span><span style="color:#d14">)`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span>{
</span></span><span style="display:flex;"><span>        res <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">await</span> fetch(
</span></span><span style="display:flex;"><span>            url,
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                method<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;PATCH&#39;</span>,
</span></span><span style="display:flex;"><span>                body<span style="color:#000;font-weight:bold">:</span> JSON.stringify({state<span style="color:#000;font-weight:bold">:</span> state}),
</span></span><span style="display:flex;"><span>                headers<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#39;Content-Type&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;application/json&#39;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    } <span style="color:#000;font-weight:bold">catch</span> (err)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        error(err)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">throw</span> err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>},
</span></span></code></pre></div><p><a id="code-snippet--gun-js-code-ex"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-org" data-lang="org"><span style="display:flex;"><span>[[<span style="color:#008080">gun-js-code</span>]]
</span></span></code></pre></div><h2 id="b5be28e7-1096-4afc-a932-ac61ce9723b9">modal</h2>
<p><a id="code-snippet--modal"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mhtml" data-lang="mhtml"><span style="display:flex;"><span>&lt;<span style="color:#000080">template</span> <span style="color:#008080">x-if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;modal.show&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">div</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fixed inset-0 z-30 flex items-center justify-center overflow-auto bg-white text-black bg-opacity-10&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">stop</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;modal.show = false&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">escape</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;modal.show = false&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-transition:enter</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;motion-safe:ease-out duration-300&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-transition:enter-start</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;opacity-0 scale-90&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-transition:enter-end</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;opacity-100 scale-100&#34;</span>
</span></span><span style="display:flex;"><span>    &gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;metadata&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">div</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">stop</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">select</span> <span style="color:#008080">x-effect</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;await $nextTick() ; $el.value = cur_tag.key&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">change</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                         cur_tag.key = $el.value
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                         cur_tag.value = [...metadata[$el.value]].sort()[0]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                         &#34;</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-for</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;key in [...Object.keys(metadata)].sort()&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">option</span> <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;key&#34;</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;key&#34;</span>&gt;&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">select</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">select</span> <span style="color:#008080">x-effect</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;await $nextTick() ; $el.value = cur_tag.value&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">change</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cur_tag.value = $el.value&#34;</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-for</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;value in [...metadata[cur_tag.key]].sort()&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">option</span> <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;value&#34;</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;value&#34;</span>&gt;&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">select</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2 rounded bg-white p-2&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;wanted_index = normalized_index ; await apply_tag([current_doc.cid], cur_tag.key, cur_tag.value) ; modal.show = false ; await fetch_docs() ; info(`added ${cur_tag.key}: ${cur_tag.value}`)&#34;</span>&gt;apply&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2 rounded bg-white p-2&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;wanted_index = normalized_index ; let key = cur_tag.key ; let value = cur_tag.value ; await remove_tag([current_doc.cid], key, value) ; modal.show = false ; await fetch_docs() ; info(`removed ${key}: ${value}`)&#34;</span>&gt;remove&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">div</span> <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{state: null}&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;modal.wanted_state&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#008080">x-modelable</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;state&#34;</span>
</span></span><span style="display:flex;"><span>               &gt;
</span></span><span style="display:flex;"><span>            [[state-selector]]
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2 rounded bg-white p-2&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;wanted_index = normalized_index ; await move_to_state([current_doc.cid], modal.wanted_state) ; modal.show = false ; await fetch_docs() ; info(`applied -&gt; ${modal.wanted_state}`)&#34;</span>&gt;move&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-32 border-4 border-red-500&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">img</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-32 object-contain&#34;</span> <span style="color:#008080">:src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_doc &amp;&amp; current_doc.thumbnail_cid ? current_doc.thumbnail_cid : &#39;&#39;&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{url: &#39;&#39;}&#34;</span>
</span></span><span style="display:flex;"><span>      &gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">a</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-white&#34;</span> <span style="color:#008080">target</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;_blank&#34;</span> <span style="color:#008080">:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;share_url&#34;</span>&gt;share&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">template</span>&gt;
</span></span></code></pre></div><h2 id="598fc034-dc7b-4dff-8ef1-0ec10145e08b">slider</h2>
<p><a id="code-snippet--slider-code"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// span conveys how many items to show on the left and on the
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// right of the cursor
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    span<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">5</span>,
</span></span><span style="display:flex;"><span>    number<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">50</span>,
</span></span><span style="display:flex;"><span>    page<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">0</span>, <span style="color:#998;font-style:italic">// Alpine.$persist(0).as(&#34;page&#34;),
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    cursor<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">0</span>, <span style="color:#998;font-style:italic">// Alpine.$persist(0).as(&#34;cursor&#34;),
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    cur_cid<span style="color:#000;font-weight:bold">:</span> Alpine.$persist(<span style="color:#000;font-weight:bold">null</span>).as(<span style="color:#d14">&#34;cur_cid&#34;</span>),
</span></span><span style="display:flex;"><span>    scroll<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    begScroll<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    endScroll<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    autoplay_timer<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    current_doc<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    modal<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>        show<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>        wanted_state<span style="color:#000;font-weight:bold">:</span> Alpine.$persist(<span style="color:#d14">&#39;done&#39;</span>).as(<span style="color:#d14">&#34;modal_wanted_state&#34;</span>),
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    update_current_doc(){
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.current_doc <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.docs_to_show[<span style="color:#000;font-weight:bold">this</span>.cursor]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    resetsize_timer<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> init() {
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// window.visualViewport.onresize = (event) =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//     if(this.resetsize_timer){
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//         clearTimeout(this.resetsize_timer)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//         this.resetsize_timer = null
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//     }
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//     if(this.zoomed_in) {
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//         this.resetsize_timer = setTimeout(() =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//             info(&#39;clear&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//             reset_zoom()
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//             this.resetsize_timer = null
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//         }, 1)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//     }
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//     else{
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//         info(`${this.zoomed_in} / ${window.visualViewport.width} / ${document.body.clientWidth}`)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//     }
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// };
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">this</span>.docs_to_show <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>._docs_to_show()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.update_current_doc()
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    get zoomed_in() {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> (<span style="color:#0086b3">window</span>.visualViewport.width <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">0.95</span> <span style="color:#000;font-weight:bold">*</span> <span style="color:#0086b3">document</span>.body.clientWidth)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> on_scroll () {
</span></span><span style="display:flex;"><span>        endmark <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.$refs.endmark
</span></span><span style="display:flex;"><span>        begmark <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.$refs.begmark
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.scroll <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.$refs.cont.scrollLeft
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.endScroll <span style="color:#000;font-weight:bold">=</span> endmark.offsetLeft <span style="color:#000;font-weight:bold">-</span> (<span style="color:#000;font-weight:bold">this</span>.$refs.cont.offsetLeft <span style="color:#000;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">this</span>.$refs.cont.offsetWidth);
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.begScroll <span style="color:#000;font-weight:bold">=</span> begmark.offsetLeft
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">let</span> value <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">let</span> threshold <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.scroll <span style="color:#000;font-weight:bold">&lt;=</span> <span style="color:#000;font-weight:bold">this</span>.begScroll <span style="color:#000;font-weight:bold">-</span> threshold){
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.prev_page()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.scroll <span style="color:#000;font-weight:bold">&gt;=</span> <span style="color:#000;font-weight:bold">this</span>.endScroll <span style="color:#000;font-weight:bold">+</span> threshold){
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.next_page()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.scroll <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.$refs.cont.scrollLeft
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.update_cursor()
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    wanted_index<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    get normalized_index(){
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">let</span> index <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.page <span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">this</span>.number <span style="color:#000;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">this</span>.cursor
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">let</span> len <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.alldocs.length
</span></span><span style="display:flex;"><span>        index <span style="color:#000;font-weight:bold">=</span> ((index <span style="color:#000;font-weight:bold">%</span> len) <span style="color:#000;font-weight:bold">+</span> len ) <span style="color:#000;font-weight:bold">%</span> len
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> index
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    update_cursor () {
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// 2 placeholders + the number of docs + the extra doc to
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// perform the loop
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        pieceOfWidth <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.$refs.cont.scrollWidth <span style="color:#000;font-weight:bold">/</span> (<span style="color:#000;font-weight:bold">this</span>.number <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">3</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// -1 because the first one is a placholder. the first doc
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// starts at position 1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        result <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">Math</span>.floor(((<span style="color:#000;font-weight:bold">this</span>.scroll <span style="color:#000;font-weight:bold">+</span> pieceOfWidth <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>)  <span style="color:#000;font-weight:bold">/</span> pieceOfWidth) <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.cursor <span style="color:#000;font-weight:bold">=</span> result
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    docs_to_show<span style="color:#000;font-weight:bold">:</span> {},
</span></span><span style="display:flex;"><span>    _docs_to_show() {
</span></span><span style="display:flex;"><span>        result <span style="color:#000;font-weight:bold">=</span> {}
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// for(var i = 0 ; i &lt;= this.number ; i++){
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//     result[i] = this.doc(i)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// }
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">// return result
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">for</span>(<span style="color:#000;font-weight:bold">var</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.cursor <span style="color:#000;font-weight:bold">-</span> <span style="color:#000;font-weight:bold">this</span>.span; i <span style="color:#000;font-weight:bold">&lt;=</span> <span style="color:#000;font-weight:bold">this</span>.cursor <span style="color:#000;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">this</span>.span; i<span style="color:#000;font-weight:bold">++</span>) {
</span></span><span style="display:flex;"><span>            normalized_index <span style="color:#000;font-weight:bold">=</span> (i <span style="color:#000;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">this</span>.number) <span style="color:#000;font-weight:bold">%</span> <span style="color:#000;font-weight:bold">this</span>.number
</span></span><span style="display:flex;"><span>            result[normalized_index] <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.doc(i <span style="color:#000;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">this</span>.page <span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">this</span>.number)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span>(i <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">this</span>.number) <span style="color:#998;font-style:italic">// last placeholder, should contain an image that ensures continuity
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">// if I&#39;m close to the beginning of the page, the last
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">// placeholder should contain the one on the left of the page,
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">// hence the last of the previous page
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.cursor <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#000;font-weight:bold">this</span>.number <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    result[i] <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.doc(<span style="color:#000;font-weight:bold">this</span>.page <span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">this</span>.number <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">// if I&#39;m close to the end of the range, the last placeholder
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">// should contain the one on the right of the page, hence the
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">// first of next page
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    result[i] <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.doc((<span style="color:#000;font-weight:bold">this</span>.page <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">this</span>.number)
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> result
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    in_transition<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>    click_number<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">0</span>,
</span></span><span style="display:flex;"><span>    click_timer<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> clicked(event) {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.in_transition <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">true</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">// info(&#34;click inhibited&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.click_number <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">let</span> click_time <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">200</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.click_timer){
</span></span><span style="display:flex;"><span>            clearTimeout(<span style="color:#000;font-weight:bold">this</span>.click_timer)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">this</span>.zoomed_in){
</span></span><span style="display:flex;"><span>            pos <span style="color:#000;font-weight:bold">=</span> event.offsetX <span style="color:#000;font-weight:bold">/</span> event.target.clientWidth
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span>(pos <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">0.25</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">this</span>.click_number <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.move_to_prev()
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> (pos <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0.75</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">this</span>.click_number <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.move_to_next()
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.click_number <span style="color:#000;font-weight:bold">===</span> <span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.click_timer <span style="color:#000;font-weight:bold">=</span> setTimeout(<span style="color:#000;font-weight:bold">async</span> () =&gt; {<span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.deal_with_click(event) ; <span style="color:#000;font-weight:bold">this</span>.click_number <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>}, click_time)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.click_number <span style="color:#000;font-weight:bold">===</span> <span style="color:#099">2</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.click_timer <span style="color:#000;font-weight:bold">=</span> setTimeout(<span style="color:#000;font-weight:bold">async</span> () =&gt; {info(<span style="color:#d14">&#39;double click&#39;</span>) ; <span style="color:#000;font-weight:bold">this</span>.click_number <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span> ; <span style="color:#0086b3">document</span>.querySelector(<span style="color:#d14">&#39;body&#39;</span>).requestFullscreen() ; <span style="color:#000;font-weight:bold">if</span>(navigator.wakeLock){<span style="color:#000;font-weight:bold">await</span> navigator.wakeLock.request(<span style="color:#d14">&#34;screen&#34;</span>)} }, click_time <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">1.5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>  <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.click_number <span style="color:#000;font-weight:bold">===</span> <span style="color:#099">3</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.click_timer <span style="color:#000;font-weight:bold">=</span> setTimeout(<span style="color:#000;font-weight:bold">async</span> () =&gt; {<span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.deal_with_triple_click(event) ; <span style="color:#000;font-weight:bold">this</span>.click_number <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>}, click_time)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>{
</span></span><span style="display:flex;"><span>            info(<span style="color:#d14">`</span><span style="color:#d14">${</span><span style="color:#000;font-weight:bold">this</span>.click_number<span style="color:#d14">}</span><span style="color:#d14"> clicks in a row!`</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.click_timer <span style="color:#000;font-weight:bold">=</span> setTimeout(<span style="color:#000;font-weight:bold">async</span> () =&gt; {<span style="color:#000;font-weight:bold">this</span>.click_number <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>}, click_time)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> deal_with_triple_click(event) {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.$dispatch(<span style="color:#d14">&#39;togglelike&#39;</span>, {doc<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">this</span>.current_doc})
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> deal_with_click(event) {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.modal.show <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    freeze<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>    touching<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>    scrolling_to<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> move_to_next(immediate) {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.cursor <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">this</span>.number) {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.next_page()
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">// wait for the page change to be reflected in the DOM
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.$nextTick()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.$dispatch(<span style="color:#d14">&#39;scrollintoview&#39;</span>, {pos<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">this</span>.cursor <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>, immediate<span style="color:#000;font-weight:bold">:</span> immediate})
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> move_to_prev(immediate) {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.cursor <span style="color:#000;font-weight:bold">===</span> <span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.prev_page()
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">// wait for the page change to be reflected in the DOM
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.$nextTick()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.$dispatch(<span style="color:#d14">&#39;scrollintoview&#39;</span>, {pos<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">this</span>.cursor <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>, immediate<span style="color:#000;font-weight:bold">:</span> immediate})
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    swiping<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> prev_page() {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.$refs.cont.scrollLeft <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.endScroll <span style="color:#000;font-weight:bold">-</span> <span style="color:#0086b3">Math</span>.max(<span style="color:#099">0</span>, <span style="color:#000;font-weight:bold">this</span>.begScroll <span style="color:#000;font-weight:bold">-</span> <span style="color:#000;font-weight:bold">this</span>.scroll)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.page <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.page <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// info(`scrolling to ${this.$refs.cont.scrollLeft}`)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> next_page() {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.$refs.cont.scrollLeft <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.begScroll <span style="color:#000;font-weight:bold">+</span> <span style="color:#0086b3">Math</span>.max(<span style="color:#099">0</span>, <span style="color:#000;font-weight:bold">this</span>.scroll <span style="color:#000;font-weight:bold">-</span> <span style="color:#000;font-weight:bold">this</span>.endScroll)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.page <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.page <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">async</span> scroll_to_cur_cid_or_wanted_index() {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">let</span> index <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.wanted_index
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(index <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> <span style="color:#000;font-weight:bold">this</span>.cur_cid){
</span></span><span style="display:flex;"><span>            index <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.alldocs.findIndex((doc) =&gt; doc.cid <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">this</span>.cur_cid)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span>(index <span style="color:#000;font-weight:bold">===</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>){
</span></span><span style="display:flex;"><span>                index <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>                console.log(<span style="color:#d14">`cur: </span><span style="color:#d14">${</span><span style="color:#000;font-weight:bold">this</span>.cur_cid<span style="color:#d14">}</span><span style="color:#d14">, index:</span><span style="color:#d14">${</span>index<span style="color:#d14">}</span><span style="color:#d14">: not found in doc of size </span><span style="color:#d14">${</span><span style="color:#000;font-weight:bold">this</span>.alldocs.length<span style="color:#d14">}</span><span style="color:#d14">`</span>)
</span></span><span style="display:flex;"><span>                console.log(<span style="color:#000;font-weight:bold">this</span>.alldocs)
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">// wait for the slider to be init
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.$nextTick()
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">this</span>.$dispatch(<span style="color:#d14">&#39;scrollintoview&#39;</span>, {pos<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">0</span>, immediate<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">true</span>})
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(index <span style="color:#000;font-weight:bold">!==</span> <span style="color:#000;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.page <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">Math</span>.floor(index <span style="color:#000;font-weight:bold">/</span> <span style="color:#000;font-weight:bold">this</span>.number)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">let</span> cursor <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">Math</span>.floor(index <span style="color:#000;font-weight:bold">%</span> <span style="color:#000;font-weight:bold">this</span>.number)
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">// wait for the slider to be init
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.$nextTick()
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">// then scroll the current cursor
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">this</span>.$dispatch(<span style="color:#d14">&#39;scrollintoview&#39;</span>, {pos<span style="color:#000;font-weight:bold">:</span> cursor, immediate<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">true</span>})
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.$nextTick()
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">// info(`cid: ${cur_cid}, index: ${index}, page: ${page}, cursor: ${cursor}`)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">// wait for the slider to be init
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">await</span> <span style="color:#000;font-weight:bold">this</span>.$nextTick()
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.$dispatch(<span style="color:#d14">&#39;scrollintoview&#39;</span>, {pos<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">0</span>, immediate<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">true</span>})
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.wanted_index <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span>.$dispatch(<span style="color:#d14">&#39;initialscrolldone&#39;</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    get share_url() {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">!</span> <span style="color:#000;font-weight:bold">this</span>.current_doc) {<span style="color:#000;font-weight:bold">return</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">let</span> ext
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span>(<span style="color:#000;font-weight:bold">this</span>.current_doc.<span style="color:#000;font-weight:bold">class</span> <span style="color:#000;font-weight:bold">===</span> <span style="color:#d14">&#39;video&#39;</span>){
</span></span><span style="display:flex;"><span>            ext <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;mp4&#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            ext <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;jpg&#39;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// return &#39;/braindump/posts/simple_image_video_sharer/?open=t&amp;url=&#39; + this.current_doc.web_cid + &#39;?a.&#39; + ext
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#39;/braindump/posts/3dbc869d-4264-4524-8970-5884d406aa8d/?title=simple_image_video_sharer&amp;open=t&amp;url=&#39;</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">this</span>.current_doc.web_cid <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;?a.&#39;</span> <span style="color:#000;font-weight:bold">+</span> ext
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><a id="code-snippet--slider"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mhtml" data-lang="mhtml"><span style="display:flex;"><span>&lt;<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#0086b3">document</span>.addEventListener(<span style="color:#d14">&#39;alpine:init&#39;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>      Alpine.data(<span style="color:#d14">&#39;slider&#39;</span>, () =&gt; (
</span></span><span style="display:flex;"><span>          [[slider<span style="color:#000;font-weight:bold">-</span>code]]
</span></span><span style="display:flex;"><span>      ));
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">div</span> <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;alldocs.length &gt; 0 &amp;&amp; !night&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">f</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;document.querySelector(&#39;body&#39;).requestFullscreen() ;&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">togglelike</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  if($event.detail.doc.metadata.findIndex((el) =&gt; el.key === &#39;tag&#39; &amp;&amp; el.value === &#39;like&#39;) === -1)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  await apply_tag([$event.detail.doc.cid], &#39;tag&#39;, &#39;like&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  info(`added 💜`)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  else
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  await remove_tag([$event.detail.doc.cid], &#39;tag&#39;, &#39;like&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  info(`removed 💜`)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  await fetch_docs()&#34;</span>
</span></span><span style="display:flex;"><span>     &gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">div</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;flex overflow-x-auto w-full touch-manipulation&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">:class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;bg-black&#39;: gun.connected,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;bg-pink-900&#39;: !gun.connected,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;bg-yellow-700&#39;: touching &amp;&amp; transition === &#39;swipe&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;bg-orange-700&#39;: swiping &amp;&amp; transition === &#39;swipe&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    // &#39;scroll-smooth&#39;: smooth_scroll, idea to dig into, but I might want more precise control
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;slider&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;slider&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">scrolltodoc</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  in_transition = true
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  if(smooth_scroll &amp;&amp; ! $event.detail.immediate)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  $el.scroll({left: $event.detail.offset, behavior: &#39;smooth&#39;})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  else
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  $el.scrollLeft = $event.detail.offset
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">docinview</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;in_transition = false&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">update-current-doc</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;update_current_doc()&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">reset</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;page = 0 ; $dispatch(&#39;scrollintoview&#39;, {pos: 0, immediate: true})&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">update-docs-to-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;docs_to_show = _docs_to_show()&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">publish-progress</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                               $dispatch(&#39;progress&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                               {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                               cur:(page * number + cursor),
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                               cursor: cursor,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                               page: page,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                               number: number,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                               total: alldocs.length
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                               }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                               )
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                               &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">cur-cid-follows-current-doc</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if(current_doc){cur_cid = current_doc.cid}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                          // console.log(`cur_cid: ${cur_cid}, current_doc: ${current_doc}`)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                          &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-init</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">register-init-scroll-to-docs-update</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;docs_update_hooks.push(async () =&gt; {await scroll_to_cur_cid_or_wanted_index()})&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-init</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">controlled-setup</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;effect(&#39;controlled&#39;, () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    if(controlled !== &#39;&#39;){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        table = gun.root.get(&#39;ipfsdocs&#39;).get(channel).get(&#39;control&#39;).get(controlled)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        if(! get_param(&#39;follow_controlled&#39;))
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            table.put({page: null, cursor: null, cid: null, share_url: null}) // clean the data to avoid being dragged by old interactions
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        recorder_controlled = controlled
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        recorded_channel = channel
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        table.map().on((value, name, msg, ev) =&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                if(recorded_channel !== channel || recorder_controlled !== controlled)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    ev.off()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    return
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                if(value !== null)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    // debug(`setting ${name}: ${value}`)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    if(name === &#39;page&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        page = value
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    if(name === &#39;cursor&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                        $dispatch(&#39;scrollintoview&#39;, {pos: value})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        )
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-init</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">push-control</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;effect([&#39;page&#39;, &#39;cursor&#39;, &#39;gun.objects.controller&#39;], () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                         if(current_doc &amp;&amp; gun.objects.controller !== null) {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                         control = {page: page, cursor: cursor, cid: current_doc.cid, share_url: share_url}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                         gun.objects.controller.put(control)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                         }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                         })
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                         &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-init</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">setup-controller</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;effect(&#39;controller&#39;, () =&gt; {gun.objects.controller = null; if(controller !== &#39;&#39;){gun.objects.controller = gun.root.get(&#39;ipfsdocs&#39;).get(channel).get(&#39;control&#39;).get(controller)}})&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">freeze</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;freeze = $event.detail.freeze&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">touchstart</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 if(modal.show || in_transition === true) {return}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 touching = {cursor: cursor, t: Date.now(), initx1: $event.touches[0].clientX, x1: $event.touches[0].clientX, prevx: $event.touches[0].clientX, scroll: $el.scrollLeft, direction: true}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 if($event.touches.length &gt; 1 || transition !== &#39;swipe&#39; || zoomed_in)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 swiping = false
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 else
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 swiping = true
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">touchmove</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                if(swiping)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                $event.preventDefault()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                touching[&#39;x2&#39;] = $event.touches[0].clientX
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                direction = touching[&#39;x2&#39;] &gt; touching[&#39;prevx&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                if(direction != touching[&#39;direction&#39;]){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                touching[&#39;t&#39;] = Date.now()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                touching[&#39;x1&#39;] = touching[&#39;prevx&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                touching[&#39;direction&#39;] = direction
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                touching[&#39;prevx&#39;] = touching[&#39;x2&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                $el.scrollLeft = touching[&#39;scroll&#39;] - touching[&#39;x2&#39;] + touching[&#39;initx1&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">touchend</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               if(modal.show || in_transition === true || touching === null) {return}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               let duration = Date.now() - touching[&#39;t&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               let distance = touching[&#39;x2&#39;] - touching[&#39;x1&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               let speed = distance / duration // negative means right
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               // info(`${speed} - ${distance}`)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               if(swiping){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               moved_next = touching[&#39;cursor&#39;] !== cursor &amp;&amp; touching[&#39;x2&#39;] &lt; touching[&#39;x1&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               moved_prev = touching[&#39;cursor&#39;] !== cursor &amp;&amp; touching[&#39;x2&#39;] &gt; touching[&#39;x1&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               // info(`${moved_prev} - ${moved_next}`)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               // info(`${cursor}`)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               if(speed &gt; 0.8)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               if(moved_prev)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               $dispatch(&#39;scrollintoview&#39;, {pos: cursor})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               else
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               await move_to_prev()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               else if(speed &lt; -0.8)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               if(moved_next)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               $dispatch(&#39;scrollintoview&#39;, {pos: cursor})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               else
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               await move_to_next()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               else if(isNaN(distance) || distance ** 2 &lt; 100)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               // deal with the click action here so that it won&#39;t be caught in between the slider and the docs
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               // info(&#39;click&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               // the following would prevent all other clicks, even those that would trigger a video play
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               // await clicked($event)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               // $event.preventDefault() // prevent the click handler from being called
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               else
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               // info(&#39;center it&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               $dispatch(&#39;scrollintoview&#39;, {pos: cursor})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               touching = null
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               swiping = false
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">move_to_next</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;move_to_next&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">move_to_prev</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;move_to_prev&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">setup-autoplay</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if(autoplay_timer){clearInterval(autoplay_timer) ; autoplay_timer = null} ; if(autoplay &amp;&amp; ! freeze &amp;&amp; ! modal.show &amp;&amp; ! touching){autoplay_timer = setInterval(async () =&gt; {await move_to_next()}, autoplay_time)}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-ref</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cont&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">load-better-quality-when-toggling-on-to-option</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                                             if(quality !== &#39;thumb&#39;){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                                             $dispatch(&#39;loadwebquality&#39;, {pos: cursor})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                                             }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                                             &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;await clicked($event)&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">delete</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;modal.show = true&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">d</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if(confirm(&#39;delete?&#39;)){wanted_index = normalized_index ; await move_to_state([current_doc.cid], &#39;delete&#39;) ; await fetch_docs() ; info(&#39;deleted&#39;)}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">a</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if($event.key === &#39;A&#39;){return} ; if(confirm(`apply ${modal.wanted_state}?`)){wanted_index = normalized_index ; await move_to_state([current_doc.cid], modal.wanted_state) ; await fetch_docs() ; info(&#39;applied&#39;)}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">shift</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">a</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if(confirm(`apply ${cur_tag.key}: ${cur_tag.value}?`)){wanted_index = normalized_index ; let key = cur_tag.key ; let value = cur_tag.value ; await apply_tag([current_doc.cid], key, value) ; modal.show = false ; await fetch_docs() ; info(`added ${key}: ${value}`)}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">arrow-right</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;await move_to_next()&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">arrow-left</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;await move_to_prev()&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">scroll</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">throttle</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">50ms</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;on_scroll&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">scroll</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">debounce</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">500ms</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;// I have no certainty that the debounced event above will trigger the last scroll event, so i need to at least process this last event to compute accurately the cursor
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                            await on_scroll()
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                            if(scrolling_to === cursor || touching || zoomed_in || (transition !== &#39;scroll_snap&#39;)){return}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                            $dispatch(&#39;scrollintoview&#39;, {pos: cursor})&#34;</span>
</span></span><span style="display:flex;"><span>    &gt;
</span></span><span style="display:flex;"><span>    [[modal]]
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!-- placeholder to avoid stopping the scroll animation --&gt;</span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text-white bg-slate-900 min-w-full&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">img</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-full h-screen object-contain&#34;</span> <span style="color:#008080">:src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;docs_to_show[number-1] ? docs_to_show[number-1].thumbnail_cid : &#39;&#39;&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">span</span> <span style="color:#008080">x-ref</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;begmark&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;!night&#34;</span> <span style="color:#008080">x-for</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;i in number + 1&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      [[doc]]
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!-- placeholder to avoid stopping the scroll animation --&gt;</span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">x-ref</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;endmark&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text-white bg-slate-900 min-w-full&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">img</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-full h-screen object-contain&#34;</span> <span style="color:#008080">:src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;docs_to_show[1] ? docs_to_show[1].thumbnail_cid : &#39;&#39;&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">input</span> <span style="color:#008080">min</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;0&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">progress</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;$el.value = (($event.detail.cur % $event.detail.total) + $event.detail.total) % $event.detail.total  ; $el.max = $event.detail.total&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;range&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-full h-3 bg-red-500&#34;</span> <span style="color:#008080">disabled</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;true&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><h2 id="b2052bf8-979f-45c4-af8b-dd11cabdf0ab">doc</h2>
<p><a id="code-snippet--doc"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mhtml" data-lang="mhtml"><span style="display:flex;"><span>&lt;<span style="color:#000080">div</span> <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    get mycursor() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        return i - 1
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    get mydoc() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        res = this.docs_to_show[this.mycursor]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        if(res &amp;&amp; res.metadata === null){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            res.metadata = []
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        return res
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    get mymetadata() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        var doc = this.mydoc
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        if(doc)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            return doc.metadata
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        return []
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    get iscurrent() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        return this.mycursor === this.cursor
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    async move_to_prev() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        this.$dispatch(&#39;move_to_prev&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        async move_to_next() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        this.$dispatch(&#39;move_to_next&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        inview: false,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        &#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;min-w-full bg-black-500&#34;</span>
</span></span><span style="display:flex;"><span>     &gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">div</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;relative border-3 border-red-500 w-full&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">scrollintoview</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if($event.detail.pos === mycursor){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                            $dispatch(&#39;scrolltodoc&#39;, {offset: $el.offsetLeft, immediate: $event.detail.immediate})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                            scrolling_to = mycursor
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                            await $nextTick() // waiting to make sure the underlying image is loaded and the event scrolltodoc is processed
</span></span></span><span style="display:flex;"><span><span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                            $dispatch(&#39;loadwebquality&#39;, {pos: $event.detail.pos})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                            if(inview){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                            $dispatch(&#39;docinview&#39;, {cursor: mycursor})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                            }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                            }&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-intersect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">full:enter</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;$dispatch(&#39;docinview&#39;, {cursor: mycursor}); inview=true;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-intersect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">full:leave</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;inview=false;&#34;</span>
</span></span><span style="display:flex;"><span>    &gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;mydoc &amp;&amp; mydoc.metadata.findIndex((el) =&gt; el.key === &#39;tag&#39; &amp;&amp; el.value === &#39;like&#39;) !== -1&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;absolute bottom-1 right-1 z-10&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      💜
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;mydoc &amp;&amp; (mydoc.class === &#39;photo&#39;)&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">div</span> <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    inerror: false,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    webquality: (quality === &#39;web&#39;),
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">link</span> <span style="color:#008080">rel</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;prefetch&#34;</span> <span style="color:#008080">:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;mydoc &amp;&amp; mydoc.web_cid&#34;</span>&gt;&lt;/<span style="color:#000080">link</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">img</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{loaded: false, load_timer: null}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-full h-screen object-contain&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">:class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{&#39;border-4&#39;:!loaded, &#39;border-blue-900&#39;: !inerror &amp;&amp; !loaded, &#39;border-red-500&#39;: inerror}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">load</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 loaded = true
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 inerror = false
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 if(load_timer){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 clearTimeout(load_timer)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 load_timer = null
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                 &#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">error</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;inerror = true&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">n</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if(iscurrent){await move_to_next()}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">p</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if(iscurrent){await move_to_prev()}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">x-init</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">timeout-load-on-src-change</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;effect(&#39;mydoc&#39;, () =&gt; {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    if(load_timer){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        clearTimeout(load_timer)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        load_timer = null
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    if(mydoc){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        cid = mydoc.cid
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        load_timer = setTimeout(() =&gt; {inerror = true; console.log(`error: ${cid} vs ${mydoc.cid}`)}, 10000)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">})&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">:src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;mydoc ? (webquality ? mydoc.web_cid : mydoc.thumbnail_cid) : &#39;/ipfs/bafkreichqb6kdgrxy4p2ocwhzitnzwc5ei4iera7uuyrmsgv2lz3ysspka?filename=giphy.jpg&#39;&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">loadwebquality</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if($event.detail.pos === mycursor){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                  if(quality === &#39;thumbtoweb&#39; &amp;&amp; ! webquality){
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                  loaded = false
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                  webquality = true
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                  }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                                  }&#34;</span>
</span></span><span style="display:flex;"><span>          /&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;mydoc &amp;&amp; (mydoc.class === &#39;video&#39;)&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;relative w-full h-screen&#34;</span> <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{playing: false, id: $id(&#39;video&#39;), ended: false}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">video</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                      toggle() { this.$el.paused ? this.$el.play() : this.$el.pause() }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                  &#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">controls</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;controls&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">:id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;id&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">x-effect</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;ended = false&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">inform-that-playing</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if(mydoc === current_doc){$dispatch(&#39;freeze&#39;, {freeze: playing})}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">pause</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;playing = false&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">ended</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;playing = false ; ended = true&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">play</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;playing = true&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">t</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if(mydoc === current_doc){toggle()}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">space</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">prevent</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if(mydoc === current_doc){toggle()}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">n</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if(iscurrent){if(playing){$el.currentTime += 5}else if(ended){await move_to_next()}else{toggle()}}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">p</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if(iscurrent){if(playing){$el.currentTime -= 5}else{await move_to_prev()}}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">toggle</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">window</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if($event.detail.web_cid === (mydoc.web_cid)){toggle()}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">x-intersect:leave</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">threshold</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">70</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;$el.pause()&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-full h-full object-contain&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">preload</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;none&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">:poster</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;mydoc ? mydoc.thumbnail_cid : &#39;&#39;&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">x-effect</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">make-sure-video-is-loaded</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;if(mydoc){$el.load()}&#34;</span>
</span></span><span style="display:flex;"><span>          &gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">source</span> <span style="color:#008080">:src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;mydoc ? mydoc.web_cid : &#39;&#39;&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;video/mp4&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">video</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">div</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;absolute inset-0 flex items-center justify-center&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;(mydoc &amp;&amp; mydoc.web_cid) === (current_doc &amp;&amp; current_doc.web_cid) &amp;&amp; ! playing&#34;</span>
</span></span><span style="display:flex;"><span>          &gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">img</span>
</span></span><span style="display:flex;"><span>            <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-1/6&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">stop</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;document.getElementById(id).play()&#34;</span> <span style="color:#008080">src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/ipfs/bafybeidjwfa6sz3dj6qgdddnprqrdcnceet6pxggqrpctpnno32nem6qz4?filename=9TRR9bj8c.png&#34;</span>
</span></span><span style="display:flex;"><span>            /&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-full text-center bg-slate-400&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;$dispatch(&#39;scrollintoview&#39;, {pos: cursor})&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;current_doc &amp;&amp; current_doc.date&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-full&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-for</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;metadata in mymetadata&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;w-full bg-slate-400&#34;</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;metadata[&#39;key&#39;] + &#39;: &#39; + metadata[&#39;value&#39;]&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;true&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      hash: &lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;mydoc &amp;&amp; mydoc.hash&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>      page: &lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;page&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;,
</span></span><span style="display:flex;"><span>      mycursor: &lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;mycursor&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;,
</span></span><span style="display:flex;"><span>      docs: &lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;page * number + cursor&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt; / &lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;alldocs.length&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">a</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2 rounded bg-blue-300 p-2&#34;</span> <span style="color:#008080">:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;mydoc &amp;&amp; mydoc.cid&#34;</span>&gt;original&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">a</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2 rounded bg-blue-300 p-2&#34;</span> <span style="color:#008080">:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;mydoc &amp;&amp; mydoc.web_cid&#34;</span>&gt;web&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><h2 id="991864d0-816d-46b4-93eb-cea41a34a823">state selector</h2>
<p>Can be inserted in a document that exposes its state via x-modelable, like</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mhtml" data-lang="mhtml"><span style="display:flex;"><span>&lt;<span style="color:#000080">div</span> <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{state: null}&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;modal.wanted_state&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#008080">x-modelable</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;state&#34;</span>
</span></span><span style="display:flex;"><span>     &gt;
</span></span><span style="display:flex;"><span>  [[state-selector]]
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><p><a id="code-snippet--state-selector"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mhtml" data-lang="mhtml"><span style="display:flex;"><span>&lt;<span style="color:#000080">select</span> <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;state&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">:class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;bg-yellow-100&#39;: data_to_fetch.state == &#39;todo&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;bg-blue-100&#39;: data_to_fetch.state == &#39;next&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;bg-green-100&#39;: data_to_fetch.state == &#39;done&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    &#39;bg-red-100&#39;: data_to_fetch.state == &#39;delete&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}    &#34;</span>
</span></span><span style="display:flex;"><span>        &gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">option</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-yellow-100&#34;</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;todo&#34;</span>&gt;todo&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">option</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-blue-100&#34;</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;next&#34;</span>&gt;next&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">option</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-green-100&#34;</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;done&#34;</span>&gt;done&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">option</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-red-100&#34;</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;delete&#34;</span>&gt;delete&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">select</span>&gt;
</span></span></code></pre></div><h2 id="a1f69b92-8324-4a0c-8ee2-c48e1e302e80">tools</h2>
<p><a id="code-snippet--tools"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mhtml" data-lang="mhtml"><span style="display:flex;"><span>&lt;<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">div</span> <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{show_control: false}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-slate-100&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        smooth
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">input</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;h-10 w-10&#34;</span> <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;smooth_scroll&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;checkbox&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        autoplay
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">input</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;h-10 w-10&#34;</span> <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;autoplay&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;checkbox&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        night mode
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">input</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;h-10 w-10&#34;</span> <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;night_mode&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;checkbox&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        transition
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">select</span> <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;transition&#34;</span>
</span></span><span style="display:flex;"><span>                &gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;scroll_snap&#34;</span>&gt;scroll snap&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;scroll_no_snap&#34;</span>&gt;scroll no snap&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;swipe&#34;</span>&gt;swipe&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">select</span>&gt;
</span></span><span style="display:flex;"><span>        quality
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">select</span> <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;quality&#34;</span>
</span></span><span style="display:flex;"><span>                &gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;web&#34;</span>&gt;web&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;thumbtoweb&#34;</span>&gt;thumb to web&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;thumb&#34;</span>&gt;thumb&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">select</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2 bg-slate-300 rounded&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;$dispatch(&#39;reset&#39;)&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        reset
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-slate-300 rounded&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;document.querySelector(&#39;body&#39;).requestFullscreen() ;&#34;</span>&gt;fullscreen&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-slate-300 rounded&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;installPromptEvent.prompt(); ;&#34;</span>&gt;Install&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-slate-100&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        channel
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">input</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{updating: false}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">:class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{&#39;bg-green-500&#39;: updating}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">input</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;updating = true&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">stop</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">input</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">debounce</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">2000ms</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;updating = false&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">x-model</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">debounce</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">2000ms</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;channel&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">bg-slate-100</span>&gt;
</span></span><span style="display:flex;"><span>        control
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">input</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;h-10 w-10&#34;</span> <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;show_control&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;checkbox&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;show_control&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-slate-100&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        controller
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">input</span>  <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{updating: false}&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#008080">:class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{&#39;bg-green-500&#39;: updating}&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">input</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;updating = true&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">stop</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">input</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">debounce</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">2000ms</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;updating = false&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#008080">x-model</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">debounce</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">2000ms</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;controller&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>        controlled
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">input</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{updating: false}&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#008080">:class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{&#39;bg-green-500&#39;: updating}&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">input</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;updating = true&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">keydown</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">stop</span>
</span></span><span style="display:flex;"><span>               <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">input</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">debounce</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">2000ms</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;updating = false&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#008080">x-model</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">debounce</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">2000ms</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;controlled&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-slate-100 h-1 rounded-full m-2&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">div</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{show_metadata: false}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">x-effect</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;show_metadata = show_metadata || filter_in.length &gt; 0&#34;</span>
</span></span><span style="display:flex;"><span>    &gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2 bg-slate-300 rounded&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;info(&#39;fetching&#39;) ; await fetch_docs() ; info(&#39;fetched&#39;)&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      fetch
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">input</span> <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    adjust_date() {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        var givenDate = new Date($el.value)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        var minDate = new Date($el.min)
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        if(givenDate &lt;= minDate) {
</span></span></span><span style="display:flex;"><span><span style="color:#d14">            $el.value = minDate.toISOString().split(&#39;T&#39;)[0]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        }
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    },
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;data_to_fetch.fromdate&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#008080">:min</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fetch_from_min&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#008080">:max</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;data_to_fetch.to ? data_to_fetch.to : &#39;&#39;&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;date&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">input</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;adjust_date() ; gun.objects.tools.put({fromdate: $el.value})&#34;</span>
</span></span><span style="display:flex;"><span>             /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">input</span> <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;data_to_fetch.to&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">input</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;gun.objects.tools.put({to: $el.value})&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#008080">:min</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;data_to_fetch.fromdate ? data_to_fetch.fromdate : &#39;&#39;&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;date&#34;</span>
</span></span><span style="display:flex;"><span>             /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2 bg-slate-300 rounded&#34;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                      let fromdate = random_date(new Date(fetch_from_min), new Date(Date.now())).toISOString().split(&#39;T&#39;)[0]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                      gun.objects.tools.put({fromdate: fromdate})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                      gun.objects.tools.put({to: random_date(new Date(fromdate), new Date(Date.now())).toISOString().split(&#39;T&#39;)[0]})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                      &#34;</span>&gt;
</span></span><span style="display:flex;"><span>        random
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2 bg-slate-300 rounded&#34;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                      gun.objects.tools.put({fromdate: &#39;&#39;})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                      gun.objects.tools.put({to: &#39;&#39;})
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                      &#34;</span>&gt;
</span></span><span style="display:flex;"><span>        clear
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">input</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;number&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;max-w-20&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;data_to_fetch.limit&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#008080">max</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">1000</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">input</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">debounce</span><span style="color:#a61717;background-color:#e3d2d2">.</span><span style="color:#008080">500ms</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;let max = Math.floor($el.max) ; if($el.value &gt; max){alert(`limiting the limit to at most ${max} due to some technical limitation`); $el.value = max} ; gun.objects.tools.put({limit: $el.value})&#34;</span>
</span></span><span style="display:flex;"><span>             /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">select</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">change</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;gun.objects.tools.put({state: $el.value})&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;data_to_fetch.state&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">:class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                &#39;bg-yellow-100&#39;: data_to_fetch.state == &#39;todo&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                &#39;bg-blue-100&#39;: data_to_fetch.state == &#39;next&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                &#39;bg-green-100&#39;: data_to_fetch.state == &#39;done&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                &#39;bg-red-100&#39;: data_to_fetch.state == &#39;delete&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                }    &#34;</span>
</span></span><span style="display:flex;"><span>        &gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">option</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-yellow-100&#34;</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;todo&#34;</span>&gt;todo&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">option</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-blue-100&#34;</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;next&#34;</span>&gt;next&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">option</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-green-100&#34;</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;done&#34;</span>&gt;done&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">option</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-red-100&#34;</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;delete&#34;</span>&gt;delete&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">select</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">select</span> <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;data_to_fetch.owner&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">change</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;gun.objects.tools.put({owner: $el.value})&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;aylapomme&#34;</span>&gt;aylapomme&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;konubinix&#34;</span>&gt;konubinix&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">select</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">select</span> <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;data_to_fetch.type&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">change</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;gun.objects.tools.put({type: $el.value})&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;&#34;</span>&gt;&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;image&#34;</span>&gt;image&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;video&#34;</span>&gt;video&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">select</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">bg-slate-100</span>&gt;
</span></span><span style="display:flex;"><span>        metadata
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">input</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;h-10 w-10&#34;</span> <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;show_metadata&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;checkbox&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>        💜
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">input</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;h-10 w-10&#34;</span> <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;data_to_fetch.only_like&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">input</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;gun.objects.tools.put({only_like: $el.checked})&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;checkbox&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>        🎥
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">select</span> <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;data_to_fetch.table&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">change</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;gun.objects.tools.put({table: $el.value})&#34;</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;photo&#34;</span>&gt;photo only&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;video&#34;</span>&gt;video only&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">option</span> <span style="color:#008080">value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;photovideo&#34;</span>&gt;all&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">select</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;metadata&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">x-show</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;show_metadata&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">x-data</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{key: Object.keys(metadata)[0], value: [...metadata[Object.keys(metadata)[0]]].sort()[0]}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">select</span> <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;key&#34;</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-for</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;key in [...Object.keys(metadata)].sort()&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">option</span> <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;key&#34;</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;key&#34;</span>&gt;&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">select</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">select</span> <span style="color:#008080">x-model</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;value&#34;</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-for</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;value in [...metadata[key]].sort()&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">option</span> <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;value&#34;</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;value&#34;</span>&gt;&lt;/<span style="color:#000080">option</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">select</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-slate-300 rounded&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;gun.objects.tools.put({filter_in_raw: JSON.stringify([])})&#34;</span>&gt;clean&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-slate-300 rounded&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">click</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;gun.objects.tools.put({filter_in_raw: JSON.stringify(filter_in.concat([{key: key, value: value}]))})&#34;</span>&gt;add&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;flex&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#008080">x-effect</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;filter_in = JSON.parse(data_to_fetch.filter_in_raw)&#34;</span>
</span></span><span style="display:flex;"><span>             &gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#000080">template</span> <span style="color:#008080">x-for</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;filter in filter_in&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-green-300 rounded-full&#34;</span>&gt;&lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;filter[&#39;key&#39;]&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;: &lt;<span style="color:#000080">span</span> <span style="color:#008080">x-text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;filter[&#39;value&#39;]&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">template</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bg-slate-100 m-2&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        shuffle
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">input</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;h-10 w-10&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#008080">:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;data_to_fetch.shuffle&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#a61717;background-color:#e3d2d2">@</span><span style="color:#008080">input</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;gun.objects.tools.put({shuffle: $el.checked})&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;checkbox&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">a</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;m-2 rounded bg-blue-300 p-2&#34;</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/thumbs/&#34;</span>&gt;thumbs&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><h2 id="ecf3d38d-700d-49ec-9a2a-5bdf5fc2538a">manifest</h2>
<p><a id="code-snippet--manifest"></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;ipfsdoc&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;short_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;ipfsdoc&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;ipfsdoc&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;start_url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;./index.html?fullscreen&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;display&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;fullscreen&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;background_color&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;#ffffff&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;theme_color&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;#4285f4&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;screenshots&#34;</span><span style="color:#000;font-weight:bold">:</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;src&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;./icons/icon-512x512.png&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;sizes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;512x512&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;image/png&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;form_factor&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;narrow&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;label&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;Application&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;src&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;./icons/icon-512x512.png&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;sizes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;512x512&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;image/png&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;form_factor&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;wide&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;label&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;Application&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;icons&#34;</span><span style="color:#000;font-weight:bold">:</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;src&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;./icons/icon-192x192.png&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;image/png&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;sizes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;192x192&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;src&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;./icons/icon-512x512.png&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;image/png&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;sizes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;512x512&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;prefer_related_applications&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;scope&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;./&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;permissions&#34;</span><span style="color:#000;font-weight:bold">:</span> [],
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;splash_pages&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">null</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;categories&#34;</span><span style="color:#000;font-weight:bold">:</span> []
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="68599c9e-b662-4eb4-b9f4-c2406bfc48dd">icons</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ipfs get -o https://ipfs.konubinix.eu/ipfs/bafybeibuk3dkn6qwbo6cpnmgh26zupcl2ytm4gggu6nxgqoo4xoctuoy4i -o /home/sam/perso/perso/test/icons
</span></span></code></pre></div><h2 id="9518470c-f586-4cff-a087-bc341f93bcc4">the request</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">or</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">replace</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">view</span><span style="color:#bbb"> </span>ipfsdocs_photovideo_view<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">as</span><span style="color:#bbb">   </span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">state</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>filename,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>mimetype,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">class</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>cid,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>web_cid,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>thumbnail_cid,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#0086b3">date</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>metadata,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000;font-weight:bold">owner</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>myrandom,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>hash<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>(<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>files.res_state<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">state</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>files.res_filename<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>filename,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>files.res_mimetype<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>mimetype,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>files.res_class<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">class</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>files.cid,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>files.res_web_cid<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>web_cid,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>files.res_thumbnail_cid<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>thumbnail_cid,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>files.res_date<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#0086b3">date</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>files.<span style="color:#000;font-weight:bold">owner</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>COALESCE(json_agg(tag.value)<span style="color:#bbb"> </span>FILTER<span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>tag.value<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">IS</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NOT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span>),<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span>::json)::jsonb<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>metadata,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>files.res_myrandom<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>myrandom,<span style="color:#bbb"> </span>files.perceptualhash<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">as</span><span style="color:#bbb"> </span>hash<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>(<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>f.<span style="color:#000;font-weight:bold">state</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>res_state,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>concat(to_char(f.<span style="color:#0086b3">date</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;YYMMDD_HHMMSS&#39;</span>::<span style="color:#0086b3">text</span>),<span style="color:#bbb"> </span><span style="color:#d14">&#39;-&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;right&#34;</span>(f.cid::<span style="color:#0086b3">text</span>,<span style="color:#bbb"> </span><span style="color:#099">3</span>))<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>res_filename,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>f.mimetype<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>res_mimetype,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>f.tableoid::regclass::<span style="color:#0086b3">text</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>res_class,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>f.cid,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>f.web_cid<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>res_web_cid,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>f.thumbnail_cid<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>res_thumbnail_cid,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>f.<span style="color:#0086b3">date</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>res_date,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>f.<span style="color:#000;font-weight:bold">owner</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>f.myrandom<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">AS</span><span style="color:#bbb"> </span>res_myrandom,<span style="color:#bbb"> </span>f.perceptualhash<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span><span style="color:#000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>photovideo<span style="color:#bbb"> </span>f<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                       </span><span style="color:#000;font-weight:bold">LEFT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">JOIN</span><span style="color:#bbb"> </span>tagmap<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">USING</span><span style="color:#bbb"> </span>(cid)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                       </span><span style="color:#000;font-weight:bold">LEFT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">JOIN</span><span style="color:#bbb"> </span>tag<span style="color:#bbb"> </span>t<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">USING</span><span style="color:#bbb"> </span>(tag_id)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#000;font-weight:bold">GROUP</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">BY</span><span style="color:#bbb"> </span>f.<span style="color:#000;font-weight:bold">state</span>,<span style="color:#bbb"> </span>(concat(to_char(f.<span style="color:#0086b3">date</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;YYMMDD_HHMMSS&#39;</span>::<span style="color:#0086b3">text</span>),<span style="color:#bbb"> </span><span style="color:#d14">&#39;-&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;right&#34;</span>(f.cid::<span style="color:#0086b3">text</span>,<span style="color:#bbb"> </span><span style="color:#099">3</span>))),<span style="color:#bbb"> </span>f.mimetype,<span style="color:#bbb"> </span>(f.tableoid::regclass),<span style="color:#bbb"> </span>f.cid,<span style="color:#bbb"> </span>f.web_cid,<span style="color:#bbb"> </span>f.thumbnail_cid,<span style="color:#bbb"> </span>f.<span style="color:#0086b3">date</span>)<span style="color:#bbb"> </span>files<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span><span style="color:#000;font-weight:bold">LEFT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">JOIN</span><span style="color:#bbb"> </span>(<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>tagmap.tag_id,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>tagmap.cid,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>tag_1.tag_owner,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>tag_1.value<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span><span style="color:#000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>tagmap<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                       </span><span style="color:#000;font-weight:bold">LEFT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">JOIN</span><span style="color:#bbb"> </span>tag<span style="color:#bbb"> </span>tag_1<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">USING</span><span style="color:#bbb"> </span>(tag_id))<span style="color:#bbb"> </span>tag<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">USING</span><span style="color:#bbb"> </span>(cid)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>tag.tag_owner<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">=</span><span style="color:#bbb"> </span>files.<span style="color:#000;font-weight:bold">owner</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">OR</span><span style="color:#bbb"> </span>tag.tag_owner<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">IS</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#000;font-weight:bold">GROUP</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">BY</span><span style="color:#bbb"> </span>files.res_state,<span style="color:#bbb"> </span>files.res_filename,<span style="color:#bbb"> </span>files.res_mimetype,<span style="color:#bbb"> </span>files.res_class,<span style="color:#bbb"> </span>files.cid,<span style="color:#bbb"> </span>files.res_myrandom,<span style="color:#bbb"> </span>files.res_web_cid,<span style="color:#bbb"> </span>files.res_thumbnail_cid,<span style="color:#bbb"> </span>files.res_date,<span style="color:#bbb"> </span>files.<span style="color:#000;font-weight:bold">owner</span>,<span style="color:#bbb"> </span>files.perceptualhash<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#000;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">BY</span><span style="color:#bbb"> </span>files.res_date)<span style="color:#bbb"> </span>unnamed_subquery;<span style="color:#bbb">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>CREATE VIEW
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">\</span>d<span style="color:#000;font-weight:bold">+</span><span style="color:#bbb"> </span>ipfsdocs_photovideo_view<span style="color:#bbb">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>View &#34;public.ipfsdocs_photovideo_view&#34;
</span></span><span style="display:flex;"><span>Column	Type	Collation	Nullable	Default	Storage	Description
</span></span><span style="display:flex;"><span>state	state				plain
</span></span><span style="display:flex;"><span>filename	text				extended
</span></span><span style="display:flex;"><span>mimetype	character varying(100)				extended
</span></span><span style="display:flex;"><span>class	text				extended
</span></span><span style="display:flex;"><span>cid	character varying(255)				extended
</span></span><span style="display:flex;"><span>web_cid	character varying(255)				extended
</span></span><span style="display:flex;"><span>thumbnail_cid	character varying(255)				extended
</span></span><span style="display:flex;"><span>date	timestamp with time zone				plain
</span></span><span style="display:flex;"><span>metadata	jsonb				extended
</span></span><span style="display:flex;"><span>owner	owner_type				plain
</span></span><span style="display:flex;"><span>myrandom	double precision				plain
</span></span><span style="display:flex;"><span>View definition:
</span></span><span style="display:flex;"><span> SELECT state,
</span></span><span style="display:flex;"><span>    filename,
</span></span><span style="display:flex;"><span>    mimetype,
</span></span><span style="display:flex;"><span>    class,
</span></span><span style="display:flex;"><span>    cid,
</span></span><span style="display:flex;"><span>    web_cid,
</span></span><span style="display:flex;"><span>    thumbnail_cid,
</span></span><span style="display:flex;"><span>    date,
</span></span><span style="display:flex;"><span>    metadata,
</span></span><span style="display:flex;"><span>    owner,
</span></span><span style="display:flex;"><span>    myrandom
</span></span><span style="display:flex;"><span>   FROM ( SELECT files.res_state AS state,
</span></span><span style="display:flex;"><span>            files.res_filename AS filename,
</span></span><span style="display:flex;"><span>            files.res_mimetype AS mimetype,
</span></span><span style="display:flex;"><span>            files.res_class AS class,
</span></span><span style="display:flex;"><span>            files.cid,
</span></span><span style="display:flex;"><span>            files.res_web_cid AS web_cid,
</span></span><span style="display:flex;"><span>            files.res_thumbnail_cid AS thumbnail_cid,
</span></span><span style="display:flex;"><span>            files.res_date AS date,
</span></span><span style="display:flex;"><span>            files.owner,
</span></span><span style="display:flex;"><span>            COALESCE(json_agg(tag.value) FILTER (WHERE tag.value IS NOT NULL), NULL::json)::jsonb AS metadata,
</span></span><span style="display:flex;"><span>            files.res_myrandom AS myrandom
</span></span><span style="display:flex;"><span>           FROM ( SELECT f.state AS res_state,
</span></span><span style="display:flex;"><span>                    concat(to_char(f.date, &#39;YYMMDD_HHMMSS&#39;::text), &#39;-&#39;, &#34;right&#34;(f.cid::text, 3)) AS res_filename,
</span></span><span style="display:flex;"><span>                    f.mimetype AS res_mimetype,
</span></span><span style="display:flex;"><span>                    f.tableoid::regclass::text AS res_class,
</span></span><span style="display:flex;"><span>                    f.cid,
</span></span><span style="display:flex;"><span>                    f.web_cid AS res_web_cid,
</span></span><span style="display:flex;"><span>                    f.thumbnail_cid AS res_thumbnail_cid,
</span></span><span style="display:flex;"><span>                    f.date AS res_date,
</span></span><span style="display:flex;"><span>                    f.owner,
</span></span><span style="display:flex;"><span>                    f.myrandom AS res_myrandom
</span></span><span style="display:flex;"><span>                   FROM photovideo f
</span></span><span style="display:flex;"><span>                     LEFT JOIN tagmap USING (cid)
</span></span><span style="display:flex;"><span>                     LEFT JOIN tag t USING (tag_id)
</span></span><span style="display:flex;"><span>                  GROUP BY f.state, (concat(to_char(f.date, &#39;YYMMDD_HHMMSS&#39;::text), &#39;-&#39;, &#34;right&#34;(f.cid::text, 3))), f.mimetype, (f.tableoid::regclass), f.cid, f.web_cid, f.thumbnail_cid, f.date) files
</span></span><span style="display:flex;"><span>             LEFT JOIN ( SELECT tagmap.tag_id,
</span></span><span style="display:flex;"><span>                    tagmap.cid,
</span></span><span style="display:flex;"><span>                    tag_1.tag_owner,
</span></span><span style="display:flex;"><span>                    tag_1.value
</span></span><span style="display:flex;"><span>                   FROM tagmap
</span></span><span style="display:flex;"><span>                     LEFT JOIN tag tag_1 USING (tag_id)) tag USING (cid)
</span></span><span style="display:flex;"><span>          WHERE tag.tag_owner = files.owner OR tag.tag_owner IS NULL
</span></span><span style="display:flex;"><span>          GROUP BY files.res_state, files.res_filename, files.res_mimetype, files.res_class, files.cid, files.res_myrandom, files.res_web_cid, files.res_thumbnail_cid, files.res_date, files.owner
</span></span><span style="display:flex;"><span>          ORDER BY files.res_date) unnamed_subquery;
</span></span></code></pre></div><h2 id="permalink"><a href="/braindump/6b5e4704-44dd-4764-b4f0-fb5606a13c6c?title=wip_ipfsdocs_slider_alpinejs">Permalink</a></h2>

      </div>
	  <aside class="date"><time>Last updated: 29 Jun 2025</time></aside>
	  <aside class="date"><time>Published&nbsp;&nbsp;&nbsp;: 01 Mar 2024</time></aside>
    </div>
  </div>
</div>

<script src="/braindump/js/URI.js" type="text/javascript"></script>

<script src="/braindump/js/page.js" type="text/javascript"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
