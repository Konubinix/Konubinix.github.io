<!DOCTYPE html>
<html><title>terraform</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="bLmaFyyXugiCqSup-eIIIx0B4CngtdF_svyMMKQbS5E" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, minimum-scale=0.5, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src="https://hypothes.is/embed.js" async></script>


<link rel="stylesheet" href="/braindump/css/main.min.56b43bcbc759a196f9dd525bee62bdec45a29ba95902bbab74a4f7ad2ea3e8cb.css"/>

<link rel="stylesheet" href="/braindump/css/links.min.4bf1990b213fb76d2a66153dc6ef9a57d49f536c6baf6e7f19a7948470a38141.css"/>

<link rel="stylesheet" href="/braindump/css/konubinix.min.cf2d0f36945178c647979ee68f1830892e06aa3d481d8913728b5c7462b97f6e.css"/>

<link rel="stylesheet" href="/ipfs/QmQFVQS89fv1XUNFcjwCKDePzckuT9kpuAVNYUwNdEfYcv/css/all.css"/>
<link rel="shortcut icon" href="/ipfs/QmVFwYV7YRZLKU3ybN1hW4jqfyZGPLKJwd8toN2wHz5UAD?a.png" type="image/x-icon" />

<body><header>
  <div>
	<a href="/braindump//"><h5 class="site-title">Konubinix&#39; opinionated web of thoughts</h5></a>
  </div>
  <span>
	<a href="/blog/"><i class="icon fas fa-blog"></i></a>
	<a href="/braindump/posts/"><i class="icon fas fa-brain"></i></a>
    <a href="mailto:konubinixweb@gmail.com"><i class="icon fas fa-envelope-square"></i></a>
    <a href="https://github.com/konubinix"><i class="icon fab fa-github-square"></i></a>
    <a href="https://linkedin.com/in/samuel-loury-61259040"><i class="icon fab fa-linkedin"></i></a>
	<a href="/braindump/graph.html"><i class="icon fas fa-project-diagram"></i></a>
	<a href="/braindump/index.xml"><i class="icon fas fa-rss-square"></i></a>
	<a href="/braindump/tags/"><i class="icon fa fa-tag"></i></a>
	<a href="/braindump/braindump_search"><i class="icon fa fa-search"></i></a>
  </span>
</header>

<div class="grid-container">
  <div class="grid">
    <div class="page" data-level="1">
      <div class="content">
		<p class="lead">
        <h1>Terraform</h1>
		<span class="badge badge-pill badge-warning"><a href="/braindump/tags/fleeting/">Fleeting</a></span></p>
        <p>terraform</p>
<p>Produit de <a href="/braindump/posts/hashicorp/">Hashicorp</a>.</p>
<h2 id="fe4f6187-a7b6-423d-bb24-c15aa6d14d83">terraform_data Managed Resource Type</h2>
<ul>
<li>Référence externe : <a href="https://developer.hashicorp.com/terraform/language/resources/terraform-data">https://developer.hashicorp.com/terraform/language/resources/terraform-data</a></li>
</ul>
<blockquote>
<p>useful [&hellip;] for triggering provisioners when there is no other logical managed
resource in which to place them.</p>
<p>&mdash; <a href="https://developer.hashicorp.com/terraform/language/resources/terraform-data">https://developer.hashicorp.com/terraform/language/resources/terraform-data</a> (<span class="timestamp-wrapper"><span class="timestamp">[2025-04-07 Mon]</span></span>)</p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>Example Usage (data for <a href="#d262c6e5-9afa-4e78-ac7b-312f806258fe">replace_triggered_by</a>)</p>
<p>&mdash; <a href="https://developer.hashicorp.com/terraform/language/resources/terraform-data">https://developer.hashicorp.com/terraform/language/resources/terraform-data</a> (<span class="timestamp-wrapper"><span class="timestamp">[2025-04-07 Mon]</span></span>)</p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>variable &ldquo;revision&rdquo; {
default = 1
}</p>
<p>resource &ldquo;terraform_data&rdquo; &ldquo;replacement&rdquo; {
input = var.revision
}</p>
<p>resource &ldquo;example_database&rdquo; &ldquo;test&rdquo; {
lifecycle {
replace_triggered_by = [terraform_data.replacement]
}
}</p>
<p>&mdash; <a href="https://developer.hashicorp.com/terraform/language/resources/terraform-data">https://developer.hashicorp.com/terraform/language/resources/terraform-data</a> (<span class="timestamp-wrapper"><span class="timestamp">[2025-04-07 Mon]</span></span>)</p>
</blockquote>
<h2 id="68e9374c-6bf4-49da-a23e-28e40ead918f">lifecycle Meta-Argument</h2>
<ul>
<li>Référence externe : <a href="https://developer.hashicorp.com/terraform/language/meta-arguments/lifecycle#replace_triggered_by">https://developer.hashicorp.com/terraform/language/meta-arguments/lifecycle#replace_triggered_by</a></li>
</ul>
<h3 id="d262c6e5-9afa-4e78-ac7b-312f806258fe">replace_triggered_by</h3>
<blockquote>
<p>replace_triggered_by (list of resource or attribute references) - Added in
Terraform 1.2. Replaces the resource when any of the referenced items
change. Supply a list of expressions referencing managed resources, instances,
or instance attributes. When used in a resource that uses count or for_each, you
can use count.index or each.key in the expression to reference specific
instances of other resources that are configured with the same count or
collection.</p>
<p>&mdash; <a href="https://developer.hashicorp.com/terraform/language/meta-arguments/lifecycle#replace_triggered_by">https://developer.hashicorp.com/terraform/language/meta-arguments/lifecycle#replace_triggered_by</a> (<span class="timestamp-wrapper"><span class="timestamp">[2025-04-07 Mon]</span></span>)</p>
</blockquote>
<h2 id="28a3ef27-77af-4e33-8904-f624e8eb9eaa"><a href="/braindump/posts/aws/#1f69d3a0-dd59-4c85-ac00-bed67353c7cf">eks</a> <a href="/braindump/posts/aws/#d82e9999-bd4f-440f-8555-0eee3237b085">nodegroup</a> desired_size not updated</h2>
<ul>
<li>Référence externe : <a href="https://github.com/bryantbiggs/eks-desired-size-hack">https://github.com/bryantbiggs/eks-desired-size-hack</a></li>
<li>Référence externe : <a href="https://github.com/terraform-aws-modules/terraform-aws-eks/issues/2030">https://github.com/terraform-aws-modules/terraform-aws-eks/issues/2030</a></li>
</ul>
<p>You can do it manually with <a href="/braindump/posts/aws/#d3bd8925-c6df-411a-9c46-3ef40d9de3c5">awscli</a> using</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#008080">cluster_name</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">$(</span>aws eks list-clusters | jq -r .clusters<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">)</span><span style="color:#d14">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">nodegroup_name</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">$(</span>aws eks list-nodegroups --cluster-name <span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">cluster_name</span><span style="color:#d14">}</span><span style="color:#d14">&#34;</span>|jq -r .nodegroups<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">)</span><span style="color:#d14">&#34;</span>
</span></span><span style="display:flex;"><span>aws eks update-nodegroup-config  --nodegroup-name <span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">nodegroup_name</span><span style="color:#d14">}</span><span style="color:#d14">&#34;</span> --cluster-name <span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">cluster_name</span><span style="color:#d14">}</span><span style="color:#d14">&#34;</span> --scaling-config <span style="color:#d14">&#39;maxSize=3&#39;</span>
</span></span><span style="display:flex;"><span>aws eks update-nodegroup-config  --nodegroup-name <span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">nodegroup_name</span><span style="color:#d14">}</span><span style="color:#d14">&#34;</span> --cluster-name <span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">cluster_name</span><span style="color:#d14">}</span><span style="color:#d14">&#34;</span> --scaling-config <span style="color:#d14">&#39;desiredSize=3&#39;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;update&#34;: {
</span></span><span style="display:flex;"><span>        &#34;id&#34;: &#34;8e6df717-99e3-310c-80ba-ce2747e474aa&#34;,
</span></span><span style="display:flex;"><span>        &#34;status&#34;: &#34;InProgress&#34;,
</span></span><span style="display:flex;"><span>        &#34;type&#34;: &#34;ConfigUpdate&#34;,
</span></span><span style="display:flex;"><span>        &#34;params&#34;: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                &#34;type&#34;: &#34;DesiredSize&#34;,
</span></span><span style="display:flex;"><span>                &#34;value&#34;: &#34;3&#34;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        &#34;createdAt&#34;: &#34;2024-08-09T16:08:44.445000+02:00&#34;,
</span></span><span style="display:flex;"><span>        &#34;errors&#34;: []
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>Autoscaling of nodes via cluster autoscaler or Karpenter is the preferred method
by many</p>
<p>&mdash; <a href="https://github.com/terraform-aws-modules/terraform-aws-eks/issues/2030">https://github.com/terraform-aws-modules/terraform-aws-eks/issues/2030</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p><a href="/braindump/posts/terraform/">Terraform</a> does not allow for parameterizing ignore_changes at this time so this is the default effect</p>
<p>&mdash; <a href="https://github.com/terraform-aws-modules/terraform-aws-eks/issues/2030">https://github.com/terraform-aws-modules/terraform-aws-eks/issues/2030</a></p>
</blockquote>
<!--quoteend-->
<blockquote>
<p>It is assumed that most users will utilize a form of autoscaling that will
manage the desired_size attribute of the node groups (i.e. - Cluster Autoscaler
will manage this attribute for scaling), and therefore Terraform should not
attempt to manage after it has been initially set during creation of the node
group.</p>
<p>&mdash; <a href="https://github.com/bryantbiggs/eks-desired-size-hack">https://github.com/bryantbiggs/eks-desired-size-hack</a></p>
</blockquote>
<!--more-->
<h2 id="notes-pointant-ici">Notes pointant ici</h2>
<ul>
<li><a href="/braindump/posts/allow_replace_triggered_by_to_refer_to_module_or_module_resource/">Allow `replace_triggered_by` to refer to module or module resource</a></li>
<li><a href="/braindump/posts/delete_a_secrets_manager_secret_and_create_a_new_secret_with_the_same_name/">delete a Secrets Manager secret and create a new secret with the same name</a></li>
<li><a href="/braindump/posts/force_recreation_of_resource_when_other_resource_ist_recreated_updated_r_terraform/">Force recreation of resource when other resource ist recreated/updated : r/Terraform</a></li>
<li><a href="/braindump/posts/infrastructure_as_code/">infrastructure as code</a></li>
<li><a href="/braindump/posts/terraform_aws_ecs_service_force_new_deployment_how_to_make_it_work/">terraform aws ecs_service force_new_deployment how to make it work ?</a></li>
<li><a href="/braindump/posts/what_is_v1beta1_metrics_k8s_io_and_what_does_false_missingendpoints_means/">what is v1beta1.metrics.k8s.io and what does False (MissingEndpoints) means</a></li>
</ul>
<h2 id="permalink"><a href="https://konubinix.eu/braindump/739baa41-379a-4cc3-9829-23da96b98253?title=terraform">Permalink</a></h2>
      </div>
	  <aside class="date"><time>Last updated: 07 Apr 2025</time></aside>
	  <aside class="date"><time>Published&nbsp;&nbsp;&nbsp;: 22 Jan 2021</time></aside>
    </div>
  </div>
</div>

<script src="/braindump/js/URI.js" type="text/javascript"></script>

<script src="/braindump/js/page.js" type="text/javascript"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
